"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const { remote } = require('electron');
const argvars = remote.process.argv.slice(2).map(s => s.toLowerCase());
const DEBUG = argvars.includes('debug');
const DRYRUN = argvars.includes('dry-run');
const path = require('path');
let ROOT_PATH_ABS;
let SRC_PATH_ABS;
if (path.basename(__dirname) === 'src') {
    ROOT_PATH_ABS = path.join(__dirname, '..');
    SRC_PATH_ABS = __dirname;
}
else {
    ROOT_PATH_ABS = __dirname;
    SRC_PATH_ABS = path.join(ROOT_PATH_ABS, 'src');
}
const TEMPLATES_PATH_ABS = path.join(ROOT_PATH_ABS, 'templates');
const SALAMANDER_PATH_ABS = path.join(TEMPLATES_PATH_ABS, 'Salamander');
const EXPERIMENTS_PATH_ABS = path.join(SRC_PATH_ABS, 'experiments');
const TRUTHS_PATH_ABS = path.join(EXPERIMENTS_PATH_ABS, 'truths');
const CONFIGS_PATH_ABS = path.join(EXPERIMENTS_PATH_ABS, 'configs');
const SUBJECTS_PATH_ABS = path.join(EXPERIMENTS_PATH_ABS, 'subjects');
process.env.ROOT_PATH_ABS = ROOT_PATH_ABS;
process.env.SRC_PATH_ABS = SRC_PATH_ABS;
process.env.TEMPLATES_PATH_ABS = TEMPLATES_PATH_ABS;
process.env.SALAMANDER_PATH_ABS = SALAMANDER_PATH_ABS;
process.env.EXPERIMENTS_PATH_ABS = EXPERIMENTS_PATH_ABS;
process.env.TRUTHS_PATH_ABS = TRUTHS_PATH_ABS;
process.env.CONFIGS_PATH_ABS = CONFIGS_PATH_ABS;
process.env.SUBJECTS_PATH_ABS = SUBJECTS_PATH_ABS;
const { PythonShell } = require("python-shell");
const enginePath = path.join(ROOT_PATH_ABS, "src", "engine");
const pyExecPath = path.join(enginePath, process.platform === "linux" ? "env/bin/python" : "env/Scripts/python.exe");
console.group(`renderer.ts`);
console.table({
    __dirname, ROOT_PATH_ABS, SRC_PATH_ABS,
    TEMPLATES_PATH_ABS,
    SALAMANDER_PATH_ABS,
    EXPERIMENTS_PATH_ABS,
    TRUTHS_PATH_ABS,
    CONFIGS_PATH_ABS,
    SUBJECTS_PATH_ABS,
    DEBUG, DRYRUN,
    enginePath, pyExecPath
});
PythonShell.defaultOptions = {
    pythonPath: pyExecPath,
    pythonOptions: ['-OO'],
};
PythonShell.prototype.runAsync = function () {
    return new Promise((resolve, reject) => {
        const messages = [];
        this.on('message', message => messages.push(message));
        this.end((err, code, signal) => {
            if (err)
                reject(err);
            resolve(messages);
        });
    });
};
PythonShell.myrun = function (scriptPath, options = { args: [], pythonOptions: ['-OO'] }, callback) {
    if (scriptPath.startsWith('-m')) {
        scriptPath = scriptPath.slice(3);
        if (!options.pythonOptions) {
            options.pythonOptions = ['-m'];
        }
        else {
            if (!options.pythonOptions.includes('-m')) {
                options.pythonOptions.push('-m');
            }
        }
    }
    options.args = [ROOT_PATH_ABS, ...options.args];
    if (DEBUG)
        options.args.push('debug');
    if (DRYRUN)
        options.args.push('dry-run');
    if (!callback) {
        callback = (err, output) => {
            if (err) {
                console.error(err);
            }
            if (output)
                console.log(`%c${scriptPath}\n`, 'font-weight: bold', output.join('\n'));
        };
    }
    return PythonShell.run(scriptPath, options, callback);
};
PythonShell.myrun("-m checks.dirs");
const MyStore = require("./MyStore");
const Store = new MyStore.MyStore(true);
console.log(`Store.path: `, Store.path);
PythonShell.myrun("-m checks.config", { args: [Store.path] });
Object.defineProperty(Object.prototype, "keys", {
    enumerable: false,
    value() {
        return Object.keys(this).map(key => key.isdigit()
            ? parseInt(key) : key);
    }
});
Object.defineProperty(Array.prototype, "last", {
    enumerable: false,
    value() {
        return this[this.length - 1];
    }
});
Object.defineProperty(Array.prototype, "lowerAll", {
    enumerable: false,
    value() {
        return this.map(s => s.lower());
    }
});
Object.defineProperty(Array.prototype, "rsort", {
    enumerable: false,
    value() {
        return this.sort((n, m) => n < m);
    }
});
Object.defineProperty(Array.prototype, "count", {
    enumerable: false,
    value(item, strict = false) {
        let _count = 0;
        for (let x of this) {
            if (strict) {
                if (x === item)
                    _count++;
            }
            else if (x == item) {
                _count++;
            }
        }
        return _count;
    }
});
Object.defineProperty(String.prototype, "upTo", {
    enumerable: false,
    value(searchString, searchFromEnd = false) {
        let end = searchFromEnd
            ? this.lastIndexOf(searchString)
            : this.indexOf(searchString);
        if (end === -1)
            console.warn(`${this.valueOf()}.upTo(${searchString},${searchFromEnd}) index is -1`);
        return this.slice(0, end);
    }
});
Object.defineProperty(String.prototype, "in", {
    enumerable: false,
    value(arr) {
        return arr.includes(this.valueOf());
    }
});
Object.defineProperty(String.prototype, "lower", {
    enumerable: false,
    value() {
        return this.toLowerCase();
    }
});
Object.defineProperty(String.prototype, "upper", {
    enumerable: false,
    value() {
        return this.toUpperCase();
    }
});
Object.defineProperty(String.prototype, "title", {
    enumerable: false,
    value() {
        if (this.includes(' '))
            return this.split(' ').map(str => str.title()).join(' ');
        else
            return this[0].upper() + this.slice(1, this.length).lower();
    }
});
Object.defineProperty(String.prototype, "isdigit", {
    enumerable: false,
    value() {
        return !isNaN(Math.floor(this));
    }
});
Object.defineProperty(String.prototype, "removeAll", {
    enumerable: false,
    value(removeValue, ...removeValues) {
        let temp = this;
        for (let value of [removeValue, ...removeValues])
            temp = temp.replaceAll(value, '');
        return temp;
    }
});
Object.defineProperty(String.prototype, "replaceAll", {
    enumerable: false,
    value(searchValue, replaceValue) {
        const type = typeof searchValue;
        if (type === 'string' || type === 'number') {
            return this
                .split(searchValue)
                .join(replaceValue);
        }
        else if (type === 'object') {
            let temp = this;
            for (let [sv, rv] of Object.entries(searchValue))
                temp = temp.replaceAll(sv, rv);
            return temp;
        }
        else {
            console.warn(`replaceAll got a bad type, searchValue: ${searchValue}, type: ${type}`);
            return this;
        }
    }
});
Object.defineProperty(Number.prototype, "human", {
    enumerable: false,
    value(letters = false) {
        switch (Math.floor(this) + 1) {
            case 0:
                return letters
                    ? "zeroth"
                    : "0th";
            case 1:
                return letters
                    ? "first"
                    : "1st";
            case 2:
                return letters
                    ? "second"
                    : "2nd";
            case 3:
                return letters
                    ? "third"
                    : "3rd";
            case 4:
                return letters
                    ? "fourth"
                    : "4th";
            case 5:
                return letters
                    ? "fifth"
                    : "5th";
            case 6:
                return letters
                    ? "sixth"
                    : "6th";
            case 7:
                return letters
                    ? "seventh"
                    : "7th";
            case 8:
                return letters
                    ? "eighth"
                    : "8th";
            case 9:
                return letters
                    ? "ninth"
                    : "9th";
            default:
                return `${Math.floor(this) + 1}th`;
        }
    }
});
Object.defineProperty(Date.prototype, "human", {
    enumerable: false, value() {
        let d = this.getUTCDate();
        d = d < 10 ? `0${d}` : d;
        let m = this.getMonth() + 1;
        m = m < 10 ? `0${m}` : m;
        const y = this.getFullYear();
        const t = this.toTimeString().slice(0, 8).replaceAll(':', '-');
        return `${d}_${m}_${y}_${t}`;
    }
});
let skipFade = false;
module.exports = {
    skipFade,
    PythonShell
};
console.groupEnd();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyZW5kZXJlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQVVBLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7QUFDdkMsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZFLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDeEMsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUUzQyxNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFFN0IsSUFBSSxhQUFxQixDQUFDO0FBQzFCLElBQUksWUFBb0IsQ0FBQztBQUN6QixJQUFLLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssS0FBSyxFQUFHO0lBQ3RDLGFBQWEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMzQyxZQUFZLEdBQUcsU0FBUyxDQUFDO0NBQzVCO0tBQU07SUFDSCxhQUFhLEdBQUcsU0FBUyxDQUFDO0lBQzFCLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztDQUNsRDtBQUVELE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFFakUsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixFQUFFLFlBQVksQ0FBQyxDQUFDO0FBR3hFLE1BQU0sb0JBQW9CLEdBQUcs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QyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDL0QsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO0lBQ2pDLENBQUM7Q0FDSixDQUFDLENBQUM7QUFDSCxJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUM7QUFFckIsTUFBTSxDQUFDLE9BQU8sR0FBRztJQUNiLFFBQVE7SUFFUixXQUFXO0NBQ2QsQ0FBQztBQUNGLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFRoaXMgZmlsZSBpcyByZXF1aXJlZCBieSB0aGUgaW5kZXguaHRtbCBmaWxlIGFuZCB3aWxsXG4vLyBiZSBleGVjdXRlZCBpbiB0aGUgcmVuZGVyZXIgcHJvY2VzcyBmb3IgdGhhdCB3aW5kb3cuXG4vLyBObyBOb2RlLmpzIEFQSXMgYXJlIGF2YWlsYWJsZSBpbiB0aGlzIHByb2Nlc3MgYmVjYXVzZVxuLy8gYG5vZGVJbnRlZ3JhdGlvbmAgaXMgdHVybmVkIG9mZi4gVXNlIGBwcmVsb2FkLmpzYCB0b1xuLy8gc2VsZWN0aXZlbHkgZW5hYmxlIGZlYXR1cmVzIG5lZWRlZCBpbiB0aGUgcmVuZGVyaW5nXG4vLyBwcm9jZXNzLlxuXG5cbmltcG9ydCB7IHdhaXQgfSBmcm9tIFwiLi91dGlsXCI7XG5cbmNvbnN0IHsgcmVtb3RlIH0gPSByZXF1aXJlKCdlbGVjdHJvbicpO1xuY29uc3QgYXJndmFycyA9IHJlbW90ZS5wcm9jZXNzLmFyZ3Yuc2xpY2UoMikubWFwKHMgPT4gcy50b0xvd2VyQ2FzZSgpKTtcbmNvbnN0IERFQlVHID0gYXJndmFycy5pbmNsdWRlcygnZGVidWcnKTtcbmNvbnN0IERSWVJVTiA9IGFyZ3ZhcnMuaW5jbHVkZXMoJ2RyeS1ydW4nKTtcbi8vIEB0cy1pZ25vcmVcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG4vLyBjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG5sZXQgUk9PVF9QQVRIX0FCUzogc3RyaW5nO1xubGV0IFNSQ19QQVRIX0FCUzogc3RyaW5nO1xuaWYgKCBwYXRoLmJhc2VuYW1lKF9fZGlybmFtZSkgPT09ICdzcmMnICkge1xuICAgIFJPT1RfUEFUSF9BQlMgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nKTtcbiAgICBTUkNfUEFUSF9BQlMgPSBfX2Rpcm5hbWU7XG59IGVsc2Uge1xuICAgIFJPT1RfUEFUSF9BQlMgPSBfX2Rpcm5hbWU7XG4gICAgU1JDX1BBVEhfQUJTID0gcGF0aC5qb2luKFJPT1RfUEFUSF9BQlMsICdzcmMnKTtcbn1cbi8vIC9zcmMvdGVtcGxhdGVzXG5jb25zdCBURU1QTEFURVNfUEFUSF9BQlMgPSBwYXRoLmpvaW4oUk9PVF9QQVRIX0FCUywgJ3RlbXBsYXRlcycpO1xuLy8gL3NyYy90ZW1wbGF0ZXMvU2FsYW1hbmRlclxuY29uc3QgU0FMQU1BTkRFUl9QQVRIX0FCUyA9IHBhdGguam9pbihURU1QTEFURVNfUEFUSF9BQlMsICdTYWxhbWFuZGVyJyk7XG5cbi8vIC9zcmMvZXhwZXJpbWVudHNcbmNvbnN0IEVYUEVSSU1FTlRTX1BBVEhfQUJTID0gcGF0aC5qb2luKFNSQ19QQVRIX0FCUywgJ2V4cGVyaW1lbnRzJyk7XG4vLyAvc3JjL2V4cGVyaW1lbnRzL3RydXRoc1xuY29uc3QgVFJVVEhTX1BBVEhfQUJTID0gcGF0aC5qb2luKEVYUEVSSU1FTlRTX1BBVEhfQUJTLCAndHJ1dGhzJyk7XG4vLyAvc3JjL2V4cGVyaW1lbnRzL2NvbmZpZ3NcbmNvbnN0IENPTkZJR1NfUEFUSF9BQlMgPSBwYXRoLmpvaW4oRVhQRVJJTUVOVFNfUEFUSF9BQlMsICdjb25maWdzJyk7XG4vLyAvc3JjL2V4cGVyaW1lbnRzL3N1YmplY3RzXG5jb25zdCBTVUJKRUNUU19QQVRIX0FCUyA9IHBhdGguam9pbihFWFBFUklNRU5UU19QQVRIX0FCUywgJ3N1YmplY3RzJyk7XG5wcm9jZXNzLmVudi5ST09UX1BBVEhfQUJTID0gUk9PVF9QQVRIX0FCUztcbnByb2Nlc3MuZW52LlNSQ19QQVRIX0FCUyA9IFNSQ19QQVRIX0FCUztcblxucHJvY2Vzcy5lbnYuVEVNUExBVEVTX1BBVEhfQUJTID0gVEVNUExBVEVTX1BBVEhfQUJTO1xucHJvY2Vzcy5lbnYuU0FMQU1BTkRFUl9QQVRIX0FCUyA9IFNBTEFNQU5ERVJfUEFUSF9BQlM7XG5cbnByb2Nlc3MuZW52LkVYUEVSSU1FTlRTX1BBVEhfQUJTID0gRVhQRVJJTUVOVFNfUEFUSF9BQlM7XG5wcm9jZXNzLmVudi5UUlVUSFNfUEFUSF9BQlMgPSBUUlVUSFNfUEFUSF9BQlM7XG5wcm9jZXNzLmVudi5DT05GSUdTX1BBVEhfQUJTID0gQ09ORklHU19QQVRIX0FCUztcbnByb2Nlc3MuZW52LlNVQkpFQ1RTX1BBVEhfQUJTID0gU1VCSkVDVFNfUEFUSF9BQlM7XG5cbi8vICoqICBQeXRob25TaGVsbFxuY29uc3QgeyBQeXRob25TaGVsbCB9ID0gcmVxdWlyZShcInB5dGhvbi1zaGVsbFwiKTtcbmNvbnN0IGVuZ2luZVBhdGggPSBwYXRoLmpvaW4oUk9PVF9QQVRIX0FCUywgXCJzcmNcIiwgXCJlbmdpbmVcIik7XG5jb25zdCBweUV4ZWNQYXRoID0gcGF0aC5qb2luKGVuZ2luZVBhdGgsIHByb2Nlc3MucGxhdGZvcm0gPT09IFwibGludXhcIiA/IFwiZW52L2Jpbi9weXRob25cIiA6IFwiZW52L1NjcmlwdHMvcHl0aG9uLmV4ZVwiKTtcbmNvbnNvbGUuZ3JvdXAoYHJlbmRlcmVyLnRzYCk7XG5jb25zb2xlLnRhYmxlKHtcbiAgICBfX2Rpcm5hbWUsIFJPT1RfUEFUSF9BQlMsIFNSQ19QQVRIX0FCUyxcbiAgICBURU1QTEFURVNfUEFUSF9BQlMsXG4gICAgU0FMQU1BTkRFUl9QQVRIX0FCUyxcbiAgICBFWFBFUklNRU5UU19QQVRIX0FCUyxcbiAgICBUUlVUSFNfUEFUSF9BQlMsXG4gICAgQ09ORklHU19QQVRIX0FCUyxcbiAgICBTVUJKRUNUU19QQVRIX0FCUyxcbiAgICBERUJVRywgRFJZUlVOLFxuICAgIGVuZ2luZVBhdGgsIHB5RXhlY1BhdGhcbn0pO1xuLypjb25zdCB7IHNwYXduU3luYyB9ID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpO1xuIGNvbnN0IHsgb3V0cHV0IH0gPSBzcGF3blN5bmMoUHl0aG9uU2hlbGwuZ2V0UHl0aG9uUGF0aCgpLCBbICctYyBwcmludChcImhpXCIpJyBdKTtcbiBpZiAoIG91dHB1dCA9PT0gbnVsbCApIHtcbiAvLyBUT0RPOiB0ZXN0XG4gY29uc29sZS5lcnJvcihgU3Bhd25pbmcgYSBQeXRob25TaGVsbC5nZXRQeXRob25QYXRoKCkgZmFpbGVkYCk7XG4gcHJvY2Vzcy5leGl0KDApO1xuIH0qL1xuUHl0aG9uU2hlbGwuZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgcHl0aG9uUGF0aCA6IHB5RXhlY1BhdGgsXG4gICAgLy8gc2NyaXB0UGF0aCA6IGVuZ2luZVBhdGgsXG4gICAgcHl0aG9uT3B0aW9ucyA6IFsgJy1PTycgXSxcbn07XG5cblxuUHl0aG9uU2hlbGwucHJvdG90eXBlLnJ1bkFzeW5jID0gZnVuY3Rpb24gKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCBtZXNzYWdlcyA9IFtdO1xuICAgICAgICB0aGlzLm9uKCdtZXNzYWdlJywgbWVzc2FnZSA9PiBtZXNzYWdlcy5wdXNoKG1lc3NhZ2UpKTtcbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgICB0aGlzLmVuZCgoZXJyLCBjb2RlLCBzaWduYWwpID0+IHtcbiAgICAgICAgICAgIGlmICggZXJyICkgcmVqZWN0KGVycik7XG4gICAgICAgICAgICByZXNvbHZlKG1lc3NhZ2VzKVxuICAgICAgICB9KTtcbiAgICB9KTtcbn07XG5QeXRob25TaGVsbC5teXJ1biA9IGZ1bmN0aW9uIChzY3JpcHRQYXRoOiBzdHJpbmcsIG9wdGlvbnMgPSB7IGFyZ3MgOiBbXSwgcHl0aG9uT3B0aW9ucyA6IFsgJy1PTycgXSB9LCBjYWxsYmFjaykge1xuICAgIFxuICAgIGlmICggc2NyaXB0UGF0aC5zdGFydHNXaXRoKCctbScpICkge1xuICAgICAgICBzY3JpcHRQYXRoID0gc2NyaXB0UGF0aC5zbGljZSgzKTtcbiAgICAgICAgaWYgKCAhb3B0aW9ucy5weXRob25PcHRpb25zICkge1xuICAgICAgICAgICAgb3B0aW9ucy5weXRob25PcHRpb25zID0gWyAnLW0nIF1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICggIW9wdGlvbnMucHl0aG9uT3B0aW9ucy5pbmNsdWRlcygnLW0nKSApIHtcbiAgICAgICAgICAgICAgICBvcHRpb25zLnB5dGhvbk9wdGlvbnMucHVzaCgnLW0nKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIG9wdGlvbnMuYXJncyA9IFsgUk9PVF9QQVRIX0FCUywgLi4ub3B0aW9ucy5hcmdzIF07XG4gICAgaWYgKCBERUJVRyApXG4gICAgICAgIG9wdGlvbnMuYXJncy5wdXNoKCdkZWJ1ZycpO1xuICAgIGlmICggRFJZUlVOIClcbiAgICAgICAgb3B0aW9ucy5hcmdzLnB1c2goJ2RyeS1ydW4nKTtcbiAgICBpZiAoICFjYWxsYmFjayApIHtcbiAgICAgICAgY2FsbGJhY2sgPSAoZXJyLCBvdXRwdXQpID0+IHtcbiAgICAgICAgICAgIGlmICggZXJyICkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICggb3V0cHV0IClcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJWMke3NjcmlwdFBhdGh9XFxuYCwgJ2ZvbnQtd2VpZ2h0OiBib2xkJywgb3V0cHV0LmpvaW4oJ1xcbicpKVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBQeXRob25TaGVsbC5ydW4oc2NyaXB0UGF0aCwgb3B0aW9ucywgY2FsbGJhY2spXG59O1xuXG5cblB5dGhvblNoZWxsLm15cnVuKFwiLW0gY2hlY2tzLmRpcnNcIik7XG4vLyAqKiAgRWxlY3Ryb24gU3RvcmVcbi8vIGNvbnN0IFN0b3JlID0gbmV3IChyZXF1aXJlKFwiZWxlY3Ryb24tc3RvcmVcIikpKCk7XG5jb25zdCBNeVN0b3JlID0gcmVxdWlyZShcIi4vTXlTdG9yZVwiKTtcblxuY29uc3QgU3RvcmUgPSBuZXcgTXlTdG9yZS5NeVN0b3JlKHRydWUpO1xuY29uc29sZS5sb2coYFN0b3JlLnBhdGg6IGAsIFN0b3JlLnBhdGgpO1xuUHl0aG9uU2hlbGwubXlydW4oXCItbSBjaGVja3MuY29uZmlnXCIsIHsgYXJncyA6IFsgU3RvcmUucGF0aCBdIH0pO1xuXG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShPYmplY3QucHJvdG90eXBlLCBcImtleXNcIiwge1xuICAgIGVudW1lcmFibGUgOiBmYWxzZSxcbiAgICB2YWx1ZSgpOiBBcnJheTxzdHJpbmcgfCBudW1iZXI+IHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcykubWFwKGtleSA9PiBrZXkuaXNkaWdpdCgpXG4gICAgICAgICAgICA/IHBhcnNlSW50KGtleSkgOiBrZXkpO1xuICAgIH1cbn0pO1xuLy8gKiogQXJyYXlcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsIFwibGFzdFwiLCB7XG4gICAgZW51bWVyYWJsZSA6IGZhbHNlLFxuICAgIHZhbHVlKCkge1xuICAgICAgICByZXR1cm4gdGhpc1t0aGlzLmxlbmd0aCAtIDFdO1xuICAgIH1cbn0sKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsIFwibG93ZXJBbGxcIiwge1xuICAgIGVudW1lcmFibGUgOiBmYWxzZSxcbiAgICB2YWx1ZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXAocyA9PiBzLmxvd2VyKCkpO1xuICAgIH1cbn0sKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsIFwicnNvcnRcIiwge1xuICAgIGVudW1lcmFibGUgOiBmYWxzZSxcbiAgICB2YWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc29ydCgobiwgbSkgPT4gbiA8IG0pO1xuICAgIH1cbn0sKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJheS5wcm90b3R5cGUsIFwiY291bnRcIiwge1xuICAgIGVudW1lcmFibGUgOiBmYWxzZSxcbiAgICB2YWx1ZShpdGVtOiBhbnksIHN0cmljdCA9IGZhbHNlKTogbnVtYmVyIHtcbiAgICAgICAgbGV0IF9jb3VudCA9IDA7XG4gICAgICAgIGZvciAoIGxldCB4IG9mIHRoaXMgKSB7XG4gICAgICAgICAgICBpZiAoIHN0cmljdCApIHtcbiAgICAgICAgICAgICAgICBpZiAoIHggPT09IGl0ZW0gKVxuICAgICAgICAgICAgICAgICAgICBfY291bnQrKztcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoIHggPT0gaXRlbSApIHtcbiAgICAgICAgICAgICAgICBfY291bnQrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX2NvdW50O1xuICAgICAgICBcbiAgICB9XG4gICAgXG59LCk7XG4vLyAqKiBTdHJpbmdcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcInVwVG9cIiwge1xuICAgIGVudW1lcmFibGUgOiBmYWxzZSxcbiAgICB2YWx1ZShzZWFyY2hTdHJpbmc6IHN0cmluZywgc2VhcmNoRnJvbUVuZCA9IGZhbHNlKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGVuZCA9IHNlYXJjaEZyb21FbmRcbiAgICAgICAgICAgID8gdGhpcy5sYXN0SW5kZXhPZihzZWFyY2hTdHJpbmcpXG4gICAgICAgICAgICA6IHRoaXMuaW5kZXhPZihzZWFyY2hTdHJpbmcpO1xuICAgICAgICBpZiAoIGVuZCA9PT0gLTEgKVxuICAgICAgICAgICAgY29uc29sZS53YXJuKGAke3RoaXMudmFsdWVPZigpfS51cFRvKCR7c2VhcmNoU3RyaW5nfSwke3NlYXJjaEZyb21FbmR9KSBpbmRleCBpcyAtMWApO1xuICAgICAgICByZXR1cm4gdGhpcy5zbGljZSgwLCBlbmQpO1xuICAgIH1cbn0sKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcImluXCIsIHtcbiAgICBlbnVtZXJhYmxlIDogZmFsc2UsXG4gICAgdmFsdWUoYXJyOiBhbnlbXSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gYXJyLmluY2x1ZGVzKHRoaXMudmFsdWVPZigpKTtcbiAgICB9XG59LCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoU3RyaW5nLnByb3RvdHlwZSwgXCJsb3dlclwiLCB7XG4gICAgZW51bWVyYWJsZSA6IGZhbHNlLFxuICAgIHZhbHVlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLnRvTG93ZXJDYXNlKCk7XG4gICAgfVxufSwpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZy5wcm90b3R5cGUsIFwidXBwZXJcIiwge1xuICAgIGVudW1lcmFibGUgOiBmYWxzZSxcbiAgICB2YWx1ZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy50b1VwcGVyQ2FzZSgpO1xuICAgIH1cbn0sKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcInRpdGxlXCIsIHtcbiAgICBlbnVtZXJhYmxlIDogZmFsc2UsXG4gICAgdmFsdWUoKTogc3RyaW5nIHtcbiAgICAgICAgXG4gICAgICAgIGlmICggdGhpcy5pbmNsdWRlcygnICcpIClcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNwbGl0KCcgJykubWFwKHN0ciA9PiBzdHIudGl0bGUoKSkuam9pbignICcpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4gdGhpc1swXS51cHBlcigpICsgdGhpcy5zbGljZSgxLCB0aGlzLmxlbmd0aCkubG93ZXIoKTtcbiAgICAgICAgXG4gICAgfVxufSwpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZy5wcm90b3R5cGUsIFwiaXNkaWdpdFwiLCB7XG4gICAgZW51bWVyYWJsZSA6IGZhbHNlLFxuICAgIHZhbHVlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gIWlzTmFOKE1hdGguZmxvb3IodGhpcykpO1xuICAgIH1cbn0sKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcInJlbW92ZUFsbFwiLCB7XG4gICAgZW51bWVyYWJsZSA6IGZhbHNlLFxuICAgIFxuICAgIHZhbHVlKHJlbW92ZVZhbHVlLCAuLi5yZW1vdmVWYWx1ZXMpIHtcbiAgICAgICAgbGV0IHRlbXAgPSB0aGlzO1xuICAgICAgICBmb3IgKCBsZXQgdmFsdWUgb2YgWyByZW1vdmVWYWx1ZSwgLi4ucmVtb3ZlVmFsdWVzIF0gKVxuICAgICAgICAgICAgdGVtcCA9IHRlbXAucmVwbGFjZUFsbCh2YWx1ZSwgJycpO1xuICAgICAgICByZXR1cm4gdGVtcDtcbiAgICB9XG59KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmcucHJvdG90eXBlLCBcInJlcGxhY2VBbGxcIiwge1xuICAgIGVudW1lcmFibGUgOiBmYWxzZSxcbiAgICBcbiAgICB2YWx1ZShzZWFyY2hWYWx1ZTogKHN0cmluZyB8IG51bWJlcikgfCBUTWFwPHN0cmluZz4sIHJlcGxhY2VWYWx1ZT86IHN0cmluZykge1xuICAgICAgICBjb25zdCB0eXBlID0gdHlwZW9mIHNlYXJjaFZhbHVlO1xuICAgICAgICBpZiAoIHR5cGUgPT09ICdzdHJpbmcnIHx8IHR5cGUgPT09ICdudW1iZXInICkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgICAgICAgICAuc3BsaXQoc2VhcmNoVmFsdWUpXG4gICAgICAgICAgICAgICAgLmpvaW4ocmVwbGFjZVZhbHVlKTtcbiAgICAgICAgfSBlbHNlIGlmICggdHlwZSA9PT0gJ29iamVjdCcgKSB7XG4gICAgICAgICAgICBsZXQgdGVtcCA9IHRoaXM7XG4gICAgICAgICAgICBmb3IgKCBsZXQgWyBzdiwgcnYgXSBvZiBPYmplY3QuZW50cmllcyhzZWFyY2hWYWx1ZSkgKVxuICAgICAgICAgICAgICAgIHRlbXAgPSB0ZW1wLnJlcGxhY2VBbGwoc3YsIHJ2KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHRlbXA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYHJlcGxhY2VBbGwgZ290IGEgYmFkIHR5cGUsIHNlYXJjaFZhbHVlOiAke3NlYXJjaFZhbHVlfSwgdHlwZTogJHt0eXBlfWApO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbi8vICoqICBOdW1iZXJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShOdW1iZXIucHJvdG90eXBlLCBcImh1bWFuXCIsIHtcbiAgICBlbnVtZXJhYmxlIDogZmFsc2UsXG4gICAgdmFsdWUobGV0dGVycyA9IGZhbHNlKSB7XG4gICAgICAgIHN3aXRjaCAoIE1hdGguZmxvb3IodGhpcykgKyAxICkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJ6ZXJvdGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMHRoXCI7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcImZpcnN0XCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjFzdFwiO1xuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJzZWNvbmRcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiMm5kXCI7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcInRoaXJkXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjNyZFwiO1xuICAgICAgICAgICAgY2FzZSA0OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJmb3VydGhcIlxuICAgICAgICAgICAgICAgICAgICA6IFwiNHRoXCI7XG4gICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldHRlcnNcbiAgICAgICAgICAgICAgICAgICAgPyBcImZpZnRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjV0aFwiO1xuICAgICAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJzaXh0aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCI2dGhcIjtcbiAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwic2V2ZW50aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCI3dGhcIjtcbiAgICAgICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgICAgICByZXR1cm4gbGV0dGVyc1xuICAgICAgICAgICAgICAgICAgICA/IFwiZWlnaHRoXCJcbiAgICAgICAgICAgICAgICAgICAgOiBcIjh0aFwiO1xuICAgICAgICAgICAgY2FzZSA5OlxuICAgICAgICAgICAgICAgIHJldHVybiBsZXR0ZXJzXG4gICAgICAgICAgICAgICAgICAgID8gXCJuaW50aFwiXG4gICAgICAgICAgICAgICAgICAgIDogXCI5dGhcIjtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7TWF0aC5mbG9vcih0aGlzKSArIDF9dGhgO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cbn0pO1xuLy8gKiogIERhdGVcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShEYXRlLnByb3RvdHlwZSwgXCJodW1hblwiLCB7XG4gICAgZW51bWVyYWJsZSA6IGZhbHNlLCB2YWx1ZSgpIHtcbiAgICAgICAgbGV0IGQgPSB0aGlzLmdldFVUQ0RhdGUoKTtcbiAgICAgICAgZCA9IGQgPCAxMCA/IGAwJHtkfWAgOiBkO1xuICAgICAgICBsZXQgbSA9IHRoaXMuZ2V0TW9udGgoKSArIDE7XG4gICAgICAgIG0gPSBtIDwgMTAgPyBgMCR7bX1gIDogbTtcbiAgICAgICAgY29uc3QgeSA9IHRoaXMuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMudG9UaW1lU3RyaW5nKCkuc2xpY2UoMCwgOCkucmVwbGFjZUFsbCgnOicsICctJyk7XG4gICAgICAgIHJldHVybiBgJHtkfV8ke219XyR7eX1fJHt0fWA7XG4gICAgfVxufSk7XG5sZXQgc2tpcEZhZGUgPSBmYWxzZTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgc2tpcEZhZGUsXG4gICAgLy8gU3RvcmUsXG4gICAgUHl0aG9uU2hlbGxcbn07XG5jb25zb2xlLmdyb3VwRW5kKCk7XG4iXX0=