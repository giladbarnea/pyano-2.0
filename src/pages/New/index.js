"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Glob_1 = require("../../Glob");
const util = require("../../util");
const sidebar_1 = require("../sidebar");
const sections_1 = require("./sections");
const bhe_1 = require("../../bhe");
const MyAlert_1 = require("../../MyAlert");
const path = require("path");
const electron_1 = require("electron");
async function load(reload) {
    console.log(`New.index.load(reload=${reload})`);
    Glob_1.default.BigConfig.last_page = "new";
    if (reload) {
        return util.reloadPage();
    }
    sidebar_1.default.select("new", { changeTitle: true });
    const startButton = bhe_1.button({ cls: 'green', html: 'Start Experiment', setid: 'start_experiment_button' })
        .click(async () => {
        const subconfig = Glob_1.default.BigConfig.getSubconfig();
        let html = subconfig.toHtml();
        let action = await MyAlert_1.default.big.threeButtons({
            title: `Please make sure that the loaded config, "${subconfig.name}", is fine.`,
            html,
            confirmButtonText: `It's ok, start experiment`,
            thirdButtonText: 'Open configs directory in file browser'
        });
        switch (action) {
            case "cancel":
                return;
            case "confirm":
                return startIfReady(subconfig);
            case "third":
                return electron_1.remote.shell.showItemInFolder(path.join(CONFIGS_PATH_ABS, subconfig.name));
        }
    });
    Glob_1.default.MainContent.append(sections_1.default.settings, startButton);
}
exports.load = load;
async function startIfReady(subconfig) {
    const missingTxts = subconfig.truth.txt.getMissing();
    if (util.bool(missingTxts)) {
        return MyAlert_1.default.big.oneButton({ title: `The truth: "${subconfig.truth.name}" is missing the following txt files:`,
            text: missingTxts.join(', ') });
    }
    if (!subconfig.truth.midi.exists()) {
        if (!Glob_1.default.BigConfig.dev.skip_midi_exists_check()) {
            return MyAlert_1.default.big.oneButton({ title: `The truth: "${subconfig.truth.name}" is missing a midi file` });
        }
    }
    if (subconfig.demo_type === "video") {
        const mp4Exists = subconfig.truth.mp4.exists();
        const onsetsExists = subconfig.truth.onsets.exists();
        if (!util.all(mp4Exists, onsetsExists)) {
            const missingNames = [];
            if (!mp4Exists)
                missingNames.push("mp4");
            if (!onsetsExists)
                missingNames.push("onsets");
            return MyAlert_1.default.big.oneButton({
                title: `The truth: "${subconfig.truth.name}" is missing the following files:`,
                text: missingNames.join(', ')
            });
        }
    }
    const mustHaveValue = [
        "allowed_rhythm_deviation",
        "allowed_tempo_deviation",
        "errors_playrate",
        "subject",
        "truth_file",
        "levels",
    ];
    const missingValues = [];
    for (let key of mustHaveValue) {
        if (!util.bool(subconfig[key])) {
            missingValues.push(key);
        }
    }
    if (util.bool(missingValues)) {
        return MyAlert_1.default.big.oneButton({
            title: `The following keys in ${subconfig.name} are missing values:`,
            text: missingValues.join(', ')
        });
    }
    const levelCollection = subconfig.getLevelCollection();
    const badLevels = levelCollection.badLevels();
    if (util.bool(badLevels)) {
        return MyAlert_1.default.big.oneButton({
            title: `The following levels in ${subconfig.name} have invalid values: (0-index)`,
            text: badLevels.join(', ')
        });
    }
    return require('../Running').load(true);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHFDQUE4QjtBQUM5QixtQ0FBa0M7QUFDbEMsd0NBQWlDO0FBQ2pDLHlDQUFpQztBQUNqQyxtQ0FBbUM7QUFDbkMsMkNBQW1DO0FBQ25DLDZCQUE2QjtBQUM3Qix1Q0FBa0M7QUFNbEMsS0FBSyxVQUFVLElBQUksQ0FBQyxNQUFlO0lBQy9CLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDaEQsY0FBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO0lBQ2pDLElBQUssTUFBTSxFQUFHO1FBQ1YsT0FBTyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7S0FDNUI7SUFDRCxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsRUFBRSxXQUFXLEVBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUM5QyxNQUFNLFdBQVcsR0FBRyxZQUFNLENBQUMsRUFBRSxHQUFHLEVBQUcsT0FBTyxFQUFFLElBQUksRUFBRyxrQkFBa0IsRUFBRSxLQUFLLEVBQUcseUJBQXlCLEVBQUUsQ0FBQztTQUN0RyxLQUFLLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFLZCxNQUFNLFNBQVMsR0FBRyxjQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBR2hELElBQUksSUFBSSxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUM5QixJQUFJLE1BQU0sR0FBRyxNQUFNLGlCQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQztZQUN4QyxLQUFLLEVBQUcsNkNBQTZDLFNBQVMsQ0FBQyxJQUFJLGFBQWE7WUFDaEYsSUFBSTtZQUNKLGlCQUFpQixFQUFHLDJCQUEyQjtZQUMvQyxlQUFlLEVBQUcsd0NBQXdDO1NBQzdELENBQUMsQ0FBQztRQUNILFFBQVMsTUFBTSxFQUFHO1lBQ2QsS0FB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QUFFLHlCQUF5QixTQUFTLENBQUMsSUFBSSxzQkFBc0I7WUFDcEUsSUFBSSxFQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQ2xDLENBQUMsQ0FBQTtLQUNMO0lBQ0QsTUFBTSxlQUFlLEdBQUcsU0FBUyxDQUFDLGtCQUFrQixFQUFFLENBQUM7SUFDdkQsTUFBTSxTQUFTLEdBQUcsZUFBZSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQzlDLElBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRztRQUN4QixPQUFPLGlCQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQztZQUN6QixLQUFLLEVBQUUsMkJBQTJCLFNBQVMsQ0FBQyxJQUFJLGlDQUFpQztZQUNqRixJQUFJLEVBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDOUIsQ0FBQyxDQUFBO0tBQ0w7SUFFRCxPQUFPLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDNUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKmltcG9ydCBuZXdQYWdlIGZyb20gXCIuL05ld1wiOyovXG5pbXBvcnQgR2xvYiBmcm9tIFwiLi4vLi4vR2xvYlwiO1xuaW1wb3J0ICogYXMgdXRpbCBmcm9tICcuLi8uLi91dGlsJ1xuaW1wb3J0IHNpZGViYXIgZnJvbSBcIi4uL3NpZGViYXJcIjtcbmltcG9ydCBzZWN0aW9ucyBmcm9tIFwiLi9zZWN0aW9uc1wiXG5pbXBvcnQgeyBidXR0b24gfSBmcm9tIFwiLi4vLi4vYmhlXCI7XG5pbXBvcnQgTXlBbGVydCBmcm9tICcuLi8uLi9NeUFsZXJ0J1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHsgcmVtb3RlIH0gZnJvbSAnZWxlY3Ryb24nO1xuaW1wb3J0IHsgU3ViY29uZmlnIH0gZnJvbSBcIi4uLy4uL015U3RvcmVcIjtcblxuLy8gaW1wb3J0ICogYXMgcnVubmluZ1BhZ2UgZnJvbSBcIi4uL1J1bm5pbmdcIlxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvYWQocmVsb2FkOiBib29sZWFuKSB7XG4gICAgY29uc29sZS5sb2coYE5ldy5pbmRleC5sb2FkKHJlbG9hZD0ke3JlbG9hZH0pYCk7XG4gICAgR2xvYi5CaWdDb25maWcubGFzdF9wYWdlID0gXCJuZXdcIjtcbiAgICBpZiAoIHJlbG9hZCApIHtcbiAgICAgICAgcmV0dXJuIHV0aWwucmVsb2FkUGFnZSgpO1xuICAgIH1cbiAgICBzaWRlYmFyLnNlbGVjdChcIm5ld1wiLCB7IGNoYW5nZVRpdGxlIDogdHJ1ZSB9KTtcbiAgICBjb25zdCBzdGFydEJ1dHRvbiA9IGJ1dHRvbih7IGNscyA6ICdncmVlbicsIGh0bWwgOiAnU3RhcnQgRXhwZXJpbWVudCcsIHNldGlkIDogJ3N0YXJ0X2V4cGVyaW1lbnRfYnV0dG9uJyB9KVxuICAgICAgICAuY2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgLypsZXQgdGVtcGxhdGUgPSB7XG4gICAgICAgICAgICAgJzw+JyA6ICdkaXYnLFxuICAgICAgICAgICAgICdodG1sJyA6IFsgJ0FsbG93ZWQgUmh5dGhtIERldmlhdGlvbjogJHthbGxvd2VkX3JoeXRobV9kZXZpYXRpb259J11cbiAgICAgICAgICAgICB9OyovXG4gICAgICAgICAgICBjb25zdCBzdWJjb25maWcgPSBHbG9iLkJpZ0NvbmZpZy5nZXRTdWJjb25maWcoKTtcbiAgICAgICAgICAgIC8vIGNvbnN0IGpzb24yaHRtbCA9IHJlcXVpcmUoXCJub2RlLWpzb24yaHRtbFwiKTtcbiAgICAgICAgICAgIC8vIGxldCBodG1sID0ganNvbjJodG1sLnRyYW5zZm9ybShzdWJjb25maWcuc3RvcmUsIHRlbXBsYXRlKTtcbiAgICAgICAgICAgIGxldCBodG1sID0gc3ViY29uZmlnLnRvSHRtbCgpO1xuICAgICAgICAgICAgbGV0IGFjdGlvbiA9IGF3YWl0IE15QWxlcnQuYmlnLnRocmVlQnV0dG9ucyh7XG4gICAgICAgICAgICAgICAgdGl0bGUgOiBgUGxlYXNlIG1ha2Ugc3VyZSB0aGF0IHRoZSBsb2FkZWQgY29uZmlnLCBcIiR7c3ViY29uZmlnLm5hbWV9XCIsIGlzIGZpbmUuYCxcbiAgICAgICAgICAgICAgICBodG1sLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0IDogYEl0J3Mgb2ssIHN0YXJ0IGV4cGVyaW1lbnRgLFxuICAgICAgICAgICAgICAgIHRoaXJkQnV0dG9uVGV4dCA6ICdPcGVuIGNvbmZpZ3MgZGlyZWN0b3J5IGluIGZpbGUgYnJvd3NlcidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc3dpdGNoICggYWN0aW9uICkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjYW5jZWxcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGNhc2UgXCJjb25maXJtXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGFydElmUmVhZHkoc3ViY29uZmlnKTtcbiAgICAgICAgICAgICAgICBjYXNlIFwidGhpcmRcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlbW90ZS5zaGVsbC5zaG93SXRlbUluRm9sZGVyKHBhdGguam9pbihDT05GSUdTX1BBVEhfQUJTLCBzdWJjb25maWcubmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgfSk7XG4gICAgR2xvYi5NYWluQ29udGVudC5hcHBlbmQoXG4gICAgICAgIC8vIHNlY3Rpb25zLmxldmVscyxcbiAgICAgICAgc2VjdGlvbnMuc2V0dGluZ3MsXG4gICAgICAgIHN0YXJ0QnV0dG9uXG4gICAgKTtcbiAgICBcbiAgICBcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3RhcnRJZlJlYWR5KHN1YmNvbmZpZzogU3ViY29uZmlnKSB7XG4gICAgY29uc3QgbWlzc2luZ1R4dHMgPSBzdWJjb25maWcudHJ1dGgudHh0LmdldE1pc3NpbmcoKTtcbiAgICBcbiAgICBpZiAoIHV0aWwuYm9vbChtaXNzaW5nVHh0cykgKSB7XG4gICAgICAgIHJldHVybiBNeUFsZXJ0LmJpZy5vbmVCdXR0b24oeyB0aXRsZTogYFRoZSB0cnV0aDogXCIke3N1YmNvbmZpZy50cnV0aC5uYW1lfVwiIGlzIG1pc3NpbmcgdGhlIGZvbGxvd2luZyB0eHQgZmlsZXM6YCxcbiAgICAgICAgICAgIHRleHQgOiBtaXNzaW5nVHh0cy5qb2luKCcsICcpIH0pXG4gICAgfVxuICAgIC8vIC8gVHh0cyBleGlzdFxuICAgIGlmICggIXN1YmNvbmZpZy50cnV0aC5taWRpLmV4aXN0cygpICkge1xuICAgICAgICBpZiAoICFHbG9iLkJpZ0NvbmZpZy5kZXYuc2tpcF9taWRpX2V4aXN0c19jaGVjaygpICkge1xuICAgICAgICAgICAgcmV0dXJuIE15QWxlcnQuYmlnLm9uZUJ1dHRvbih7dGl0bGU6IGBUaGUgdHJ1dGg6IFwiJHtzdWJjb25maWcudHJ1dGgubmFtZX1cIiBpcyBtaXNzaW5nIGEgbWlkaSBmaWxlYH0pXG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gLyBtaWRpIGV4aXN0XG4gICAgaWYgKCBzdWJjb25maWcuZGVtb190eXBlID09PSBcInZpZGVvXCIgKSB7XG4gICAgICAgIGNvbnN0IG1wNEV4aXN0cyA9IHN1YmNvbmZpZy50cnV0aC5tcDQuZXhpc3RzKCk7XG4gICAgICAgIGNvbnN0IG9uc2V0c0V4aXN0cyA9IHN1YmNvbmZpZy50cnV0aC5vbnNldHMuZXhpc3RzKCk7XG4gICAgICAgIGlmICggIXV0aWwuYWxsKG1wNEV4aXN0cywgb25zZXRzRXhpc3RzKSApIHtcbiAgICAgICAgICAgIGNvbnN0IG1pc3NpbmdOYW1lcyA9IFtdO1xuICAgICAgICAgICAgaWYgKCAhbXA0RXhpc3RzIClcbiAgICAgICAgICAgICAgICBtaXNzaW5nTmFtZXMucHVzaChcIm1wNFwiKTtcbiAgICAgICAgICAgIGlmICggIW9uc2V0c0V4aXN0cyApXG4gICAgICAgICAgICAgICAgbWlzc2luZ05hbWVzLnB1c2goXCJvbnNldHNcIik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBNeUFsZXJ0LmJpZy5vbmVCdXR0b24oe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBgVGhlIHRydXRoOiBcIiR7c3ViY29uZmlnLnRydXRoLm5hbWV9XCIgaXMgbWlzc2luZyB0aGUgZm9sbG93aW5nIGZpbGVzOmAsXG4gICAgICAgICAgICAgICAgdGV4dCA6IG1pc3NpbmdOYW1lcy5qb2luKCcsICcpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IG11c3RIYXZlVmFsdWUgPSBbXG4gICAgICAgIFwiYWxsb3dlZF9yaHl0aG1fZGV2aWF0aW9uXCIsXG4gICAgICAgIFwiYWxsb3dlZF90ZW1wb19kZXZpYXRpb25cIixcbiAgICAgICAgXCJlcnJvcnNfcGxheXJhdGVcIixcbiAgICAgICAgXCJzdWJqZWN0XCIsXG4gICAgICAgIFwidHJ1dGhfZmlsZVwiLFxuICAgICAgICBcImxldmVsc1wiLFxuICAgIF07XG4gICAgY29uc3QgbWlzc2luZ1ZhbHVlcyA9IFtdO1xuICAgIGZvciAoIGxldCBrZXkgb2YgbXVzdEhhdmVWYWx1ZSApIHtcbiAgICAgICAgaWYgKCAhdXRpbC5ib29sKHN1YmNvbmZpZ1trZXldKSApIHtcbiAgICAgICAgICAgIG1pc3NpbmdWYWx1ZXMucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmICggdXRpbC5ib29sKG1pc3NpbmdWYWx1ZXMpICkge1xuICAgICAgICByZXR1cm4gTXlBbGVydC5iaWcub25lQnV0dG9uKHtcbiAgICAgICAgICAgIHRpdGxlOiBgVGhlIGZvbGxvd2luZyBrZXlzIGluICR7c3ViY29uZmlnLm5hbWV9IGFyZSBtaXNzaW5nIHZhbHVlczpgLFxuICAgICAgICAgICAgdGV4dCA6IG1pc3NpbmdWYWx1ZXMuam9pbignLCAnKVxuICAgICAgICB9KVxuICAgIH1cbiAgICBjb25zdCBsZXZlbENvbGxlY3Rpb24gPSBzdWJjb25maWcuZ2V0TGV2ZWxDb2xsZWN0aW9uKCk7XG4gICAgY29uc3QgYmFkTGV2ZWxzID0gbGV2ZWxDb2xsZWN0aW9uLmJhZExldmVscygpO1xuICAgIGlmICggdXRpbC5ib29sKGJhZExldmVscykgKSB7XG4gICAgICAgIHJldHVybiBNeUFsZXJ0LmJpZy5vbmVCdXR0b24oe1xuICAgICAgICAgICAgdGl0bGU6IGBUaGUgZm9sbG93aW5nIGxldmVscyBpbiAke3N1YmNvbmZpZy5uYW1lfSBoYXZlIGludmFsaWQgdmFsdWVzOiAoMC1pbmRleClgLFxuICAgICAgICAgICAgdGV4dCA6IGJhZExldmVscy5qb2luKCcsICcpXG4gICAgICAgIH0pXG4gICAgfVxuICAgIC8vIC8gbXA0IGFuZCBvbnNldHMgZXhpc3RcbiAgICByZXR1cm4gcmVxdWlyZSgnLi4vUnVubmluZycpLmxvYWQodHJ1ZSk7XG59XG5cbmV4cG9ydCB7IGxvYWQgfVxuIl19