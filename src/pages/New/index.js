"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Glob_1 = require("../../Glob");
const util = require("../../util");
const sidebar_1 = require("../sidebar");
const sections_1 = require("./sections");
const bhe_1 = require("../../bhe");
const MyAlert_1 = require("../../MyAlert");
const path = require("path");
const electron_1 = require("electron");
async function load(reload) {
    console.log(`New.index.load(reload=${reload})`);
    Glob_1.default.BigConfig.last_page = "new";
    if (reload) {
        return util.reloadPage();
    }
    sidebar_1.default.select("new", { changeTitle: true });
    const startButton = bhe_1.button({ cls: 'green', html: 'Start Experiment', id: 'start_experiment_button' })
        .click(async () => {
        const subconfig = Glob_1.default.BigConfig.getSubconfig();
        let html = subconfig.toHtml();
        let action = await MyAlert_1.default.big.threeButtons({
            title: `Please make sure that the loaded config, "${subconfig.name}", is fine.`,
            html,
            confirmButtonText: `It's ok, start experiment`,
            thirdButtonText: 'Open configs directory in file browser'
        });
        switch (action) {
            case "cancel":
                return;
            case "confirm":
                return startIfReady(subconfig);
            case "third":
                return electron_1.remote.shell.showItemInFolder(path.join(CONFIGS_PATH_ABS, subconfig.name));
        }
    });
    Glob_1.default.MainContent.append(sections_1.default.settings, startButton);
}
exports.load = load;
async function startIfReady(subconfig) {
    const missingTxts = subconfig.truth.txt.getMissing();
    if (util.bool(missingTxts)) {
        return MyAlert_1.default.big.oneButton(`The truth: "${subconfig.truth.name}" is missing the following txt files:`, { text: missingTxts.join(', ') });
    }
    if (!subconfig.truth.midi.exists()) {
        if (!Glob_1.default.BigConfig.dev.skip_midi_exists_check()) {
            return MyAlert_1.default.big.oneButton(`The truth: "${subconfig.truth.name}" is missing a midi file`);
        }
    }
    if (subconfig.demo_type === "video") {
        const mp4Exists = subconfig.truth.mp4.exists();
        const onsetsExists = subconfig.truth.onsets.exists();
        if (!util.all(mp4Exists, onsetsExists)) {
            const missingNames = [];
            if (!mp4Exists)
                missingNames.push("mp4");
            if (!onsetsExists)
                missingNames.push("onsets");
            return MyAlert_1.default.big.oneButton(`The truth: "${subconfig.truth.name}" is missing the following files:`, {
                text: missingNames.join(', ')
            });
        }
    }
    const mustHaveValue = [
        "allowed_rhythm_deviation",
        "allowed_tempo_deviation",
        "errors_playrate",
        "subject",
        "truth_file",
        "levels",
    ];
    const missingValues = [];
    for (let key of mustHaveValue) {
        if (!util.bool(subconfig[key])) {
            missingValues.push(key);
        }
    }
    if (util.bool(missingValues)) {
        return MyAlert_1.default.big.oneButton(`The following keys in ${subconfig.name} are missing values:`, {
            text: missingValues.join(', ')
        });
    }
    const levelCollection = subconfig.getLevelCollection();
    const badLevels = levelCollection.badLevels();
    if (util.bool(badLevels)) {
        return MyAlert_1.default.big.oneButton(`The following levels in ${subconfig.name} have invalid values: (0-index)`, {
            text: badLevels.join(', ')
        });
    }
    return require('../Running').load(true);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHFDQUE4QjtBQUM5QixtQ0FBa0M7QUFDbEMsd0NBQWlDO0FBQ2pDLHlDQUFpQztBQUNqQyxtQ0FBbUM7QUFDbkMsMkNBQW1DO0FBQ25DLDZCQUE2QjtBQUM3Qix1Q0FBa0M7QUFNbEMsS0FBSyxVQUFVLElBQUksQ0FBQyxNQUFlO0lBQy9CLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDaEQsY0FBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO0lBQ2pDLElBQUssTUFBTSxFQUFHO1FBQ1YsT0FBTyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7S0FDNUI7SUFDRCxpQkFBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsRUFBRSxXQUFXLEVBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUM5QyxNQUFNLFdBQVcsR0FBRyxZQUFNLENBQUMsRUFBRSxHQUFHLEVBQUcsT0FBTyxFQUFFLElBQUksRUFBRyxrQkFBa0IsRUFBRSxFQUFFLEVBQUcseUJBQXlCLEVBQUUsQ0FBQztTQUNuRyxLQUFLLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFLZCxNQUFNLFNBQVMsR0FBRyxjQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBR2hELElBQUksSUFBSSxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUM5QixJQUFJLE1BQU0sR0FBRyxNQUFNLGlCQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQztZQUN4QyxLQUFLLEVBQUcsNkNBQTZDLFNBQVMsQ0FBQyxJQUFJLGFBQWE7WUFDaEYsSUFBSTtZQUNKLGlCQUFpQixFQUFHLDJCQUEyQjtZQUMvQyxlQUFlLEVBQUcsd0NBQXdDO1NBQzdELENBQUMsQ0FBQztRQUNILFFBQVMsTUFBTSxFQUFHO1lBQ2QsS0FB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Q0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQ2xDLENBQUMsQ0FBQTtLQUNMO0lBQ0QsTUFBTSxlQUFlLEdBQUcsU0FBUyxDQUFDLGtCQUFrQixFQUFFLENBQUM7SUFDdkQsTUFBTSxTQUFTLEdBQUcsZUFBZSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQzlDLElBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRztRQUN4QixPQUFPLGlCQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQywyQkFBMkIsU0FBUyxDQUFDLElBQUksaUNBQWlDLEVBQUU7WUFDckcsSUFBSSxFQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQzlCLENBQUMsQ0FBQTtLQUNMO0lBRUQsT0FBTyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzVDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKippbXBvcnQgbmV3UGFnZSBmcm9tIFwiLi9OZXdcIjsqL1xuaW1wb3J0IEdsb2IgZnJvbSBcIi4uLy4uL0dsb2JcIjtcbmltcG9ydCAqIGFzIHV0aWwgZnJvbSAnLi4vLi4vdXRpbCdcbmltcG9ydCBzaWRlYmFyIGZyb20gXCIuLi9zaWRlYmFyXCI7XG5pbXBvcnQgc2VjdGlvbnMgZnJvbSBcIi4vc2VjdGlvbnNcIlxuaW1wb3J0IHsgYnV0dG9uIH0gZnJvbSBcIi4uLy4uL2JoZVwiO1xuaW1wb3J0IE15QWxlcnQgZnJvbSAnLi4vLi4vTXlBbGVydCdcbmltcG9ydCAqIGFzIHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCB7IHJlbW90ZSB9IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCB7IFN1YmNvbmZpZyB9IGZyb20gXCIuLi8uLi9NeVN0b3JlXCI7XG5cbi8vIGltcG9ydCAqIGFzIHJ1bm5pbmdQYWdlIGZyb20gXCIuLi9SdW5uaW5nXCJcblxuXG5hc3luYyBmdW5jdGlvbiBsb2FkKHJlbG9hZDogYm9vbGVhbikge1xuICAgIGNvbnNvbGUubG9nKGBOZXcuaW5kZXgubG9hZChyZWxvYWQ9JHtyZWxvYWR9KWApO1xuICAgIEdsb2IuQmlnQ29uZmlnLmxhc3RfcGFnZSA9IFwibmV3XCI7XG4gICAgaWYgKCByZWxvYWQgKSB7XG4gICAgICAgIHJldHVybiB1dGlsLnJlbG9hZFBhZ2UoKTtcbiAgICB9XG4gICAgc2lkZWJhci5zZWxlY3QoXCJuZXdcIiwgeyBjaGFuZ2VUaXRsZSA6IHRydWUgfSk7XG4gICAgY29uc3Qgc3RhcnRCdXR0b24gPSBidXR0b24oeyBjbHMgOiAnZ3JlZW4nLCBodG1sIDogJ1N0YXJ0IEV4cGVyaW1lbnQnLCBpZCA6ICdzdGFydF9leHBlcmltZW50X2J1dHRvbicgfSlcbiAgICAgICAgLmNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIC8qbGV0IHRlbXBsYXRlID0ge1xuICAgICAgICAgICAgICc8PicgOiAnZGl2JyxcbiAgICAgICAgICAgICAnaHRtbCcgOiBbICdBbGxvd2VkIFJoeXRobSBEZXZpYXRpb246ICR7YWxsb3dlZF9yaHl0aG1fZGV2aWF0aW9ufSddXG4gICAgICAgICAgICAgfTsqL1xuICAgICAgICAgICAgY29uc3Qgc3ViY29uZmlnID0gR2xvYi5CaWdDb25maWcuZ2V0U3ViY29uZmlnKCk7XG4gICAgICAgICAgICAvLyBjb25zdCBqc29uMmh0bWwgPSByZXF1aXJlKFwibm9kZS1qc29uMmh0bWxcIik7XG4gICAgICAgICAgICAvLyBsZXQgaHRtbCA9IGpzb24yaHRtbC50cmFuc2Zvcm0oc3ViY29uZmlnLnN0b3JlLCB0ZW1wbGF0ZSk7XG4gICAgICAgICAgICBsZXQgaHRtbCA9IHN1YmNvbmZpZy50b0h0bWwoKTtcbiAgICAgICAgICAgIGxldCBhY3Rpb24gPSBhd2FpdCBNeUFsZXJ0LmJpZy50aHJlZUJ1dHRvbnMoe1xuICAgICAgICAgICAgICAgIHRpdGxlIDogYFBsZWFzZSBtYWtlIHN1cmUgdGhhdCB0aGUgbG9hZGVkIGNvbmZpZywgXCIke3N1YmNvbmZpZy5uYW1lfVwiLCBpcyBmaW5lLmAsXG4gICAgICAgICAgICAgICAgaHRtbCxcbiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dCA6IGBJdCdzIG9rLCBzdGFydCBleHBlcmltZW50YCxcbiAgICAgICAgICAgICAgICB0aGlyZEJ1dHRvblRleHQgOiAnT3BlbiBjb25maWdzIGRpcmVjdG9yeSBpbiBmaWxlIGJyb3dzZXInXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHN3aXRjaCAoIGFjdGlvbiApIHtcbiAgICAgICAgICAgICAgICBjYXNlIFwiY2FuY2VsXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBjYXNlIFwiY29uZmlybVwiOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3RhcnRJZlJlYWR5KHN1YmNvbmZpZyk7XG4gICAgICAgICAgICAgICAgY2FzZSBcInRoaXJkXCI6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZW1vdGUuc2hlbGwuc2hvd0l0ZW1JbkZvbGRlcihwYXRoLmpvaW4oQ09ORklHU19QQVRIX0FCUywgc3ViY29uZmlnLm5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgXG4gICAgICAgIH0pO1xuICAgIEdsb2IuTWFpbkNvbnRlbnQuYXBwZW5kKFxuICAgICAgICAvLyBzZWN0aW9ucy5sZXZlbHMsXG4gICAgICAgIHNlY3Rpb25zLnNldHRpbmdzLFxuICAgICAgICBzdGFydEJ1dHRvblxuICAgICk7XG4gICAgXG4gICAgXG59XG5cbmFzeW5jIGZ1bmN0aW9uIHN0YXJ0SWZSZWFkeShzdWJjb25maWc6IFN1YmNvbmZpZykge1xuICAgIGNvbnN0IG1pc3NpbmdUeHRzID0gc3ViY29uZmlnLnRydXRoLnR4dC5nZXRNaXNzaW5nKCk7XG4gICAgXG4gICAgaWYgKCB1dGlsLmJvb2wobWlzc2luZ1R4dHMpICkge1xuICAgICAgICByZXR1cm4gTXlBbGVydC5iaWcub25lQnV0dG9uKGBUaGUgdHJ1dGg6IFwiJHtzdWJjb25maWcudHJ1dGgubmFtZX1cIiBpcyBtaXNzaW5nIHRoZSBmb2xsb3dpbmcgdHh0IGZpbGVzOmAsIHsgdGV4dCA6IG1pc3NpbmdUeHRzLmpvaW4oJywgJykgfSlcbiAgICB9XG4gICAgLy8gLyBUeHRzIGV4aXN0XG4gICAgaWYgKCAhc3ViY29uZmlnLnRydXRoLm1pZGkuZXhpc3RzKCkgKSB7XG4gICAgICAgIGlmICggIUdsb2IuQmlnQ29uZmlnLmRldi5za2lwX21pZGlfZXhpc3RzX2NoZWNrKCkgKSB7XG4gICAgICAgICAgICByZXR1cm4gTXlBbGVydC5iaWcub25lQnV0dG9uKGBUaGUgdHJ1dGg6IFwiJHtzdWJjb25maWcudHJ1dGgubmFtZX1cIiBpcyBtaXNzaW5nIGEgbWlkaSBmaWxlYClcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyAvIG1pZGkgZXhpc3RcbiAgICBpZiAoIHN1YmNvbmZpZy5kZW1vX3R5cGUgPT09IFwidmlkZW9cIiApIHtcbiAgICAgICAgY29uc3QgbXA0RXhpc3RzID0gc3ViY29uZmlnLnRydXRoLm1wNC5leGlzdHMoKTtcbiAgICAgICAgY29uc3Qgb25zZXRzRXhpc3RzID0gc3ViY29uZmlnLnRydXRoLm9uc2V0cy5leGlzdHMoKTtcbiAgICAgICAgaWYgKCAhdXRpbC5hbGwobXA0RXhpc3RzLCBvbnNldHNFeGlzdHMpICkge1xuICAgICAgICAgICAgY29uc3QgbWlzc2luZ05hbWVzID0gW107XG4gICAgICAgICAgICBpZiAoICFtcDRFeGlzdHMgKVxuICAgICAgICAgICAgICAgIG1pc3NpbmdOYW1lcy5wdXNoKFwibXA0XCIpO1xuICAgICAgICAgICAgaWYgKCAhb25zZXRzRXhpc3RzIClcbiAgICAgICAgICAgICAgICBtaXNzaW5nTmFtZXMucHVzaChcIm9uc2V0c1wiKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIE15QWxlcnQuYmlnLm9uZUJ1dHRvbihgVGhlIHRydXRoOiBcIiR7c3ViY29uZmlnLnRydXRoLm5hbWV9XCIgaXMgbWlzc2luZyB0aGUgZm9sbG93aW5nIGZpbGVzOmAsIHtcbiAgICAgICAgICAgICAgICB0ZXh0IDogbWlzc2luZ05hbWVzLmpvaW4oJywgJylcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgbXVzdEhhdmVWYWx1ZSA9IFtcbiAgICAgICAgXCJhbGxvd2VkX3JoeXRobV9kZXZpYXRpb25cIixcbiAgICAgICAgXCJhbGxvd2VkX3RlbXBvX2RldmlhdGlvblwiLFxuICAgICAgICBcImVycm9yc19wbGF5cmF0ZVwiLFxuICAgICAgICBcInN1YmplY3RcIixcbiAgICAgICAgXCJ0cnV0aF9maWxlXCIsXG4gICAgICAgIFwibGV2ZWxzXCIsXG4gICAgXTtcbiAgICBjb25zdCBtaXNzaW5nVmFsdWVzID0gW107XG4gICAgZm9yICggbGV0IGtleSBvZiBtdXN0SGF2ZVZhbHVlICkge1xuICAgICAgICBpZiAoICF1dGlsLmJvb2woc3ViY29uZmlnW2tleV0pICkge1xuICAgICAgICAgICAgbWlzc2luZ1ZhbHVlcy5wdXNoKGtleSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCB1dGlsLmJvb2wobWlzc2luZ1ZhbHVlcykgKSB7XG4gICAgICAgIHJldHVybiBNeUFsZXJ0LmJpZy5vbmVCdXR0b24oYFRoZSBmb2xsb3dpbmcga2V5cyBpbiAke3N1YmNvbmZpZy5uYW1lfSBhcmUgbWlzc2luZyB2YWx1ZXM6YCwge1xuICAgICAgICAgICAgdGV4dCA6IG1pc3NpbmdWYWx1ZXMuam9pbignLCAnKVxuICAgICAgICB9KVxuICAgIH1cbiAgICBjb25zdCBsZXZlbENvbGxlY3Rpb24gPSBzdWJjb25maWcuZ2V0TGV2ZWxDb2xsZWN0aW9uKCk7XG4gICAgY29uc3QgYmFkTGV2ZWxzID0gbGV2ZWxDb2xsZWN0aW9uLmJhZExldmVscygpO1xuICAgIGlmICggdXRpbC5ib29sKGJhZExldmVscykgKSB7XG4gICAgICAgIHJldHVybiBNeUFsZXJ0LmJpZy5vbmVCdXR0b24oYFRoZSBmb2xsb3dpbmcgbGV2ZWxzIGluICR7c3ViY29uZmlnLm5hbWV9IGhhdmUgaW52YWxpZCB2YWx1ZXM6ICgwLWluZGV4KWAsIHtcbiAgICAgICAgICAgIHRleHQgOiBiYWRMZXZlbHMuam9pbignLCAnKVxuICAgICAgICB9KVxuICAgIH1cbiAgICAvLyAvIG1wNCBhbmQgb25zZXRzIGV4aXN0XG4gICAgcmV0dXJuIHJlcXVpcmUoJy4uL1J1bm5pbmcnKS5sb2FkKHRydWUpO1xufVxuXG5leHBvcnQgeyBsb2FkIH1cbiJdfQ==