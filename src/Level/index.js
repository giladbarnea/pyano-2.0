"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("../util");
class Level {
    constructor(level, index, internalTrialIndex) {
        if (index === undefined) {
            console.error(`Level ctor, index is undefined. Continuing with index=0`);
            index = 0;
        }
        const { notes, rhythm, tempo, trials } = level;
        this.notes = notes;
        this.rhythm = rhythm;
        this.tempo = tempo;
        this.trials = trials;
        this.index = index;
        this.internalTrialIndex = internalTrialIndex;
    }
    isFirstTrial() {
        if (this.internalTrialIndex === undefined)
            throw new Error("internalTrialIndex is undefined");
        return this.internalTrialIndex === 0;
    }
    isLastTrial() {
        return this.internalTrialIndex === this.trials - 1;
    }
    hasZeroes() {
        return !util_1.bool(this.notes) || !util_1.bool(this.trials);
    }
    valuesOk() {
        if (!util_1.bool(this.notes) || !util_1.bool(this.trials)) {
            return false;
        }
        if (this.rhythm) {
            if (!util_1.bool(this.tempo)) {
                return false;
            }
        }
        else {
            if (util_1.bool(this.tempo)) {
                return false;
            }
        }
        return true;
    }
}
exports.Level = Level;
class LevelCollection {
    constructor(levels, currentLevelIndex, currentInternalTrialIndex) {
        this._levels = levels.map((level, index) => new Level(level, index));
        if (currentLevelIndex !== undefined) {
            this.current = this._levels[currentLevelIndex];
            this.current.internalTrialIndex = currentInternalTrialIndex;
        }
    }
    get length() {
        return this._levels.length;
    }
    get previous() {
        return this.get(this.current.index - 1);
    }
    get(i) {
        return this._levels[i];
    }
    badLevels() {
        const badLevels = [];
        for (let [i, level] of util_1.enumerate(this._levels)) {
            if (!level.valuesOk()) {
                badLevels.push(`${i.human()} level `);
            }
        }
        return badLevels;
    }
    someHaveZeroes() {
        return this._levels.some(level => level.hasZeroes());
    }
    slicesByNotes() {
        let byNotes = {};
        for (let level of this._levels) {
            if (level.notes in byNotes)
                byNotes[level.notes].addLevel(level);
            else
                byNotes[level.notes] = new LevelCollection([level]);
        }
        return Object.values(byNotes);
    }
    addLevel(level) {
        this._levels.push(level);
    }
    getNextTempoOfThisNotes() {
        if (this.current.rhythm)
            return this.current.tempo;
        for (let i = this.current.index; i < this._levels.length; i++) {
            const lvl = this._levels[i];
            if (lvl.notes != this.current.notes)
                return 100;
            if (lvl.tempo != null)
                return lvl.tempo;
        }
        return 100;
    }
    isCurrentLastLevel() {
        return this.current.index == this.length - 1;
    }
    maxNotes() {
        return Math.max(...this._levels.map(lvl => lvl.notes));
    }
    [Symbol.iterator]() {
        return this._levels.values();
    }
}
exports.LevelCollection = LevelCollection;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLGtDQUEwQztBQVMxQyxNQUFhLEtBQUs7SUFRZCxZQUFZLEtBQWEsRUFBRSxLQUFhLEVBQUUsa0JBQTJCO1FBQ2pFLElBQUssS0FBSyxLQUFLLFNBQVMsRUFBRztZQUN2QixPQUFPLENBQUMsS0FBSyxDQUFDLHlEQUF5RCxDQUFDLENBQUM7WUFDekUsS0FBSyxHQUFHLENBQUMsQ0FBQztTQUNiO1FBQ0QsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxHQUFHLEtBQUssQ0FBQztRQUMvQyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsa0JBQWtCLEdBQUcsa0JBQWtCLENBQUM7SUFDakQsQ0FBQztJQUdELFlBQVk7UUFDUixJQUFLLElBQUksQ0FBQyxrQkFBa0IsS0FBSyxTQUFTO1lBQ3RDLE1BQU0sSUFBSSxLQUFLLENBQUMsaUNBQWlDLENBQUMsQ0FBQztRQUN2RCxPQUFPLElBQUksQ0FBQyxrQkFBa0IsS0FBSyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUdELFdBQVc7UUFDUCxPQUFPLElBQUksQ0FBQyxrQkFBa0IsS0FBSyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBR0QsU0FBUztRQUNMLE9BQU8sQ0FBQyxXQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNuRCxD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QUFDLE1BQU07WUFDcEIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztRQUM5QixLQUFNLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRztZQUM3RCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVCLElBQUssR0FBRyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUs7Z0JBQ2hDLE9BQU8sR0FBRyxDQUFDO1lBQ2YsSUFBSyxHQUFHLENBQUMsS0FBSyxJQUFJLElBQUk7Z0JBQ2xCLE9BQU8sR0FBRyxDQUFDLEtBQUssQ0FBQztTQUN4QjtRQUNELE9BQU8sR0FBRyxDQUFDO0lBQ2YsQ0FBQztJQUVELGtCQUFrQjtRQUNkLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVELFFBQVE7UUFDSixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFFRCxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7UUFDYixPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDakMsQ0FBQztDQUNKO0FBakZELDBDQWlGQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGJvb2wsIGVudW1lcmF0ZSB9IGZyb20gXCIuLi91dGlsXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUxldmVsIHtcbiAgICBub3RlczogbnVtYmVyO1xuICAgIHJoeXRobTogYm9vbGVhbjtcbiAgICB0ZW1wbzogbnVtYmVyIHwgbnVsbDtcbiAgICB0cmlhbHM6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIExldmVsIGltcGxlbWVudHMgSUxldmVsIHtcbiAgICByZWFkb25seSBub3RlczogbnVtYmVyO1xuICAgIHJlYWRvbmx5IHJoeXRobTogYm9vbGVhbjtcbiAgICByZWFkb25seSB0ZW1wbzogbnVtYmVyIHwgbnVsbDtcbiAgICByZWFkb25seSB0cmlhbHM6IG51bWJlcjtcbiAgICByZWFkb25seSBpbmRleDogbnVtYmVyO1xuICAgIGludGVybmFsVHJpYWxJbmRleDogbnVtYmVyO1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKGxldmVsOiBJTGV2ZWwsIGluZGV4OiBudW1iZXIsIGludGVybmFsVHJpYWxJbmRleD86IG51bWJlcikge1xuICAgICAgICBpZiAoIGluZGV4ID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGBMZXZlbCBjdG9yLCBpbmRleCBpcyB1bmRlZmluZWQuIENvbnRpbnVpbmcgd2l0aCBpbmRleD0wYCk7XG4gICAgICAgICAgICBpbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBub3Rlcywgcmh5dGhtLCB0ZW1wbywgdHJpYWxzIH0gPSBsZXZlbDtcbiAgICAgICAgdGhpcy5ub3RlcyA9IG5vdGVzO1xuICAgICAgICB0aGlzLnJoeXRobSA9IHJoeXRobTtcbiAgICAgICAgdGhpcy50ZW1wbyA9IHRlbXBvO1xuICAgICAgICB0aGlzLnRyaWFscyA9IHRyaWFscztcbiAgICAgICAgdGhpcy5pbmRleCA9IGluZGV4O1xuICAgICAgICB0aGlzLmludGVybmFsVHJpYWxJbmRleCA9IGludGVybmFsVHJpYWxJbmRleDtcbiAgICB9XG4gICAgXG4gICAgLyoqQGRlcHJlY2F0ZWQqL1xuICAgIGlzRmlyc3RUcmlhbCgpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKCB0aGlzLmludGVybmFsVHJpYWxJbmRleCA9PT0gdW5kZWZpbmVkIClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImludGVybmFsVHJpYWxJbmRleCBpcyB1bmRlZmluZWRcIik7XG4gICAgICAgIHJldHVybiB0aGlzLmludGVybmFsVHJpYWxJbmRleCA9PT0gMDtcbiAgICB9XG4gICAgXG4gICAgLyoqQGRlcHJlY2F0ZWQqL1xuICAgIGlzTGFzdFRyaWFsKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnRlcm5hbFRyaWFsSW5kZXggPT09IHRoaXMudHJpYWxzIC0gMTtcbiAgICB9XG4gICAgXG4gICAgLyoqQGRlcHJlY2F0ZWQqL1xuICAgIGhhc1plcm9lcygpIHtcbiAgICAgICAgcmV0dXJuICFib29sKHRoaXMubm90ZXMpIHx8ICFib29sKHRoaXMudHJpYWxzKTtcbiAgICB9XG4gICAgXG4gICAgdmFsdWVzT2soKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICggIWJvb2wodGhpcy5ub3RlcykgfHwgIWJvb2wodGhpcy50cmlhbHMpICkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH1cbiAgICAgICAgaWYgKCB0aGlzLnJoeXRobSApIHtcbiAgICAgICAgICAgIGlmICggIWJvb2wodGhpcy50ZW1wbykgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCBib29sKHRoaXMudGVtcG8pICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgXG59XG5cbmV4cG9ydCBjbGFzcyBMZXZlbENvbGxlY3Rpb24ge1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2xldmVsczogTGV2ZWxbXTtcbiAgICByZWFkb25seSBjdXJyZW50OiBMZXZlbDtcbiAgICBcbiAgICBjb25zdHJ1Y3RvcihsZXZlbHM6IElMZXZlbFtdLCBjdXJyZW50TGV2ZWxJbmRleD86IG51bWJlciwgY3VycmVudEludGVybmFsVHJpYWxJbmRleD86IG51bWJlcikge1xuICAgICAgICBcbiAgICAgICAgdGhpcy5fbGV2ZWxzID0gbGV2ZWxzLm1hcCgobGV2ZWwsIGluZGV4KSA9PiBuZXcgTGV2ZWwobGV2ZWwsIGluZGV4KSk7XG4gICAgICAgIGlmICggY3VycmVudExldmVsSW5kZXggIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMuX2xldmVsc1tjdXJyZW50TGV2ZWxJbmRleF07XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnQuaW50ZXJuYWxUcmlhbEluZGV4ID0gY3VycmVudEludGVybmFsVHJpYWxJbmRleDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG4gICAgXG4gICAgZ2V0IGxlbmd0aCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGV2ZWxzLmxlbmd0aDtcbiAgICB9XG4gICAgXG4gICAgZ2V0IHByZXZpb3VzKCk6IExldmVsIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KHRoaXMuY3VycmVudC5pbmRleCAtIDEpXG4gICAgfVxuICAgIFxuICAgIGdldChpOiBudW1iZXIpOiBMZXZlbCB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sZXZlbHNbaV07XG4gICAgfVxuICAgIFxuICAgIGJhZExldmVscygpOiBudW1iZXJbXSB7XG4gICAgICAgIGNvbnN0IGJhZExldmVscyA9IFtdO1xuICAgICAgICBmb3IgKCBsZXQgWyBpLCBsZXZlbCBdIG9mIGVudW1lcmF0ZSh0aGlzLl9sZXZlbHMpICkge1xuICAgICAgICAgICAgaWYgKCAhbGV2ZWwudmFsdWVzT2soKSApIHtcbiAgICAgICAgICAgICAgICBiYWRMZXZlbHMucHVzaChgJHtpLmh1bWFuKCl9IGxldmVsIGApXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJhZExldmVscztcbiAgICB9XG4gICAgXG4gICAgLyoqQGRlcHJlY2F0ZWQqL1xuICAgIHNvbWVIYXZlWmVyb2VzKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGV2ZWxzLnNvbWUobGV2ZWwgPT4gbGV2ZWwuaGFzWmVyb2VzKCkpO1xuICAgIH1cbiAgICBcbiAgICBzbGljZXNCeU5vdGVzKCk6IExldmVsQ29sbGVjdGlvbltdIHtcbiAgICAgICAgbGV0IGJ5Tm90ZXMgPSB7fTtcbiAgICAgICAgZm9yICggbGV0IGxldmVsIG9mIHRoaXMuX2xldmVscyApIHtcbiAgICAgICAgICAgIGlmICggbGV2ZWwubm90ZXMgaW4gYnlOb3RlcyApXG4gICAgICAgICAgICAgICAgYnlOb3Rlc1tsZXZlbC5ub3Rlc10uYWRkTGV2ZWwobGV2ZWwpO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGJ5Tm90ZXNbbGV2ZWwubm90ZXNdID0gbmV3IExldmVsQ29sbGVjdGlvbihbIGxldmVsIF0pO1xuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoYnlOb3Rlcyk7XG4gICAgfVxuICAgIFxuICAgIGFkZExldmVsKGxldmVsOiBMZXZlbCkge1xuICAgICAgICB0aGlzLl9sZXZlbHMucHVzaChsZXZlbCk7XG4gICAgfVxuICAgIFxuICAgIGdldE5leHRUZW1wb09mVGhpc05vdGVzKCk6IG51bWJlciB7XG4gICAgICAgIGlmICggdGhpcy5jdXJyZW50LnJoeXRobSApXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50LnRlbXBvO1xuICAgICAgICBmb3IgKCBsZXQgaSA9IHRoaXMuY3VycmVudC5pbmRleDsgaSA8IHRoaXMuX2xldmVscy5sZW5ndGg7IGkrKyApIHtcbiAgICAgICAgICAgIGNvbnN0IGx2bCA9IHRoaXMuX2xldmVsc1tpXTtcbiAgICAgICAgICAgIGlmICggbHZsLm5vdGVzICE9IHRoaXMuY3VycmVudC5ub3RlcyApXG4gICAgICAgICAgICAgICAgcmV0dXJuIDEwMDsgLy8gd2VudCBvdmVyIGFsbCBsZXZlbCB3aXRoIHNhbWUgbnVtYmVyIG9mIG5vdGVzIGFuZCBkaWRuJ3QgZmluZCBhbnl0aGluZ1xuICAgICAgICAgICAgaWYgKCBsdmwudGVtcG8gIT0gbnVsbCApXG4gICAgICAgICAgICAgICAgcmV0dXJuIGx2bC50ZW1wbztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMTAwO1xuICAgIH1cbiAgICBcbiAgICBpc0N1cnJlbnRMYXN0TGV2ZWwoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnQuaW5kZXggPT0gdGhpcy5sZW5ndGggLSAxO1xuICAgIH1cbiAgICBcbiAgICBtYXhOb3RlcygpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gTWF0aC5tYXgoLi4udGhpcy5fbGV2ZWxzLm1hcChsdmwgPT4gbHZsLm5vdGVzKSk7XG4gICAgfVxuICAgIFxuICAgIFtTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhYmxlSXRlcmF0b3I8TGV2ZWw+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xldmVscy52YWx1ZXMoKTtcbiAgICB9XG59XG4iXX0=