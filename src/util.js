"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const electron_1 = require("electron");
const fs = require("fs");
const path = require("path");
const MyFs_1 = require("./MyFs");
function round(n, d = 0) {
    const fr = 10 ** d;
    return parseInt(n * fr) / fr;
}
function int(x, base) {
    return parseInt(x, base);
}
function str(val) {
    return val ? val.toString() : "";
}
exports.str = str;
function bool(val) {
    if (!val) {
        return false;
    }
    const typeofval = typeof val;
    if (typeofval !== 'object') {
        if (typeofval === 'function') {
            return true;
        }
        else {
            return !!val;
        }
    }
    let toStringed = {}.toString.call(val);
    if (toStringed === '[object Object]' || toStringed === '[object Array]') {
        return Object.keys(val).length !== 0;
    }
    return !!val.valueOf();
}
exports.bool = bool;
function enumerate(obj) {
    let typeofObj = typeof obj;
    if (obj === undefined
        || isEmptyObj(obj)
        || isEmptyArr(obj)
        || obj === "") {
        return [];
    }
    if (obj === null
        || typeofObj === "boolean"
        || typeofObj === "number"
        || typeofObj === "function") {
        throw new TypeError(`${typeofObj} object is not iterable`);
    }
    let array = [];
    if (isArray(obj)) {
        let i = 0;
        for (let x of obj) {
            array.push([i, x]);
            i++;
        }
    }
    else {
        for (let prop in obj) {
            array.push([prop, obj[prop]]);
        }
    }
    return array;
}
exports.enumerate = enumerate;
function wait(ms, acknowledgeSkipFade = true) {
    if (acknowledgeSkipFade) {
        if (require('./Glob').default.skipFade) {
            console.warn(`skipFade!`);
            return;
        }
    }
    if (!bool(ms)) {
        console.warn(`util.wait(${ms})`);
    }
    return new Promise(resolve => setTimeout(resolve, ms));
}
exports.wait = wait;
async function waitUntil(cond, checkInterval = 20, timeout = Infinity) {
    if (checkInterval <= 0) {
        throw new Error(`checkInterval <= 0. checkInterval: ${checkInterval}`);
    }
    if (checkInterval > timeout) {
        throw new Error(`checkInterval > timeout (${checkInterval} > ${timeout}). Has to be lower than timeout.`);
    }
    const loops = timeout / checkInterval;
    if (loops == 1) {
        console.warn(`loops == 1, you probably didn't want this to happen`);
    }
    let count = 0;
    while (count < loops) {
        if (cond()) {
            return true;
        }
        await wait(checkInterval, false);
        count++;
    }
    return false;
}
exports.waitUntil = waitUntil;
let stuff = {
    '()=>{}': () => {
    }, 'function(){}': function () {
    }, 'Function': Function,
    'Function()': Function(),
    "new Function": new Function,
    "new Function()": new Function(),
    "Boolean": Boolean,
    "Boolean()": Boolean(),
    "Boolean(false)": Boolean(false),
    "Boolean(true)": Boolean(true),
    "new Boolean": new Boolean,
    "new Boolean()": new Boolean(),
    "new Boolean(true)": new Boolean(true),
    "new Boolean(false)": new Boolean(false),
    "true": true,
    "false": false,
    "Number": Number,
    "Number()": Number(),
    "Number(0)": Number(0),
    "Number(1)": Number(1),
    "new Number": new Number,
    "new Number()": new Number(),
    "new Number(0)": new Number(0),
    "new Number(1)": new Number(1),
    "0": 0,
    "1": 1,
    "''": '',
    "' '": ' ',
    "'foo'": 'foo',
    "'0'": '0',
    "'1'": '1',
    "{}": {},
    "{ hi : 'bye' }": { hi: 'bye' },
    "[]": [],
    "[ false ]": [false],
    "[ true ]": [true],
    "[ [] ]": [[]],
    "[ 0 ]": [0],
    "[ 1 ]": [1],
    "undefined": undefined,
    "null": null,
    "document.body": document.body,
    "new class{}": new class {
    },
    "new Timeline(...)": "PLACEHOLDER",
};
function notnot(obj) {
    return !!obj;
}
function isString(obj) {
    return typeof obj === "string";
}
exports.isString = isString;
function isArray(obj) {
    if (!obj) {
        return false;
    }
    return typeof obj !== 'string' && (Array.isArray(obj) || typeof obj[Symbol.iterator] === 'function');
}
exports.isArray = isArray;
function isEmpty(obj) {
    let toStringed = {}.toString.call(obj);
    return (toStringed === '[object Object]' || toStringed === '[object Array]') && Object.keys(obj).length == 0;
}
function isEmptyArr(collection) {
    return isArray(collection) && getLength(collection) === 0;
}
function isEmptyObj(obj) {
    return isObject(obj) && !isArray(obj) && Object.keys(obj).length === 0;
}
function isFunction(fn) {
    let toStringed = {}.toString.call(fn);
    return !!fn && toStringed === '[object Function]';
}
exports.isFunction = isFunction;
function isTMap(obj) {
    return {}.toString.call(obj) == '[object Object]';
}
function isObject(obj) {
    return typeof obj === 'object' && !!obj;
}
exports.isObject = isObject;
function shallowProperty(key) {
    return function (obj) {
        return obj == null ? void 0 : obj[key];
    };
}
function getLength(collection) {
    return shallowProperty('length')(collection);
}
function any(...args) {
    for (let a of args) {
        if (bool(a)) {
            return true;
        }
    }
    return false;
}
exports.any = any;
function all(...args) {
    for (let a of args) {
        if (!bool(a)) {
            return false;
        }
    }
    return true;
}
exports.all = all;
function sum(arr) {
    let sum = 0;
    let dirty = false;
    for (let v of arr) {
        let number = parseFloat(v);
        if (!isNaN(number)) {
            dirty = true;
            sum += number;
        }
    }
    return !dirty ? undefined : sum;
}
exports.sum = sum;
function getCurrentWindow() {
    return electron_1.remote.getCurrentWindow();
}
exports.getCurrentWindow = getCurrentWindow;
function reloadPage() {
    if (require("./Glob").default.BigConfig.dev.no_reload_on_submit()) {
        return;
    }
    getCurrentWindow().reload();
}
exports.reloadPage = reloadPage;
function* range(start, stop) {
    for (let i = start; i <= stop; i++) {
        yield i;
    }
}
exports.range = range;
async function takeScreenshot(dirname) {
    const webContents = electron_1.remote.getCurrentWebContents();
    const image = await webContents.capturePage();
    MyFs_1.default.createIfNotExists(SESSION_PATH_ABS);
    const dirnameAbs = path.join(SESSION_PATH_ABS, dirname);
    MyFs_1.default.createIfNotExists(dirnameAbs);
    const files = { png: undefined, html: undefined };
    if (fs.existsSync(path.join(dirnameAbs, 'page.png'))) {
        files.png = `${dirnameAbs}/page__${new Date().human()}.png`;
    }
    else {
        files.png = path.join(dirnameAbs, 'page.png');
    }
    fs.writeFileSync(files.png, image.toPNG());
    if (fs.existsSync(path.join(dirnameAbs, 'screenshot.html'))) {
        files.html = `${dirnameAbs}/screenshot__${new Date().human()}.html`;
    }
    else {
        files.html = path.join(dirnameAbs, 'screenshot.html');
    }
    return await webContents.savePage(files.html, "HTMLComplete");
}
exports.takeScreenshot = takeScreenshot;
function ignoreErr(fn) {
    try {
        fn();
    }
    catch (e) {
        console.warn(`IGNORED ERROR: `, e);
    }
}
exports.ignoreErr = ignoreErr;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFJQSx1Q0FBa0M7QUFDbEMseUJBQXlCO0FBQ3pCLDZCQUE2QjtBQUM3QixpQ0FBMEI7QUFHMUIsU0FBUyxLQUFLLENBQUMsQ0FBUyxFQUFFLElBQVksQ0FBQztJQUNuQyxNQUFNLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBRW5CLE9BQU8sUUFBUSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDakMsQ0FBQztBQUdELFNBQVMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFpQztJQUM3QyxPQUFPLFFBQVEsQ0FBQyxDQUFDLEVBQVUsSUFBSSxDQUFDLENBQUM7QUFDckMsQ0FBQztBQUVELFNBQVMsR0FBRyxDQUFDLEdBQVE7SUFDakIsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFBO0FBQ3BDLENBQUM7QUFzbEJHLGtCQUFHO0FBcGxCUCxTQUFTLElBQUksQ0FBQyxHQUFRO0lBK0NsQixJQUFJLENBQUMsR0FBRyxFQUFFO1FBQ04sT0FBTyxLQUFLLENBQUM7S0FDaEI7SUFDRCxNQUFNLFNBQVMsR0FBRyxPQUFPLEdBQUcsQ0FBQztJQUM3QixJQUFJLFNBQVMsS0FBSyxRQUFRLEVBQUU7UUFDeEIsSUFBSSxTQUFTLEtBQUssVUFBVSxFQUFFO1lBQzFCLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7YUFBTTtZQUNILE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQztTQUNoQjtLQUNKO0lBRUQsSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdkMsSUFBSSxVQUFVLEtBQUssaUJBQWlCLElBQUksVUFBVSxLQUFLLGdCQUFnQixFQUFFO1FBQ3JFLE9BQU8sTUFBTSxDQUFD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LElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0tBQ2pEO0lBQ0QsRUFBRSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQzNDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDLEVBQUU7UUFDekQsS0FBSyxDQUFDLElBQUksR0FBRyxHQUFHLFVBQVUsZ0JBQWdCLElBQUksSUFBSSxFQUFFLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQTtLQUN0RTtTQUFNO1FBQ0gsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0tBQ3pEO0lBQ0QsT0FBTyxNQUFNLFdBQVcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxjQUFjLENBQUMsQ0FBQztBQUNsRSxDQUFDO0FBMEJHLHdDQUFjO0FBeEJsQixTQUFTLFNBQVMsQ0FBQyxFQUFnQjtJQUMvQixJQUFJO1FBQ0EsRUFBRSxFQUFFLENBQUM7S0FFUjtJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1IsT0FBTyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUN0QztBQUNMLENBQUM7QUFRRyw4QkFBUyIsInNvdXJjZXNDb250ZW50IjpbIi8qKmltcG9ydCAqIGFzIHV0aWwgZnJvbSBcIi4uL3V0aWxcIlxuICogdXRpbC5yZWxvYWRQYWdlKCk7XG4gKlxuICogaW1wb3J0IHtyZWxvYWRQYWdlfSBmcm9tIFwiLi4vdXRpbFwiKi9cbmltcG9ydCB7IHJlbW90ZSB9IGZyb20gJ2VsZWN0cm9uJztcbmltcG9ydCAqIGFzIGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IG15ZnMgZnJvbSBcIi4vTXlGc1wiO1xuXG5cbmZ1bmN0aW9uIHJvdW5kKG46IG51bWJlciwgZDogbnVtYmVyID0gMCkge1xuICAgIGNvbnN0IGZyID0gMTAgKiogZDtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcmV0dXJuIHBhcnNlSW50KG4gKiBmcikgLyBmcjtcbn1cblxuXG5mdW5jdGlvbiBpbnQoeCwgYmFzZT86IHN0cmluZyB8IG51bWJlciB8IEZ1bmN0aW9uKTogbnVtYmVyIHtcbiAgICByZXR1cm4gcGFyc2VJbnQoeCwgPG51bWJlcj5iYXNlKTtcbn1cblxuZnVuY3Rpb24gc3RyKHZhbDogYW55KSB7XG4gICAgcmV0dXJuIHZhbCA/IHZhbC50b1N0cmluZygpIDogXCJcIlxufVxuXG5mdW5jdGlvbiBib29sKHZhbDogYW55KTogYm9vbGVhbiB7XG4gICAgLy8gMCAgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAxICAgICAgICAgICAgICAgICAgICB0cnVlXG4gICAgLy8gJzAnICAgICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vICcxJyAgICAgICAgICAgICAgICAgIHRydWVcbiAgICAvLyAnICcgICAgICAgICAgICAgICAgICB0cnVlXG4gICAgLy8gJycgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnZm9vJyAgICAgICAgICAgICAgICB0cnVlXG4gICAgLy8gKCk9Pnt9ICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIEJvb2xlYW4gICAgICAgICAgICAgIHRydWVcbiAgICAvLyBCb29sZWFuKCkgICAgICAgICAgICBmYWxzZVxuICAgIC8vIEJvb2xlYW4oZmFsc2UpICAgICAgIGZhbHNlXG4gICAgLy8gQm9vbGVhbih0cnVlKSAgICAgICAgdHJ1ZVxuICAgIC8vIEZ1bmN0aW9uICAgICAgICAgICAgIHRydWVcbiAgICAvLyBGdW5jdGlvbigpICAgICAgICAgICB0cnVlXG4gICAgLy8gTnVtYmVyICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIE51bWJlcigwKSAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gTnVtYmVyKDEpICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIE51bWJlcigpICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gWyAwIF0gICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIFsgMSBdICAgICAgICAgICAgICAgIHRydWVcbiAgICAvLyBbIFtdIF0gICAgICAgICAgICAgICB0cnVlXG4gICAgLy8gWyBmYWxzZSBdICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIFsgdHJ1ZSBdICAgICAgICAgICAgIHRydWVcbiAgICAvLyBbXSAgICAgICAgICAgICAgICAgICBmYWxzZSAgICAgICB1bmxpa2UgbmF0aXZlXG4gICAgLy8gZG9jdW1lbnQuYm9keSAgICAgICAgdHJ1ZVxuICAgIC8vIGZhbHNlICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gZnVuY3Rpb24oKXt9ICAgICAgICAgdHJ1ZVxuICAgIC8vIG5ldyBCb29sZWFuICAgICAgICAgIGZhbHNlICAgICAgIHVubGlrZSBuYXRpdmVcbiAgICAvLyBuZXcgQm9vbGVhbigpICAgICAgICBmYWxzZSAgICAgICB1bmxpa2UgbmF0aXZlXG4gICAgLy8gbmV3IEJvb2xlYW4oZmFsc2UpICAgZmFsc2UgICAgICAgdW5saWtlIG5hdGl2ZVxuICAgIC8vIG5ldyBCb29sZWFuKHRydWUpICAgIHRydWVcbiAgICAvLyBuZXcgRnVuY3Rpb24gICAgICAgICB0cnVlXG4gICAgLy8gbmV3IEZ1bmN0aW9uKCkgICAgICAgdHJ1ZVxuICAgIC8vIG5ldyBOdW1iZXIgICAgICAgICAgIGZhbHNlICAgICAgIHVubGlrZSBuYXRpdmVcbiAgICAvLyBuZXcgTnVtYmVyKDApICAgICAgICBmYWxzZSAgICAgICB1bmxpa2UgbmF0aXZlXG4gICAgLy8gbmV3IE51bWJlcigxKSAgICAgICAgdHJ1ZVxuICAgIC8vIG5ldyBOdW1iZXIoKSAgICAgICAgIGZhbHNlICAgICAgIHVubGlrZSBuYXRpdmVcbiAgICAvLyBuZXcgVGltZWxpbmUoLi4uKSAgICB0cnVlXG4gICAgLy8gbmV3IGNsYXNze30gICAgICAgICAgZmFsc2UgICAgICAgdW5saWtlIG5hdGl2ZVxuICAgIC8vIG51bGwgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gdHJ1ZSAgICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIHVuZGVmaW5lZCAgICAgICAgICAgIGZhbHNlXG4gICAgLy8geyBoaSA6ICdieWUnIH0gICAgICAgdHJ1ZVxuICAgIC8vIHt9ICAgICAgICAgICAgICAgICAgIGZhbHNlICAgICAgIHVubGlrZSBuYXRpdmVcblxuXG4gICAgaWYgKCF2YWwpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCB0eXBlb2Z2YWwgPSB0eXBlb2YgdmFsO1xuICAgIGlmICh0eXBlb2Z2YWwgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIGlmICh0eXBlb2Z2YWwgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICEhdmFsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGxldCBrZXlzTGVuZ3RoID0gT2JqZWN0LmtleXModmFsKS5sZW5ndGg7XG4gICAgbGV0IHRvU3RyaW5nZWQgPSB7fS50b1N0cmluZy5jYWxsKHZhbCk7XG4gICAgaWYgKHRvU3RyaW5nZWQgPT09ICdbb2JqZWN0IE9iamVjdF0nIHx8IHRvU3RyaW5nZWQgPT09ICdbb2JqZWN0IEFycmF5XScpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHZhbCkubGVuZ3RoICE9PSAwO1xuICAgIH1cblxuICAgIC8vIEJvb2xlYW4sIE51bWJlciwgSFRNTEVsZW1lbnQuLi5cbiAgICByZXR1cm4gISF2YWwudmFsdWVPZigpO1xufVxuXG5mdW5jdGlvbiBlbnVtZXJhdGU8VD4ob2JqOiBUKTogRW51bWVyYXRlZDxUPiB7XG4gICAgLy8gdW5kZWZpbmVkICAgIFtdXG4gICAgLy8ge30gICAgICAgICAgIFtdXG4gICAgLy8gW10gICAgICAgICAgIFtdXG4gICAgLy8gXCJcIiAgICAgICAgICAgW11cbiAgICAvLyBudW1iZXIgICAgICAgVHlwZUVycm9yXG4gICAgLy8gbnVsbCAgICAgICAgIFR5cGVFcnJvclxuICAgIC8vIGJvb2xlYW4gICAgICBUeXBlRXJyb3JcbiAgICAvLyBGdW5jdGlvbiAgICAgVHlwZUVycm9yXG4gICAgLy8gXCJmb29cIiAgICAgICAgWyBbMCwgXCJmXCJdLCBbMSwgXCJvXCJdLCBbMiwgXCJvXCJdIF1cbiAgICAvLyBbIFwiZm9vXCIgXSAgICBbIFswLCBcImZvb1wiXSBdXG4gICAgLy8gWyAxMCBdICAgICAgIFsgWzAsIDEwXSBdXG4gICAgLy8geyBhOiBcImZvb1wiIH0gWyBbXCJhXCIsIFwiZm9vXCJdIF1cbiAgICAvLyAvLyAoKT0+e30gICAgP1xuICAgIGxldCB0eXBlb2ZPYmogPSB0eXBlb2Ygb2JqO1xuICAgIGlmIChcbiAgICAgICAgb2JqID09PSB1bmRlZmluZWRcbiAgICAgICAgfHwgaXNFbXB0eU9iaihvYmopXG4gICAgICAgIHx8IGlzRW1wdHlBcnIob2JqKVxuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHx8IG9iaiA9PT0gXCJcIlxuICAgICkge1xuICAgICAgICByZXR1cm4gW10gYXMgRW51bWVyYXRlZDxUPjtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAgIG9iaiA9PT0gbnVsbFxuICAgICAgICB8fCB0eXBlb2ZPYmogPT09IFwiYm9vbGVhblwiXG4gICAgICAgIHx8IHR5cGVvZk9iaiA9PT0gXCJudW1iZXJcIlxuICAgICAgICB8fCB0eXBlb2ZPYmogPT09IFwiZnVuY3Rpb25cIlxuICAgICkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGAke3R5cGVvZk9ian0gb2JqZWN0IGlzIG5vdCBpdGVyYWJsZWApO1xuICAgIH1cbiAgICBsZXQgYXJyYXkgPSBbXTtcbiAgICBpZiAoaXNBcnJheShvYmopKSB7XG4gICAgICAgIGxldCBpOiBudW1iZXIgPSAwO1xuICAgICAgICBmb3IgKGxldCB4IG9mIG9iaikge1xuICAgICAgICAgICAgYXJyYXkucHVzaChbaSwgeF0pO1xuICAgICAgICAgICAgaSsrO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZm9yIChsZXQgcHJvcCBpbiBvYmopIHtcbiAgICAgICAgICAgIGFycmF5LnB1c2goW3Byb3AsIG9ialtwcm9wXV0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhcnJheSBhcyBFbnVtZXJhdGVkPFQ+O1xufVxuXG5mdW5jdGlvbiB3YWl0KG1zOiBudW1iZXIsIGFja25vd2xlZGdlU2tpcEZhZGUgPSB0cnVlKTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAoYWNrbm93bGVkZ2VTa2lwRmFkZSkge1xuXG4gICAgICAgIGlmIChyZXF1aXJlKCcuL0dsb2InKS5kZWZhdWx0LnNraXBGYWRlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYHNraXBGYWRlIWApO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGlmICggR2xvYi5za2lwRmFkZSApIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFib29sKG1zKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oYHV0aWwud2FpdCgke21zfSlgKVxuICAgIH1cbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG59XG5cbi8qKkNoZWNrIGV2ZXJ5IGBjaGVja0ludGVydmFsYCBtcyBpZiBgY29uZCgpYCBpcyB0cnV0aHkuIElmLCB3aXRoaW4gYHRpbWVvdXRgLCBjb25kKCkgaXMgdHJ1dGh5LCByZXR1cm4gYHRydWVgLiBSZXR1cm4gYGZhbHNlYCBpZiB0aW1lIGlzIG91dC5cbiAqIEBleGFtcGxlXG4gKiAvLyBHaXZlIHRoZSB1c2VyIGEgMjAwbXMgY2hhbmNlIHRvIGdldCBoZXIgcG9pbnRlciBvdmVyIFwibXlkaXZcIi4gQ29udGludWUgaW1tZWRpYXRlbHkgb25jZSBzaGUgZG9lcywgb3IgYWZ0ZXIgMjAwbXMgaWYgc2hlIGRvZXNuJ3QuXG4gKiBteWRpdi5wb2ludGVyZW50ZXIoICgpID0+IG15ZGl2LnBvaW50ZXJIb3ZlcmluZyA9IHRydWU7IClcbiAqIGNvbnN0IHBvaW50ZXJPbk15ZGl2ID0gYXdhaXQgd2FpdFVudGlsKCgpID0+IG15ZGl2LnBvaW50ZXJIb3ZlcmluZywgMjAwLCAxMCk7Ki9cbmFzeW5jIGZ1bmN0aW9uIHdhaXRVbnRpbChjb25kOiBGdW5jdGlvblJldHVybnM8Ym9vbGVhbj4sIGNoZWNrSW50ZXJ2YWw6IG51bWJlciA9IDIwLCB0aW1lb3V0OiBudW1iZXIgPSBJbmZpbml0eSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGlmIChjaGVja0ludGVydmFsIDw9IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBjaGVja0ludGVydmFsIDw9IDAuIGNoZWNrSW50ZXJ2YWw6ICR7Y2hlY2tJbnRlcnZhbH1gKTtcbiAgICB9XG4gICAgaWYgKGNoZWNrSW50ZXJ2YWwgPiB0aW1lb3V0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgY2hlY2tJbnRlcnZhbCA+IHRpbWVvdXQgKCR7Y2hlY2tJbnRlcnZhbH0gPiAke3RpbWVvdXR9KS4gSGFzIHRvIGJlIGxvd2VyIHRoYW4gdGltZW91dC5gKTtcbiAgICB9XG5cbiAgICBjb25zdCBsb29wcyA9IHRpbWVvdXQgLyBjaGVja0ludGVydmFsO1xuICAgIGlmIChsb29wcyA9PSAxKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgbG9vcHMgPT0gMSwgeW91IHByb2JhYmx5IGRpZG4ndCB3YW50IHRoaXMgdG8gaGFwcGVuYCk7XG4gICAgfVxuICAgIGxldCBjb3VudCA9IDA7XG4gICAgd2hpbGUgKGNvdW50IDwgbG9vcHMpIHtcbiAgICAgICAgaWYgKGNvbmQoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgd2FpdChjaGVja0ludGVydmFsLCBmYWxzZSk7XG4gICAgICAgIGNvdW50Kys7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxubGV0IHN0dWZmID0ge1xuICAgICcoKT0+e30nOiAoKSA9PiB7XG4gICAgfSwgJ2Z1bmN0aW9uKCl7fSc6IGZ1bmN0aW9uICgpIHtcbiAgICB9LCAnRnVuY3Rpb24nOiBGdW5jdGlvbixcbiAgICAnRnVuY3Rpb24oKSc6IEZ1bmN0aW9uKCksXG4gICAgXCJuZXcgRnVuY3Rpb25cIjogbmV3IEZ1bmN0aW9uLFxuICAgIFwibmV3IEZ1bmN0aW9uKClcIjogbmV3IEZ1bmN0aW9uKCksXG4gICAgXCJCb29sZWFuXCI6IEJvb2xlYW4sXG4gICAgXCJCb29sZWFuKClcIjogQm9vbGVhbigpLFxuICAgIFwiQm9vbGVhbihmYWxzZSlcIjogQm9vbGVhbihmYWxzZSksXG4gICAgXCJCb29sZWFuKHRydWUpXCI6IEJvb2xlYW4odHJ1ZSksXG4gICAgXCJuZXcgQm9vbGVhblwiOiBuZXcgQm9vbGVhbixcbiAgICBcIm5ldyBCb29sZWFuKClcIjogbmV3IEJvb2xlYW4oKSxcbiAgICBcIm5ldyBCb29sZWFuKHRydWUpXCI6IG5ldyBCb29sZWFuKHRydWUpLFxuICAgIFwibmV3IEJvb2xlYW4oZmFsc2UpXCI6IG5ldyBCb29sZWFuKGZhbHNlKSxcbiAgICBcInRydWVcIjogdHJ1ZSxcbiAgICBcImZhbHNlXCI6IGZhbHNlLFxuICAgIFwiTnVtYmVyXCI6IE51bWJlcixcbiAgICBcIk51bWJlcigpXCI6IE51bWJlcigpLFxuICAgIFwiTnVtYmVyKDApXCI6IE51bWJlcigwKSxcbiAgICBcIk51bWJlcigxKVwiOiBOdW1iZXIoMSksXG4gICAgXCJuZXcgTnVtYmVyXCI6IG5ldyBOdW1iZXIsXG4gICAgXCJuZXcgTnVtYmVyKClcIjogbmV3IE51bWJlcigpLFxuICAgIFwibmV3IE51bWJlcigwKVwiOiBuZXcgTnVtYmVyKDApLFxuICAgIFwibmV3IE51bWJlcigxKVwiOiBuZXcgTnVtYmVyKDEpLFxuICAgIFwiMFwiOiAwLFxuICAgIFwiMVwiOiAxLFxuICAgIFwiJydcIjogJycsXG4gICAgXCInICdcIjogJyAnLFxuICAgIFwiJ2ZvbydcIjogJ2ZvbycsXG4gICAgXCInMCdcIjogJzAnLFxuICAgIFwiJzEnXCI6ICcxJyxcbiAgICBcInt9XCI6IHt9LFxuICAgIFwieyBoaSA6ICdieWUnIH1cIjogeyBoaTogJ2J5ZScgfSxcbiAgICBcIltdXCI6IFtdLFxuICAgIFwiWyBmYWxzZSBdXCI6IFtmYWxzZV0sXG4gICAgXCJbIHRydWUgXVwiOiBbdHJ1ZV0sXG4gICAgXCJbIFtdIF1cIjogW1tdXSxcbiAgICBcIlsgMCBdXCI6IFswXSxcbiAgICBcIlsgMSBdXCI6IFsxXSxcbiAgICBcInVuZGVmaW5lZFwiOiB1bmRlZmluZWQsXG4gICAgXCJudWxsXCI6IG51bGwsXG4gICAgXCJkb2N1bWVudC5ib2R5XCI6IGRvY3VtZW50LmJvZHksXG4gICAgXCJuZXcgY2xhc3N7fVwiOiBuZXcgY2xhc3Mge1xuICAgIH0sXG4gICAgXCJuZXcgVGltZWxpbmUoLi4uKVwiOiBcIlBMQUNFSE9MREVSXCIsXG59O1xuXG5cbmZ1bmN0aW9uIG5vdG5vdChvYmopIHtcbiAgICAvLyAvIDAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAxICAgICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vICgpPT57fSAgICAgICAgICAgICB0cnVlXG4gICAgLy8gZnVuY3Rpb24oKXt9ICAgICAgIHRydWVcbiAgICAvLyBGdW5jdGlvbiAgICAgICAgICAgdHJ1ZVxuICAgIC8vIEZ1bmN0aW9uKCkgICAgICAgICB0cnVlXG4gICAgLy8gbmV3IEZ1bmN0aW9uKCkgICAgIHRydWVcbiAgICAvLyBCb29sZWFuICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIC8gIEJvb2xlYW4oKSAgICAgICBmYWxzZVxuICAgIC8vIG5ldyBCb29sZWFuKCkgICAgICB0cnVlXG4gICAgLy8gbmV3IEJvb2xlYW4odHJ1ZSkgIHRydWVcbiAgICAvLyBuZXcgQm9vbGVhbihmYWxzZSkgdHJ1ZVxuICAgIC8vIHRydWUgICAgICAgICAgICAgICB0cnVlXG4gICAgLy8gLyAgZmFsc2UgICAgICAgICAgIGZhbHNlXG4gICAgLy8gTnVtYmVyICAgICAgICAgICAgIHRydWVcbiAgICAvLyAvICBOdW1iZXIoKSAgICAgICAgZmFsc2VcbiAgICAvLyBuZXcgTnVtYmVyKCkgICAgICAgdHJ1ZVxuICAgIC8vIG5ldyBOdW1iZXIoMCkgICAgICB0cnVlXG4gICAgLy8gbmV3IE51bWJlcigxKSAgICAgIHRydWVcbiAgICAvLyAvICcnICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnICcgICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vICcwJyAgICAgICAgICAgICAgICB0cnVlXG4gICAgLy8gJzEnICAgICAgICAgICAgICAgIHRydWVcbiAgICAvLyB7fSAgICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIHsgaGkgOiAnYnllJyB9ICAgICB0cnVlXG4gICAgLy8gW10gICAgICAgICAgICAgICAgIHRydWVcbiAgICAvLyBbIDEgXSAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIC8gIHVuZGVmaW5lZCAgICAgICBmYWxzZVxuICAgIC8vIC8gIG51bGwgICAgICAgICAgICBmYWxzZVxuICAgIHJldHVybiAhIW9iajtcbn1cblxuZnVuY3Rpb24gaXNTdHJpbmcob2JqKTogb2JqIGlzIHN0cmluZyB7XG4gICAgcmV0dXJuIHR5cGVvZiBvYmogPT09IFwic3RyaW5nXCJcbn1cblxuZnVuY3Rpb24gaXNBcnJheTxUPihvYmopOiBvYmogaXMgQXJyYXk8VD4geyAvLyBzYW1lIGFzIEFycmF5LmlzQXJyYXlcbiAgICAvLyAwICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gMSAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcnICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnICcgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gJ2ZvbycgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcwJyAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnMScgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gKCk9Pnt9ICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIEJvb2xlYW4gICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBCb29sZWFuKCkgICAgICAgICAgIGZhbHNlXG4gICAgLy8gRnVuY3Rpb24gICAgICAgICAgICBmYWxzZVxuICAgIC8vIEZ1bmN0aW9uKCkgICAgICAgICAgZmFsc2VcbiAgICAvLyBOdW1iZXIgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gTnVtYmVyKCkgICAgICAgICAgICBmYWxzZVxuICAgIC8vIC8gWyAxIF0gICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIC8gW10gICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIGZhbHNlICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBmdW5jdGlvbigpe30gICAgICAgIGZhbHNlXG4gICAgLy8gbmV3IEJvb2xlYW4oKSAgICAgICBmYWxzZVxuICAgIC8vIG5ldyBCb29sZWFuKGZhbHNlKSAgZmFsc2VcbiAgICAvLyBuZXcgQm9vbGVhbih0cnVlKSAgIGZhbHNlXG4gICAgLy8gbmV3IEZ1bmN0aW9uKCkgICAgICBmYWxzZVxuICAgIC8vIG5ldyBOdW1iZXIoMCkgICAgICAgZmFsc2VcbiAgICAvLyBuZXcgTnVtYmVyKDEpICAgICAgIGZhbHNlXG4gICAgLy8gbmV3IE51bWJlcigpICAgICAgICBmYWxzZVxuICAgIC8vIG51bGwgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyB0cnVlICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gdW5kZWZpbmVkICAgICAgICAgICBmYWxzZVxuICAgIC8vIHsgaGkgOiAnYnllJyB9ICAgICAgZmFsc2VcbiAgICAvLyB7fSAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgaWYgKCFvYmopIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHlwZW9mIG9iaiAhPT0gJ3N0cmluZycgJiYgKEFycmF5LmlzQXJyYXkob2JqKSB8fCB0eXBlb2Ygb2JqW1N5bWJvbC5pdGVyYXRvcl0gPT09ICdmdW5jdGlvbicpO1xufVxuXG5mdW5jdGlvbiBpc0VtcHR5KG9iajogYW55KTogYm9vbGVhbiB7XG4gICAgLy8gMCAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIDEgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnJyAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gJyAnICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcwJyAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnMScgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gKCk9Pnt9ICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIEJvb2xlYW4gICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBCb29sZWFuKCkgICAgICAgICAgIGZhbHNlXG4gICAgLy8gRnVuY3Rpb24gICAgICAgICAgICBmYWxzZVxuICAgIC8vIEZ1bmN0aW9uKCkgICAgICAgICAgZmFsc2VcbiAgICAvLyBOdW1iZXIgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gTnVtYmVyKCkgICAgICAgICAgICBmYWxzZVxuICAgIC8vIFsgMSBdICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAvIFtdICAgICAgICAgICAgICAgIHRydWVcbiAgICAvLyBmYWxzZSAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gZnVuY3Rpb24oKXt9ICAgICAgICBmYWxzZVxuICAgIC8vIG5ldyBCb29sZWFuKCkgICAgICAgZmFsc2VcbiAgICAvLyBuZXcgQm9vbGVhbihmYWxzZSkgIGZhbHNlXG4gICAgLy8gbmV3IEJvb2xlYW4odHJ1ZSkgICBmYWxzZVxuICAgIC8vIG5ldyBGdW5jdGlvbigpICAgICAgZmFsc2VcbiAgICAvLyBuZXcgTnVtYmVyKDApICAgICAgIGZhbHNlXG4gICAgLy8gbmV3IE51bWJlcigxKSAgICAgICBmYWxzZVxuICAgIC8vIG5ldyBOdW1iZXIoKSAgICAgICAgZmFsc2VcbiAgICAvLyBudWxsICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gdHJ1ZSAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIHVuZGVmaW5lZCAgICAgICAgICAgZmFsc2VcbiAgICAvLyB7IGhpIDogJ2J5ZScgfSAgICAgIGZhbHNlXG4gICAgLy8gLyB7fSAgICAgICAgICAgICAgICB0cnVlXG4gICAgbGV0IHRvU3RyaW5nZWQgPSB7fS50b1N0cmluZy5jYWxsKG9iaik7XG4gICAgcmV0dXJuICh0b1N0cmluZ2VkID09PSAnW29iamVjdCBPYmplY3RdJyB8fCB0b1N0cmluZ2VkID09PSAnW29iamVjdCBBcnJheV0nKSAmJiBPYmplY3Qua2V5cyhvYmopLmxlbmd0aCA9PSAwO1xufVxuXG5mdW5jdGlvbiBpc0VtcHR5QXJyKGNvbGxlY3Rpb24pOiBib29sZWFuIHtcbiAgICAvLyAwICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gMSAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcnICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnICcgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gJzAnICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcxJyAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAoKT0+e30gICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gQm9vbGVhbiAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIEJvb2xlYW4oKSAgICAgICAgICAgZmFsc2VcbiAgICAvLyBGdW5jdGlvbiAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gRnVuY3Rpb24oKSAgICAgICAgICBmYWxzZVxuICAgIC8vIE51bWJlciAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBOdW1iZXIoKSAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gWyAxIF0gICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIC8gW10gICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIGZhbHNlICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBmdW5jdGlvbigpe30gICAgICAgIGZhbHNlXG4gICAgLy8gbmV3IEJvb2xlYW4oKSAgICAgICBmYWxzZVxuICAgIC8vIG5ldyBCb29sZWFuKGZhbHNlKSAgZmFsc2VcbiAgICAvLyBuZXcgQm9vbGVhbih0cnVlKSAgIGZhbHNlXG4gICAgLy8gbmV3IEZ1bmN0aW9uKCkgICAgICBmYWxzZVxuICAgIC8vIG5ldyBOdW1iZXIoMCkgICAgICAgZmFsc2VcbiAgICAvLyBuZXcgTnVtYmVyKDEpICAgICAgIGZhbHNlXG4gICAgLy8gbmV3IE51bWJlcigpICAgICAgICBmYWxzZVxuICAgIC8vIG51bGwgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyB0cnVlICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gdW5kZWZpbmVkICAgICAgICAgICBmYWxzZVxuICAgIC8vIHsgaGkgOiAnYnllJyB9ICAgICAgZmFsc2VcbiAgICAvLyB7fSAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgcmV0dXJuIGlzQXJyYXkoY29sbGVjdGlvbikgJiYgZ2V0TGVuZ3RoKGNvbGxlY3Rpb24pID09PSAwXG59XG5cbmZ1bmN0aW9uIGlzRW1wdHlPYmoob2JqKTogYm9vbGVhbiB7XG4gICAgLy8gMCAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIDEgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnJyAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gJyAnICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcwJyAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnMScgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gKCk9Pnt9ICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIEJvb2xlYW4gICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBCb29sZWFuKCkgICAgICAgICAgIGZhbHNlXG4gICAgLy8gRnVuY3Rpb24gICAgICAgICAgICBmYWxzZVxuICAgIC8vIEZ1bmN0aW9uKCkgICAgICAgICAgZmFsc2VcbiAgICAvLyBOdW1iZXIgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gTnVtYmVyKCkgICAgICAgICAgICBmYWxzZVxuICAgIC8vIFsgMSBdICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBbXSAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gZmFsc2UgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIGZ1bmN0aW9uKCl7fSAgICAgICAgZmFsc2VcbiAgICAvLyAvIG5ldyBCb29sZWFuKCkgICAgIHRydWVcbiAgICAvLyAvIG5ldyBCb29sZWFuKGZhbHNlKXRydWVcbiAgICAvLyAvIG5ldyBCb29sZWFuKHRydWUpIHRydWVcbiAgICAvLyBuZXcgRnVuY3Rpb24oKSAgICAgIGZhbHNlXG4gICAgLy8gLyBuZXcgTnVtYmVyKDApICAgICB0cnVlXG4gICAgLy8gLyBuZXcgTnVtYmVyKDEpICAgICB0cnVlXG4gICAgLy8gLyBuZXcgTnVtYmVyKCkgICAgICB0cnVlXG4gICAgLy8gbnVsbCAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIHRydWUgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyB1bmRlZmluZWQgICAgICAgICAgIGZhbHNlXG4gICAgLy8geyBoaSA6ICdieWUnIH0gICAgICBmYWxzZVxuICAgIC8vIC8ge30gICAgICAgICAgICAgICAgdHJ1ZVxuICAgIHJldHVybiBpc09iamVjdChvYmopICYmICFpc0FycmF5KG9iaikgJiYgT2JqZWN0LmtleXMob2JqKS5sZW5ndGggPT09IDBcbn1cblxuXG5mdW5jdGlvbiBpc0Z1bmN0aW9uPFQ+KGZuOiBGdW5jdGlvblJldHVybnM8VD4pOiBmbiBpcyBGdW5jdGlvblJldHVybnM8VD5cbi8vIGZ1bmN0aW9uIGlzRnVuY3Rpb24oZm46IEFueUZ1bmN0aW9uKTogZm4gaXMgQW55RnVuY3Rpb25cbmZ1bmN0aW9uIGlzRnVuY3Rpb24oZm4pIHtcbiAgICAvLyAwICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gMSAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcnICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnICcgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gJzAnICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcxJyAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAvICgpPT57fSAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIC8gQm9vbGVhbiAgICAgICAgICAgICB0cnVlXG4gICAgLy8gQm9vbGVhbigpICAgICAgICAgICBmYWxzZVxuICAgIC8vIC8gRnVuY3Rpb24gICAgICAgICAgICB0cnVlXG4gICAgLy8gLyBGdW5jdGlvbigpICAgICAgICAgIHRydWVcbiAgICAvLyAvIE51bWJlciAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIE51bWJlcigpICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBbIDEgXSAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gW10gICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIGZhbHNlICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAvIGZ1bmN0aW9uKCl7fSAgICAgICAgdHJ1ZVxuICAgIC8vIG5ldyBCb29sZWFuKCkgICAgICAgZmFsc2VcbiAgICAvLyBuZXcgQm9vbGVhbihmYWxzZSkgIGZhbHNlXG4gICAgLy8gbmV3IEJvb2xlYW4odHJ1ZSkgICBmYWxzZVxuICAgIC8vIC8gbmV3IEZ1bmN0aW9uKCkgICAgICB0cnVlXG4gICAgLy8gbmV3IE51bWJlcigwKSAgICAgICBmYWxzZVxuICAgIC8vIG5ldyBOdW1iZXIoMSkgICAgICAgZmFsc2VcbiAgICAvLyBuZXcgTnVtYmVyKCkgICAgICAgIGZhbHNlXG4gICAgLy8gbnVsbCAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIHRydWUgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyB1bmRlZmluZWQgICAgICAgICAgIGZhbHNlXG4gICAgLy8geyBoaSA6ICdieWUnIH0gICAgICBmYWxzZVxuICAgIC8vIHt9ICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICBsZXQgdG9TdHJpbmdlZCA9IHt9LnRvU3RyaW5nLmNhbGwoZm4pO1xuICAgIHJldHVybiAhIWZuICYmIHRvU3RyaW5nZWQgPT09ICdbb2JqZWN0IEZ1bmN0aW9uXSdcbn1cblxuZnVuY3Rpb24gaXNUTWFwPFQ+KG9iajogVE1hcDxUPik6IG9iaiBpcyBUTWFwPFQ+IHtcbiAgICAvLyAwICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gMSAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcnICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnICcgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gJzAnICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcxJyAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAoKT0+e30gICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gQm9vbGVhbiAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIEJvb2xlYW4oKSAgICAgICAgICAgZmFsc2VcbiAgICAvLyBGdW5jdGlvbiAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gRnVuY3Rpb24oKSAgICAgICAgICBmYWxzZVxuICAgIC8vIE51bWJlciAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBOdW1iZXIoKSAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gWyAxIF0gICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBbXSAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIGZhbHNlICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBmdW5jdGlvbigpe30gICAgICAgIGZhbHNlXG4gICAgLy8gbmV3IEJvb2xlYW4oKSAgICAgZmFsc2VcbiAgICAvLyBuZXcgQm9vbGVhbihmYWxzZSlmYWxzZVxuICAgIC8vIG5ldyBCb29sZWFuKHRydWUpIGZhbHNlXG4gICAgLy8gbmV3IEZ1bmN0aW9uKCkgICAgICBmYWxzZVxuICAgIC8vIG5ldyBOdW1iZXIoMCkgICAgIGZhbHNlXG4gICAgLy8gbmV3IE51bWJlcigxKSAgICAgZmFsc2VcbiAgICAvLyBuZXcgTnVtYmVyKCkgICAgICBmYWxzZVxuICAgIC8vIG51bGwgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyB0cnVlICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gdW5kZWZpbmVkICAgICAgICAgICBmYWxzZVxuICAgIC8vIC8geyBoaSA6ICdieWUnIH0gICAgdHJ1ZVxuICAgIC8vIC8ge30gICAgICAgICAgICAgICAgdHJ1ZVxuICAgIHJldHVybiB7fS50b1N0cmluZy5jYWxsKG9iaikgPT0gJ1tvYmplY3QgT2JqZWN0XSdcbn1cblxuLy8gKiAgdW5kZXJzY29yZS5qc1xuZnVuY3Rpb24gaXNPYmplY3Qob2JqKTogYm9vbGVhbiB7XG4gICAgLy8gMCAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIDEgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnJyAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gJyAnICAgICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vICcwJyAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyAnMScgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gKCk9Pnt9ICAgICAgICAgICAgICBmYWxzZVxuICAgIC8vIEJvb2xlYW4gICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBCb29sZWFuKCkgICAgICAgICAgIGZhbHNlXG4gICAgLy8gRnVuY3Rpb24gICAgICAgICAgICBmYWxzZVxuICAgIC8vIEZ1bmN0aW9uKCkgICAgICAgICAgZmFsc2VcbiAgICAvLyBOdW1iZXIgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gTnVtYmVyKCkgICAgICAgICAgICBmYWxzZVxuICAgIC8vIC8gWyAxIF0gICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIC8gW10gICAgICAgICAgICAgICAgdHJ1ZVxuICAgIC8vIGZhbHNlICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyBmdW5jdGlvbigpe30gICAgICAgIGZhbHNlXG4gICAgLy8gLyBuZXcgQm9vbGVhbigpICAgICB0cnVlXG4gICAgLy8gLyBuZXcgQm9vbGVhbihmYWxzZSl0cnVlXG4gICAgLy8gLyBuZXcgQm9vbGVhbih0cnVlKSB0cnVlXG4gICAgLy8gbmV3IEZ1bmN0aW9uKCkgICAgICBmYWxzZVxuICAgIC8vIC8gbmV3IE51bWJlcigwKSAgICAgdHJ1ZVxuICAgIC8vIC8gbmV3IE51bWJlcigxKSAgICAgdHJ1ZVxuICAgIC8vIC8gbmV3IE51bWJlcigpICAgICAgdHJ1ZVxuICAgIC8vIG51bGwgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAvLyB0cnVlICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgLy8gdW5kZWZpbmVkICAgICAgICAgICBmYWxzZVxuICAgIC8vIC8geyBoaSA6ICdieWUnIH0gICAgdHJ1ZVxuICAgIC8vIC8ge30gICAgICAgICAgICAgICAgdHJ1ZVxuICAgIHJldHVybiB0eXBlb2Ygb2JqID09PSAnb2JqZWN0JyAmJiAhIW9iajtcbn1cblxuXG5mdW5jdGlvbiBzaGFsbG93UHJvcGVydHk8VD4oa2V5OiBzdHJpbmcpOiAob2JqOiBUKSA9PiBUIGV4dGVuZHMgbnVsbCA/IHVuZGVmaW5lZCA6IFRba2V5b2YgVF0ge1xuICAgIHJldHVybiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIC8vID09IG51bGwgdHJ1ZSBmb3IgdW5kZWZpbmVkXG4gICAgICAgIHJldHVybiBvYmogPT0gbnVsbCA/IHZvaWQgMCA6IG9ialtrZXldO1xuICAgIH07XG59XG5cblxuZnVuY3Rpb24gZ2V0TGVuZ3RoKGNvbGxlY3Rpb24pOiBudW1iZXIge1xuICAgIHJldHVybiBzaGFsbG93UHJvcGVydHkoJ2xlbmd0aCcpKGNvbGxlY3Rpb24pXG59XG5cblxuZnVuY3Rpb24gYW55KC4uLmFyZ3M6IGFueVtdKTogYm9vbGVhbiB7XG4gICAgZm9yIChsZXQgYSBvZiBhcmdzKSB7XG4gICAgICAgIGlmIChib29sKGEpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cblxuZnVuY3Rpb24gYWxsKC4uLmFyZ3M6IGFueSk6IGJvb2xlYW4ge1xuICAgIGZvciAobGV0IGEgb2YgYXJncykge1xuICAgICAgICBpZiAoIWJvb2woYSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuXG5mdW5jdGlvbiBzdW0oYXJyOiBhbnlbXSk6IG51bWJlciB8IHVuZGVmaW5lZCB7XG4gICAgbGV0IHN1bSA9IDA7XG4gICAgbGV0IGRpcnR5ID0gZmFsc2U7XG4gICAgZm9yIChsZXQgdiBvZiBhcnIpIHtcbiAgICAgICAgbGV0IG51bWJlciA9IHBhcnNlRmxvYXQodik7XG4gICAgICAgIGlmICghaXNOYU4obnVtYmVyKSkge1xuICAgICAgICAgICAgZGlydHkgPSB0cnVlO1xuICAgICAgICAgICAgc3VtICs9IG51bWJlcjtcbiAgICAgICAgfVxuXG4gICAgfVxuICAgIHJldHVybiAhZGlydHkgPyB1bmRlZmluZWQgOiBzdW07XG59XG5cbmZ1bmN0aW9uIGdldEN1cnJlbnRXaW5kb3coKSB7XG4gICAgcmV0dXJuIHJlbW90ZS5nZXRDdXJyZW50V2luZG93KCk7XG59XG5cbmZ1bmN0aW9uIHJlbG9hZFBhZ2UoKSB7XG4gICAgaWYgKHJlcXVpcmUoXCIuL0dsb2JcIikuZGVmYXVsdC5CaWdDb25maWcuZGV2Lm5vX3JlbG9hZF9vbl9zdWJtaXQoKSkge1xuICAgICAgICByZXR1cm5cbiAgICB9XG4gICAgZ2V0Q3VycmVudFdpbmRvdygpLnJlbG9hZCgpO1xufVxuXG5mdW5jdGlvbiogcmFuZ2Uoc3RhcnQ6IG51bWJlciwgc3RvcDogbnVtYmVyKTogR2VuZXJhdG9yPG51bWJlcj4ge1xuICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSBzdG9wOyBpKyspIHtcbiAgICAgICAgeWllbGQgaTtcbiAgICB9XG5cbn1cblxuLyoqSnVzdCB0aGUgYmFzZW5hbWUqL1xuYXN5bmMgZnVuY3Rpb24gdGFrZVNjcmVlbnNob3QoZGlybmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3Qgd2ViQ29udGVudHMgPSByZW1vdGUuZ2V0Q3VycmVudFdlYkNvbnRlbnRzKCk7XG4gICAgY29uc3QgaW1hZ2UgPSBhd2FpdCB3ZWJDb250ZW50cy5jYXB0dXJlUGFnZSgpO1xuICAgIG15ZnMuY3JlYXRlSWZOb3RFeGlzdHMoU0VTU0lPTl9QQVRIX0FCUyk7XG4gICAgY29uc3QgZGlybmFtZUFicyA9IHBhdGguam9pbihTRVNTSU9OX1BBVEhfQUJTLCBkaXJuYW1lKTtcbiAgICBteWZzLmNyZWF0ZUlmTm90RXhpc3RzKGRpcm5hbWVBYnMpO1xuICAgIGNvbnN0IGZpbGVzID0geyBwbmc6IHVuZGVmaW5lZCwgaHRtbDogdW5kZWZpbmVkIH07XG4gICAgaWYgKGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKGRpcm5hbWVBYnMsICdwYWdlLnBuZycpKSkge1xuICAgICAgICBmaWxlcy5wbmcgPSBgJHtkaXJuYW1lQWJzfS9wYWdlX18ke25ldyBEYXRlKCkuaHVtYW4oKX0ucG5nYFxuICAgIH0gZWxzZSB7XG4gICAgICAgIGZpbGVzLnBuZyA9IHBhdGguam9pbihkaXJuYW1lQWJzLCAncGFnZS5wbmcnKTtcbiAgICB9XG4gICAgZnMud3JpdGVGaWxlU3luYyhmaWxlcy5wbmcsIGltYWdlLnRvUE5HKCkpO1xuICAgIGlmIChmcy5leGlzdHNTeW5jKHBhdGguam9pbihkaXJuYW1lQWJzLCAnc2NyZWVuc2hvdC5odG1sJykpKSB7XG4gICAgICAgIGZpbGVzLmh0bWwgPSBgJHtkaXJuYW1lQWJzfS9zY3JlZW5zaG90X18ke25ldyBEYXRlKCkuaHVtYW4oKX0uaHRtbGBcbiAgICB9IGVsc2Uge1xuICAgICAgICBmaWxlcy5odG1sID0gcGF0aC5qb2luKGRpcm5hbWVBYnMsICdzY3JlZW5zaG90Lmh0bWwnKTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHdlYkNvbnRlbnRzLnNhdmVQYWdlKGZpbGVzLmh0bWwsIFwiSFRNTENvbXBsZXRlXCIpO1xufVxuXG5mdW5jdGlvbiBpZ25vcmVFcnIoZm46IFN5bmNGdW5jdGlvbikge1xuICAgIHRyeSB7XG4gICAgICAgIGZuKCk7XG5cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgSUdOT1JFRCBFUlJPUjogYCwgZSk7XG4gICAgfVxufVxuXG5leHBvcnQge1xuICAgIGFsbCxcbiAgICBhbnksXG4gICAgYm9vbCxcbiAgICBlbnVtZXJhdGUsXG4gICAgZ2V0Q3VycmVudFdpbmRvdyxcbiAgICBpZ25vcmVFcnIsXG4gICAgaXNBcnJheSxcbiAgICBpc0Z1bmN0aW9uLFxuICAgIGlzU3RyaW5nLFxuICAgIGlzT2JqZWN0LFxuICAgIHJhbmdlLFxuICAgIHJlbG9hZFBhZ2UsXG4gICAgc3RyLFxuICAgIHN1bSxcbiAgICB0YWtlU2NyZWVuc2hvdCxcbiAgICB3YWl0LFxuICAgIHdhaXRVbnRpbFxufVxuXG4iXX0=