"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
console.log('src/MyAlert/index.ts');
const sweetalert2_1 = require("sweetalert2");
const bhe_1 = require("../bhe");
const path = require("path");
const util_1 = require("../util");
const swalTypes = {
    info: 0,
    success: 1,
    question: 2,
    warning: 3,
    error: 4
};
function activeIsToast() {
    if (!sweetalert2_1.default.isVisible()) {
        return false;
    }
    return sweetalert2_1.default.getPopup().classList.contains('swal2-toast');
}
function activeType() {
    if (!sweetalert2_1.default.isVisible()) {
        return undefined;
    }
    const classes = sweetalert2_1.default.getIcons().find(div => div.style.display != 'none').classList.value;
    for (let type of ['success', 'error', 'warning', 'info', 'question']) {
        if (classes.includes(type)) {
            return type;
        }
    }
    console.warn(`MyAlert.index.ts activeType() couldnt find type. classes: ${classes}`);
}
async function generic(options) {
    let propname;
    let propval;
    function _format_value(_propval) {
        if (typeof _propval === 'string') {
            if (_propval.includes('\n')) {
                _propval = _propval.replaceAll('\n', '<br>');
            }
        }
        else if (util_1.isObject(_propval)) {
            _propval = JSON.stringify(_propval);
        }
        return _propval;
    }
    if (options.text || options.html) {
        if (options.text) {
            propname = 'text';
            propval = options.text;
        }
        else if (options.html) {
            propname = 'html';
            propval = options.html;
        }
        propval = _format_value(propval);
        options[propname] = propval;
    }
    if (options.title) {
        options['title'] = _format_value(options.title);
    }
    options = Object.assign({ animation: false, width: '90vw', position: options.toast ? "bottom" : "center", showConfirmButton: !options.toast, timer: 8000 }, options);
    if (sweetalert2_1.default.isVisible()) {
        const takePrecedence = (!options.toast && activeIsToast()) || (swalTypes[options.type] > swalTypes[activeType()]);
        if (takePrecedence) {
            return sweetalert2_1.default.fire(options);
        }
        const currentQueueStep = sweetalert2_1.default.getQueueStep();
        if (currentQueueStep === null) {
            const timedout = !(await util_1.waitUntil(() => !sweetalert2_1.default.isVisible(), 500, 60000));
            if (timedout) {
                console.warn(`Swal.generic() | time out waiting for existing swal to close`);
                return undefined;
            }
            const results = await sweetalert2_1.default.queue([options]);
            return results[0];
        }
        else {
            sweetalert2_1.default.insertQueueStep(options);
            return;
        }
    }
    const results = await sweetalert2_1.default.queue([options]);
    return results[0];
}
const smallMixin = sweetalert2_1.default.mixin({
    position: "bottom-start",
    showConfirmButton: false,
    timer: 8000,
    toast: true,
});
const withConfirm = {
    cancelButtonText: "No",
    confirmButtonText: "Yes",
    showCancelButton: true,
    showConfirmButton: true,
    timer: null,
};
const blockingOptions = {
    allowEnterKey: false,
    allowEscapeKey: false,
    allowOutsideClick: false,
    showCancelButton: false,
    showCloseButton: false,
    showConfirmButton: false,
    timer: null
};
const threeButtonsOptions = Object.assign(Object.assign({}, blockingOptions), { showConfirmButton: true, showCancelButton: true });
const blockingSwalMixin = sweetalert2_1.default.mixin(blockingOptions);
const small = {
    _question(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'question' }));
    },
    _info(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'info' }));
    },
    _success(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'success' }));
    },
    _error(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'error' }));
    },
    _warning(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { showConfirmButton: true, type: 'warning' }));
    },
    error(title, text) {
        return smallMixin.fire({
            title,
            text,
            type: "error",
        });
    },
    info(title, text = null, showConfirmBtns = false) {
        let infoOptions = {
            title,
            text,
            type: "info",
        };
        if (showConfirmBtns) {
            infoOptions = Object.assign(Object.assign({}, infoOptions), withConfirm);
        }
        return smallMixin.fire(infoOptions);
    },
    success(title, text = null) {
        return generic({
            title,
            text,
            type: "success",
            toast: true
        });
    },
    warning(title, text = null) {
        let warningOptions = {
            title,
            text,
            showConfirmButton: true,
            timer: null,
            type: "warning"
        };
        return smallMixin.fire(warningOptions);
    },
};
const big = {
    async error(options) {
        var _a;
        if (((_a = options) === null || _a === void 0 ? void 0 : _a.html) instanceof Error) {
            const error = options.html;
            const { what, where, cleanstack } = error.toObj();
            console.warn('Error!', error, { cleanstack });
            options.html = `${what}<p>${where}</p>`;
        }
        const dirname = new Date().human();
        const { default: Glob } = require('../Glob');
        if (LOG || !Glob.BigConfig.get('dev')) {
            options.onOpen = async () => {
                await util_1.takeScreenshot(dirname);
            };
            options.onAfterClose = async () => {
                await util_1.wait(500);
                await util_1.takeScreenshot(dirname);
            };
            options.html += `<p>Logs and screenshot saved to errors/${path.basename(SESSION_PATH_ABS)}/${dirname}</p>`;
        }
        return blockingSwalMixin.fire(Object.assign({ type: 'error', showConfirmButton: true }, options));
    },
    warning(options) {
        return this.oneButton(Object.assign({ type: 'warning' }, options));
    },
    async confirm(options) {
        const { value } = await this.oneButton(Object.assign({ type: 'question', cancelButtonText: "No", confirmButtonText: "Yes", showCancelButton: true, showConfirmButton: true }, options));
        return !!value;
    },
    blocking(options, moreOptions) {
        if (moreOptions && moreOptions.strings && moreOptions.clickFn) {
            let { strings, clickFn } = moreOptions;
            let paragraphs = strings
                .map(s => bhe_1.paragraph({ cls: 'clickable', text: s }))
                .map(pElem => pElem.click(() => clickFn(pElem)));
            options = Object.assign(Object.assign({}, options), { onBeforeOpen(modalElement) {
                    console.log('modalElement:', modalElement);
                    return bhe_1.elem({ byid: 'swal2-content' })
                        .append(...paragraphs);
                } });
        }
        else {
            options = Object.assign({ showConfirmButton: true, showCancelButton: true }, options);
        }
        if (options.showConfirmButton || options.showCancelButton || options.onOpen) {
            return sweetalert2_1.default.fire(Object.assign(Object.assign({}, blockingOptions), options));
        }
        else {
            return new Promise(resolve => sweetalert2_1.default.fire(Object.assign(Object.assign(Object.assign({}, blockingOptions), options), { onOpen: v => resolve(v) })));
        }
    },
    oneButton(options) {
        return generic(Object.assign(Object.assign(Object.assign({}, blockingOptions), { showConfirmButton: true }), options));
    },
    async twoButtons(options) {
        const { value } = await sweetalert2_1.default.fire(Object.assign({ showCancelButton: true }, options));
        return value ? "confirm" : "second";
    },
    async threeButtons(options) {
        let thirdButtonCss;
        if (options.thirdButtonType === "warning") {
            thirdButtonCss = { backgroundColor: '#FFC66D', color: 'black' };
        }
        console.log({ thirdButtonCss });
        let action;
        const onBeforeOpen = (modal) => {
            let el = bhe_1.elem({
                htmlElement: modal,
                children: { actions: '.swal2-actions' }
            });
            el.actions.append(bhe_1.button({ cls: `swal2-confirm swal2-styled`, html: options.thirdButtonText })
                .css(thirdButtonCss)
                .click(async (ev) => {
                action = "third";
                sweetalert2_1.default.clickConfirm();
            }));
        };
        options = Object.assign(Object.assign({}, options), { onBeforeOpen, showCancelButton: true });
        const { value } = await sweetalert2_1.default.fire(options);
        if (value) {
            if (action === undefined) {
                action = "confirm";
            }
        }
        else {
            action = "cancel";
        }
        return action;
    }
};
exports.default = Object.assign({ small, big }, sweetalert2_1.default);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUdBLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUNwQyw2Q0FBd0Y7QUFDeEYsZ0NBQW9FO0FBQ3BFLDZCQUE2QjtBQUM3QixrQ0FBb0U7QUFFcEUsTUFBTSxTQUFTLEdBQUc7SUFDZCxJQUFJLEVBQUUsQ0FBQztJQUNQLE9BQU8sRUFBRSxDQUFDO0lBQ1YsUUFBUSxFQUFFLENBQUM7SUFDWCxPQUFPLEVBQUUsQ0FBQztJQUNWLEtBQUssRUFBRSxDQUFDO0NBQ1gsQ0FBQztBQUVGLFNBQVMsYUFBYTtJQUNsQixJQUFJLENBQUMscUJBQUksQ0FBQyxTQUFTLEVBQUUsRUFBRTtRQUNuQixPQUFPLEtBQUssQ0FBQztLQUNoQjtJQUVELE9BQU8scUJBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxDQUFBO0FBQzVELENBQUM7QUFFRCxTQUFTLFVBQVU7SUFDZixJQUFJLENBQUMscUJBQUksQ0FBQyxTQUFTLEVBQUUsRUFBRTtRQUNuQixPQUFPLFNBQVMsQ0FBQTtLQUNuQjtJQUNELE1BQU0sT0FBTyxHQUFHLHFCQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLElBQUksTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztJQUN6RixLQUFLLElBQUksSUFBSSxJQUFJLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFVBQVUsQ0FBQyxFQUFFO1FBQ2xFLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUN4QixPQUFPLElBQXNCLENBQUE7U0FDaEM7S0FDSjtJQUNELE9BQU8sQ0FBQyxJQUFJLENBQUMs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QUFJLEtBQUssRUFBRTtZQUVQLElBQUksTUFBTSxLQUFLLFNBQVMsRUFBRTtnQkFDdEIsTUFBTSxHQUFHLFNBQVMsQ0FBQzthQUN0QjtTQUNKO2FBQU07WUFDSCxNQUFNLEdBQUcsUUFBUSxDQUFDO1NBQ3JCO1FBRUQsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQztDQUNKLENBQUM7QUFFRixrQ0FBaUIsS0FBSyxFQUFFLEdBQUcsSUFBSyxxQkFBSSxFQUFHIiwic291cmNlc0NvbnRlbnQiOlsiLyoqaW1wb3J0IEFsZXJ0IGZyb20gJ015QWxlcnQnIChvciBhbnkgb3RoZXIgbmFtZSkqL1xuXG5cbmNvbnNvbGUubG9nKCdzcmMvTXlBbGVydC9pbmRleC50cycpO1xuaW1wb3J0IFN3YWwsIHsgU3dlZXRBbGVydE9wdGlvbnMsIFN3ZWV0QWxlcnRSZXN1bHQsIFN3ZWV0QWxlcnRUeXBlIH0gZnJvbSAnc3dlZXRhbGVydDInO1xuaW1wb3J0IHsgQmV0dGVySFRNTEVsZW1lbnQsIGJ1dHRvbiwgZWxlbSwgcGFyYWdyYXBoIH0gZnJvbSBcIi4uL2JoZVwiO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHsgaXNPYmplY3QsIHRha2VTY3JlZW5zaG90LCB3YWl0LCB3YWl0VW50aWwgfSBmcm9tIFwiLi4vdXRpbFwiO1xuXG5jb25zdCBzd2FsVHlwZXMgPSB7XG4gICAgaW5mbzogMCxcbiAgICBzdWNjZXNzOiAxLFxuICAgIHF1ZXN0aW9uOiAyLFxuICAgIHdhcm5pbmc6IDMsXG4gICAgZXJyb3I6IDRcbn07XG5cbmZ1bmN0aW9uIGFjdGl2ZUlzVG9hc3QoKTogYm9vbGVhbiB7XG4gICAgaWYgKCFTd2FsLmlzVmlzaWJsZSgpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHJldHVybiBTd2FsLmdldFBvcHVwKCkuY2xhc3NMaXN0LmNvbnRhaW5zKCdzd2FsMi10b2FzdCcpXG59XG5cbmZ1bmN0aW9uIGFjdGl2ZVR5cGUoKTogU3dlZXRBbGVydFR5cGUge1xuICAgIGlmICghU3dhbC5pc1Zpc2libGUoKSkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgfVxuICAgIGNvbnN0IGNsYXNzZXMgPSBTd2FsLmdldEljb25zKCkuZmluZChkaXYgPT4gZGl2LnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKS5jbGFzc0xpc3QudmFsdWU7XG4gICAgZm9yIChsZXQgdHlwZSBvZiBbJ3N1Y2Nlc3MnLCAnZXJyb3InLCAnd2FybmluZycsICdpbmZvJywgJ3F1ZXN0aW9uJ10pIHtcbiAgICAgICAgaWYgKGNsYXNzZXMuaW5jbHVkZXModHlwZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0eXBlIGFzIFN3ZWV0QWxlcnRUeXBlXG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc29sZS53YXJuKGBNeUFsZXJ0LmluZGV4LnRzIGFjdGl2ZVR5cGUoKSBjb3VsZG50IGZpbmQgdHlwZS4gY2xhc3NlczogJHtjbGFzc2VzfWApXG59XG5cbi8qKkNvbnZlcnRzIG5ld2xpbmVzIHRvIGh0bWwgPGJyPiwgYWVzdGhldGljIGRlZmF1bHRzICh0aW1lcjpudWxsKSwgYW5kIG1hbmFnZXMgU3dhbCBxdWV1ZS4qL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJpYyhvcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4ge1xuICAgIGxldCBwcm9wbmFtZTtcbiAgICBsZXQgcHJvcHZhbDtcblxuICAgIGZ1bmN0aW9uIF9mb3JtYXRfdmFsdWUoX3Byb3B2YWwpOiBzdHJpbmcge1xuICAgICAgICBpZiAodHlwZW9mIF9wcm9wdmFsID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgaWYgKF9wcm9wdmFsLmluY2x1ZGVzKCdcXG4nKSkge1xuICAgICAgICAgICAgICAgIF9wcm9wdmFsID0gX3Byb3B2YWwucmVwbGFjZUFsbCgnXFxuJywgJzxicj4nKVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGlzT2JqZWN0KF9wcm9wdmFsKSkge1xuICAgICAgICAgICAgX3Byb3B2YWwgPSBKU09OLnN0cmluZ2lmeShfcHJvcHZhbClcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX3Byb3B2YWxcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy50ZXh0IHx8IG9wdGlvbnMuaHRtbCkge1xuICAgICAgICBpZiAob3B0aW9ucy50ZXh0KSB7XG4gICAgICAgICAgICBwcm9wbmFtZSA9ICd0ZXh0JztcbiAgICAgICAgICAgIHByb3B2YWwgPSBvcHRpb25zLnRleHQ7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5odG1sKSB7XG4gICAgICAgICAgICBwcm9wbmFtZSA9ICdodG1sJztcbiAgICAgICAgICAgIHByb3B2YWwgPSBvcHRpb25zLmh0bWw7XG4gICAgICAgIH1cbiAgICAgICAgcHJvcHZhbCA9IF9mb3JtYXRfdmFsdWUocHJvcHZhbCk7XG4gICAgICAgIG9wdGlvbnNbcHJvcG5hbWVdID0gcHJvcHZhbDtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMudGl0bGUpIHtcbiAgICAgICAgb3B0aW9uc1sndGl0bGUnXSA9IF9mb3JtYXRfdmFsdWUob3B0aW9ucy50aXRsZSlcbiAgICB9XG4gICAgb3B0aW9ucyA9IHtcbiAgICAgICAgYW5pbWF0aW9uOiBmYWxzZSxcbiAgICAgICAgd2lkdGg6ICc5MHZ3JyxcbiAgICAgICAgcG9zaXRpb246IG9wdGlvbnMudG9hc3QgPyBcImJvdHRvbVwiIDogXCJjZW50ZXJcIixcbiAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246ICFvcHRpb25zLnRvYXN0LFxuICAgICAgICB0aW1lcjogODAwMCxcbiAgICAgICAgLy8gdGltZXI6IG51bGwsXG4gICAgICAgIC4uLm9wdGlvbnNcbiAgICB9O1xuICAgIGlmIChTd2FsLmlzVmlzaWJsZSgpKSB7XG4gICAgICAgIC8vIG5vdC10b2FzdCB0cnVtcHMgdG9hc3QsIHdhcm5pbmcgdHJ1bXBzIHN1Y2Nlc3NcbiAgICAgICAgY29uc3QgdGFrZVByZWNlZGVuY2UgPSAoIW9wdGlvbnMudG9hc3QgJiYgYWN0aXZlSXNUb2FzdCgpKSB8fCAoc3dhbFR5cGVzW29wdGlvbnMudHlwZV0gPiBzd2FsVHlwZXNbYWN0aXZlVHlwZSgpXSk7XG4gICAgICAgIGlmICh0YWtlUHJlY2VkZW5jZSkge1xuICAgICAgICAgICAgcmV0dXJuIFN3YWwuZmlyZShvcHRpb25zKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGN1cnJlbnRRdWV1ZVN0ZXAgPSBTd2FsLmdldFF1ZXVlU3RlcCgpO1xuICAgICAgICBpZiAoY3VycmVudFF1ZXVlU3RlcCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgLy8gKiBTd2FsIGV4aXN0cywgYnV0IGZpcmVkIHRocm91Z2ggYGZpcmVgIGFuZCBub3QgYHF1ZXVlYFxuICAgICAgICAgICAgY29uc3QgdGltZWRvdXQgPSAhKGF3YWl0IHdhaXRVbnRpbCgoKSA9PiAhU3dhbC5pc1Zpc2libGUoKSwgNTAwLCA2MDAwMCkpO1xuICAgICAgICAgICAgaWYgKHRpbWVkb3V0KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBTd2FsLmdlbmVyaWMoKSB8IHRpbWUgb3V0IHdhaXRpbmcgZm9yIGV4aXN0aW5nIHN3YWwgdG8gY2xvc2VgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgU3dhbC5xdWV1ZShbb3B0aW9uc10pO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHNbMF1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vICogU3dhbCBleGlzdHMsIGFuZCBmaXJlZCB0aHJvdWdoIGBxdWV1ZWBcbiAgICAgICAgICAgIFN3YWwuaW5zZXJ0UXVldWVTdGVwKG9wdGlvbnMpO1xuICAgICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgU3dhbC5xdWV1ZShbb3B0aW9uc10pO1xuICAgIHJldHVybiByZXN1bHRzWzBdXG59XG5cbmNvbnN0IHNtYWxsTWl4aW46IHR5cGVvZiBTd2FsID0gU3dhbC5taXhpbih7XG4gICAgcG9zaXRpb246IFwiYm90dG9tLXN0YXJ0XCIsXG4gICAgc2hvd0NvbmZpcm1CdXR0b246IGZhbHNlLFxuICAgIHRpbWVyOiA4MDAwLFxuICAgIHRvYXN0OiB0cnVlLFxuXG59KTtcbmNvbnN0IHdpdGhDb25maXJtOiBTd2VldEFsZXJ0T3B0aW9ucyA9IHtcbiAgICBjYW5jZWxCdXR0b25UZXh0OiBcIk5vXCIsXG4gICAgY29uZmlybUJ1dHRvblRleHQ6IFwiWWVzXCIsXG4gICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSxcbiAgICB0aW1lcjogbnVsbCxcblxufTtcbmNvbnN0IGJsb2NraW5nT3B0aW9uczogU3dlZXRBbGVydE9wdGlvbnMgPSB7XG4gICAgYWxsb3dFbnRlcktleTogZmFsc2UsXG4gICAgYWxsb3dFc2NhcGVLZXk6IGZhbHNlLFxuICAgIGFsbG93T3V0c2lkZUNsaWNrOiBmYWxzZSxcbiAgICBzaG93Q2FuY2VsQnV0dG9uOiBmYWxzZSwgLy8gZGVmYXVsdCBmYWxzZVxuICAgIHNob3dDbG9zZUJ1dHRvbjogZmFsc2UsIC8vIGRlZmF1bHQgZmFsc2VcbiAgICBzaG93Q29uZmlybUJ1dHRvbjogZmFsc2UsXG4gICAgdGltZXI6IG51bGxcbiAgICAvLyB3aWR0aCA6IFwiOTB2d1wiLFxuXG5cbn07XG5jb25zdCB0aHJlZUJ1dHRvbnNPcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyA9IHtcbiAgICAuLi5ibG9ja2luZ09wdGlvbnMsXG4gICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsXG4gICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbn07XG5jb25zdCBibG9ja2luZ1N3YWxNaXhpbiA9IFN3YWwubWl4aW4oYmxvY2tpbmdPcHRpb25zKTtcbnR5cGUgU21hbGwgPSB7XG4gICAgX2Vycm9yKG9wdGlvbnM6IFN3ZWV0QWxlcnRPcHRpb25zKTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PixcbiAgICBfaW5mbyhvcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4sXG4gICAgX3F1ZXN0aW9uKG9wdGlvbnM6IFN3ZWV0QWxlcnRPcHRpb25zKTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PixcbiAgICBfc3VjY2VzcyhvcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4sXG4gICAgX3dhcm5pbmcob3B0aW9uczogU3dlZXRBbGVydE9wdGlvbnMpOiBQcm9taXNlPFN3ZWV0QWxlcnRSZXN1bHQ+LFxuICAgIGVycm9yKHRpdGxlOiBzdHJpbmcsIHRleHQ6IHN0cmluZyk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4sXG4gICAgaW5mbyh0aXRsZTogc3RyaW5nLCB0ZXh0PzogKHN0cmluZyB8IG51bGwpLCBzaG93Q29uZmlybUJ0bnM/OiBib29sZWFuKTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PixcbiAgICBzdWNjZXNzKHRpdGxlOiBzdHJpbmcsIHRleHQ/OiAoc3RyaW5nIHwgbnVsbCksIHRpbWVyPzogbnVtYmVyKTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PixcbiAgICB3YXJuaW5nKHRpdGxlOiBzdHJpbmcsIHRleHQ/OiAoc3RyaW5nIHwgbnVsbCksIHNob3dDb25maXJtQnRucz86IGJvb2xlYW4pOiBQcm9taXNlPFN3ZWV0QWxlcnRSZXN1bHQ+LFxufVxuXG5jb25zdCBzbWFsbDogU21hbGwgPSB7XG4gICAgX3F1ZXN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZSh7IC4uLm9wdGlvbnMsIHR5cGU6ICdxdWVzdGlvbicgfSlcbiAgICB9LFxuICAgIF9pbmZvKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZSh7IC4uLm9wdGlvbnMsIHR5cGU6ICdpbmZvJyB9KVxuICAgIH0sXG4gICAgX3N1Y2Nlc3Mob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gc21hbGxNaXhpbi5maXJlKHsgLi4ub3B0aW9ucywgdHlwZTogJ3N1Y2Nlc3MnIH0pXG4gICAgfSxcbiAgICBfZXJyb3Iob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gc21hbGxNaXhpbi5maXJlKHsgLi4ub3B0aW9ucywgdHlwZTogJ2Vycm9yJyB9KVxuICAgIH0sXG4gICAgX3dhcm5pbmcob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gc21hbGxNaXhpbi5maXJlKHtcbiAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbjogdHJ1ZSwgdHlwZTogJ3dhcm5pbmcnXG4gICAgICAgIH0pXG4gICAgfSxcbiAgICBlcnJvcih0aXRsZSwgdGV4dCkge1xuICAgICAgICByZXR1cm4gc21hbGxNaXhpbi5maXJlKHtcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHR5cGU6IFwiZXJyb3JcIixcblxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGluZm8odGl0bGUsIHRleHQgPSBudWxsLCBzaG93Q29uZmlybUJ0bnMgPSBmYWxzZSkge1xuICAgICAgICBsZXQgaW5mb09wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0eXBlOiBcImluZm9cIixcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHNob3dDb25maXJtQnRucykge1xuICAgICAgICAgICAgaW5mb09wdGlvbnMgPSB7IC4uLmluZm9PcHRpb25zLCAuLi53aXRoQ29uZmlybSB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZShpbmZvT3B0aW9ucyk7XG4gICAgfSxcbiAgICBzdWNjZXNzKHRpdGxlLCB0ZXh0ID0gbnVsbCkge1xuXG4gICAgICAgIHJldHVybiBnZW5lcmljKHtcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHR5cGU6IFwic3VjY2Vzc1wiLFxuICAgICAgICAgICAgdG9hc3Q6IHRydWVcbiAgICAgICAgfSlcbiAgICB9LFxuICAgIHdhcm5pbmcodGl0bGUsIHRleHQgPSBudWxsKSB7XG4gICAgICAgIGxldCB3YXJuaW5nT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgdGltZXI6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIlxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZSh3YXJuaW5nT3B0aW9ucyk7XG4gICAgfSxcblxufTtcbmV4cG9ydCB0eXBlIENyZWF0ZUNvbmZpcm1UaGlyZCA9IFwiY29uZmlybVwiIHwgXCJjYW5jZWxcIiB8IFwidGhpcmRcIjtcbnR5cGUgQmlnID0ge1xuXG4gICAgZXJyb3Iob3B0aW9uczogT21pdDxTd2VldEFsZXJ0T3B0aW9ucywgJ29uT3BlbicgfCAnb25BZnRlckNsb3NlJz4gJiB7IGh0bWw6IHN0cmluZyB8IEVycm9yIH0pOiBQcm9taXNlPFN3ZWV0QWxlcnRSZXN1bHQ+LFxuICAgIHdhcm5pbmcob3B0aW9uczogU3dlZXRBbGVydE9wdGlvbnMpOiBQcm9taXNlPFN3ZWV0QWxlcnRSZXN1bHQ+LFxuICAgIGNvbmZpcm0ob3B0aW9uczogU3dlZXRBbGVydE9wdGlvbnMpOiBQcm9taXNlPGJvb2xlYW4+LFxuICAgIGJsb2NraW5nKG9wdGlvbnM6IFN3ZWV0QWxlcnRPcHRpb25zLCBtb3JlT3B0aW9ucz86IHsgc3RyaW5nczogc3RyaW5nW10sIGNsaWNrRm46IChiaGU6IEJldHRlckhUTUxFbGVtZW50KSA9PiBhbnkgfSk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4sXG4gICAgb25lQnV0dG9uKG9wdGlvbnM/OiBTd2VldEFsZXJ0T3B0aW9ucyk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4sXG4gICAgdHdvQnV0dG9ucyhvcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyk6IFByb21pc2U8XCJjb25maXJtXCIgfCBcInNlY29uZFwiPlxuICAgIHRocmVlQnV0dG9ucyhvcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyAmIHsgdGhpcmRCdXR0b25UZXh0OiBzdHJpbmcsIHRoaXJkQnV0dG9uVHlwZT86IFwiY29uZmlybVwiIHwgXCJ3YXJuaW5nXCIgfSk6IFByb21pc2U8Q3JlYXRlQ29uZmlybVRoaXJkPlxufVxuXG5jb25zdCBiaWc6IEJpZyA9IHtcblxuICAgIGFzeW5jIGVycm9yKG9wdGlvbnMpIHtcblxuICAgICAgICBpZiAob3B0aW9ucz8uaHRtbCBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvciA9IG9wdGlvbnMuaHRtbDtcbiAgICAgICAgICAgIGNvbnN0IHsgd2hhdCwgd2hlcmUsIGNsZWFuc3RhY2sgfSA9IGVycm9yLnRvT2JqKCk7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ0Vycm9yIScsIGVycm9yLCB7IGNsZWFuc3RhY2sgfSk7XG4gICAgICAgICAgICBvcHRpb25zLmh0bWwgPSBgJHt3aGF0fTxwPiR7d2hlcmV9PC9wPmBcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkaXJuYW1lID0gbmV3IERhdGUoKS5odW1hbigpO1xuICAgICAgICBjb25zdCB7IGRlZmF1bHQ6IEdsb2IgfSA9IHJlcXVpcmUoJy4uL0dsb2InKTtcbiAgICAgICAgaWYgKExPRyB8fCAhR2xvYi5CaWdDb25maWcuZ2V0KCdkZXYnKSkge1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgb3B0aW9ucy5vbk9wZW4gPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGFrZVNjcmVlbnNob3QoZGlybmFtZSk7XG5cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBvcHRpb25zLm9uQWZ0ZXJDbG9zZSA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICBhd2FpdCB3YWl0KDUwMCk7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGFrZVNjcmVlbnNob3QoZGlybmFtZSk7XG5cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBvcHRpb25zLmh0bWwgKz0gYDxwPkxvZ3MgYW5kIHNjcmVlbnNob3Qgc2F2ZWQgdG8gZXJyb3JzLyR7cGF0aC5iYXNlbmFtZShTRVNTSU9OX1BBVEhfQUJTKX0vJHtkaXJuYW1lfTwvcD5gXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYmxvY2tpbmdTd2FsTWl4aW4uZmlyZSh7XG4gICAgICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgd2FybmluZyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9uZUJ1dHRvbih7IHR5cGU6ICd3YXJuaW5nJywgLi4ub3B0aW9ucyB9KTtcbiAgICB9LFxuICAgIGFzeW5jIGNvbmZpcm0ob3B0aW9ucykge1xuICAgICAgICBjb25zdCB7IHZhbHVlIH0gPSBhd2FpdCB0aGlzLm9uZUJ1dHRvbih7XG4gICAgICAgICAgICB0eXBlOiAncXVlc3Rpb24nLFxuICAgICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogXCJOb1wiLFxuICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiWWVzXCIsXG4gICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gISF2YWx1ZTtcbiAgICB9LFxuXG4gICAgYmxvY2tpbmcob3B0aW9ucywgbW9yZU9wdGlvbnMpIHtcblxuICAgICAgICBpZiAobW9yZU9wdGlvbnMgJiYgbW9yZU9wdGlvbnMuc3RyaW5ncyAmJiBtb3JlT3B0aW9ucy5jbGlja0ZuKSB7XG4gICAgICAgICAgICBsZXQgeyBzdHJpbmdzLCBjbGlja0ZuIH0gPSBtb3JlT3B0aW9ucztcblxuICAgICAgICAgICAgbGV0IHBhcmFncmFwaHMgPSBzdHJpbmdzXG4gICAgICAgICAgICAgICAgLy8gLm1hcChzID0+ICQoYDxwIGNsYXNzPVwiY2xpY2thYmxlXCI+JHtzfTwvcD5gKSlcbiAgICAgICAgICAgICAgICAubWFwKHMgPT4gcGFyYWdyYXBoKHsgY2xzOiAnY2xpY2thYmxlJywgdGV4dDogcyB9KSlcbiAgICAgICAgICAgICAgICAubWFwKHBFbGVtID0+IHBFbGVtLmNsaWNrKCgpID0+IGNsaWNrRm4ocEVsZW0pKSk7XG5cbiAgICAgICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBvbkJlZm9yZU9wZW4obW9kYWxFbGVtZW50OiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbW9kYWxFbGVtZW50OicsIG1vZGFsRWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtKHsgYnlpZDogJ3N3YWwyLWNvbnRlbnQnIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAuc2hvdygpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKC4uLnBhcmFncmFwaHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7IC8vIGZvcmNlIGNvbmZpcm0gYW5kIGNhbmNlbCBidXR0b25zXG4gICAgICAgICAgICBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuc2hvd0NvbmZpcm1CdXR0b24gfHwgb3B0aW9ucy5zaG93Q2FuY2VsQnV0dG9uIHx8IG9wdGlvbnMub25PcGVuKSB7XG4gICAgICAgICAgICAvLyAvIEhhcHBlbnMgd2hlbiBub3Qgb3IgYmFkIG1vcmVPcHRpb25zXG4gICAgICAgICAgICByZXR1cm4gU3dhbC5maXJlKHsgLi4uYmxvY2tpbmdPcHRpb25zLCAuLi5vcHRpb25zIH0pO1xuICAgICAgICB9IGVsc2UgeyAvLyBUT0RPOiBvbk9wZW4gOiByZXNvbHZlP1xuXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBTd2FsLmZpcmUoeyAuLi5ibG9ja2luZ09wdGlvbnMsIC4uLm9wdGlvbnMsIG9uT3BlbjogdiA9PiByZXNvbHZlKHYpIH0pKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25lQnV0dG9uKG9wdGlvbnM6IFN3ZWV0QWxlcnRPcHRpb25zKSB7XG4gICAgICAgIC8qY29uc29sZS5sb2coeyB0aXRsZSwgb3B0aW9ucyB9KTtcbiAgICAgICAgIGNvbnN0IHR5cGVvZnRpdGxlID0gdHlwZW9mIHRpdGxlO1xuICAgICAgICAgaWYgKCB0eXBlb2Z0aXRsZSA9PT0gXCJvYmplY3RcIiApIHtcbiAgICAgICAgIGlmICggb3B0aW9ucyApIHtcbiAgICAgICAgIGlmICggb3B0aW9ucy5odG1sICkge1xuICAgICAgICAgb3B0aW9ucy5odG1sICs9ICc8YnI+JztcbiAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICBvcHRpb25zLmh0bWwgPSAnJztcbiAgICAgICAgIH1cbiAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICBvcHRpb25zID0geyBodG1sIDogJycgfTtcbiAgICAgICAgIH1cbiAgICAgICAgIGlmICggdGl0bGUgaW5zdGFuY2VvZiBFcnJvciApIHtcbiAgICAgICAgIHRpdGxlID0gJ0FuIGVycm9yIGhhcyBvY2N1cnJlZCc7XG4gICAgICAgICBvcHRpb25zLmh0bWwgKz0gdGl0bGUubWVzc2FnZTtcbiAgICAgICAgIGNvbnNvbGUubG9nKHsgdGl0bGUsIG9wdGlvbnMgfSk7XG4gICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgbGV0IGh0bWwgPSBgPHN0eWxlPlxuICAgICAgICAgc3BhbiB7XG4gICAgICAgICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xuICAgICAgICAgbWFyZ2luLWxlZnQ6IDQwcHg7XG4gICAgICAgICB9XG4gICAgICAgICA8L3N0eWxlPlxuICAgICAgICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IGxlZnRcIj5cblxuICAgICAgICAgYDtcbiAgICAgICAgIGZvciAoIGxldCBrZXkgb2YgT2JqZWN0LmtleXModGl0bGUpICkge1xuICAgICAgICAgaHRtbCArPSBgPHA+PGI+JHtrZXl9OjwvYj4gPHNwYW4+JHt0aXRsZVtrZXldfTwvc3Bhbj48L3A+YFxuICAgICAgICAgfVxuICAgICAgICAgaHRtbCArPSBgPC9kaXY+YDtcbiAgICAgICAgIG9wdGlvbnMuaHRtbCArPSBodG1sO1xuICAgICAgICAgdGl0bGUgPSAnU29tZXRoaW5nIGhhcHBlbmVkJztcblxuICAgICAgICAgfVxuICAgICAgICAgfSBlbHNlIGlmICggQXJyYXkuaXNBcnJheSh0aXRsZSkgKSB7XG4gICAgICAgICB0aXRsZSA9ICdUaGlzIGlzIHdlaXJkJztcbiAgICAgICAgIG9wdGlvbnMuaHRtbCArPSB0aXRsZS5qb2luKCc8L2JyPicpXG4gICAgICAgICB9Ki9cbiAgICAgICAgcmV0dXJuIGdlbmVyaWMoe1xuICAgICAgICAgICAgLi4uYmxvY2tpbmdPcHRpb25zLFxuICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b246IHRydWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgdHdvQnV0dG9ucyhvcHRpb25zKSB7XG5cbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gYXdhaXQgU3dhbC5maXJlKHtcbiAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgICAuLi5vcHRpb25zXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiB2YWx1ZSA/IFwiY29uZmlybVwiIDogXCJzZWNvbmRcIjtcbiAgICB9LFxuICAgIGFzeW5jIHRocmVlQnV0dG9ucyhvcHRpb25zKSB7XG5cbiAgICAgICAgLy8gY29uc3QgdGhpcmRCdXR0b25UZXh0ID0gb3B0aW9ucy50aGlyZEJ1dHRvblRleHQgPz8gJ092ZXJ3cml0ZSc7XG4gICAgICAgIGxldCB0aGlyZEJ1dHRvbkNzcztcbiAgICAgICAgaWYgKG9wdGlvbnMudGhpcmRCdXR0b25UeXBlID09PSBcIndhcm5pbmdcIikge1xuICAgICAgICAgICAgdGhpcmRCdXR0b25Dc3MgPSB7IGJhY2tncm91bmRDb2xvcjogJyNGRkM2NkQnLCBjb2xvcjogJ2JsYWNrJyB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyh7IHRoaXJkQnV0dG9uQ3NzIH0pO1xuICAgICAgICBsZXQgYWN0aW9uOiBDcmVhdGVDb25maXJtVGhpcmQ7XG4gICAgICAgIGNvbnN0IG9uQmVmb3JlT3BlbiA9IChtb2RhbDogSFRNTEVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGxldCBlbCA9IGVsZW0oe1xuICAgICAgICAgICAgICAgIGh0bWxFbGVtZW50OiBtb2RhbCxcbiAgICAgICAgICAgICAgICBjaGlsZHJlbjogeyBhY3Rpb25zOiAnLnN3YWwyLWFjdGlvbnMnIH1cbiAgICAgICAgICAgIH0pIGFzIEJldHRlckhUTUxFbGVtZW50ICYgeyBhY3Rpb25zOiBCZXR0ZXJIVE1MRWxlbWVudCB9O1xuXG4gICAgICAgICAgICBlbC5hY3Rpb25zLmFwcGVuZChcbiAgICAgICAgICAgICAgICBidXR0b24oeyBjbHM6IGBzd2FsMi1jb25maXJtIHN3YWwyLXN0eWxlZGAsIGh0bWw6IG9wdGlvbnMudGhpcmRCdXR0b25UZXh0IH0pXG5cbiAgICAgICAgICAgICAgICAgICAgLmNzcyh0aGlyZEJ1dHRvbkNzcylcbiAgICAgICAgICAgICAgICAgICAgLmNsaWNrKGFzeW5jIChldjogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gXCJ0aGlyZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgU3dhbC5jbGlja0NvbmZpcm0oKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgfTtcbiAgICAgICAgb3B0aW9ucyA9IHsgLi4ub3B0aW9ucywgb25CZWZvcmVPcGVuLCBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlIH07XG4gICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IGF3YWl0IFN3YWwuZmlyZShvcHRpb25zKTtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAvLy8gRWl0aGVyIHVzZXIgY2xpY2tlZCBDb25maXJtIChhY3Rpb24gaXMgdW5kZWZpbmVkKSBvciBTd2FsLmNsaWNrQ29uZmlybSgpIChhY3Rpb24gaXMgXCJ0aGlyZFwiKVxuICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgYWN0aW9uID0gXCJjb25maXJtXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhY3Rpb24gPSBcImNhbmNlbFwiO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFjdGlvbjtcbiAgICB9XG59O1xuLy8gZXhwb3J0IGRlZmF1bHQgeyBhbGVydEZuLCBzbWFsbCwgYmlnLCBjbG9zZSA6IFN3YWwuY2xvc2UsIGlzVmlzaWJsZSA6IFN3YWwuaXNWaXNpYmxlIH07XG5leHBvcnQgZGVmYXVsdCB7IHNtYWxsLCBiaWcsIC4uLlN3YWwgfTtcbiJdfQ==