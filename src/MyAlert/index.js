"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
console.log('src/MyAlert/index.ts');
const sweetalert2_1 = require("sweetalert2");
const bhe_1 = require("../bhe");
const smallMixin = sweetalert2_1.default.mixin({
    animation: false,
    customClass: 'animated fadeIn',
    position: "bottom-start",
    showConfirmButton: false,
    timer: 8000,
    toast: true,
});
const withConfirm = {
    cancelButtonText: "No",
    confirmButtonText: "Yes",
    showCancelButton: true,
    showConfirmButton: true,
    timer: null,
};
const blockingOptions = {
    allowEnterKey: false,
    allowEscapeKey: false,
    allowOutsideClick: false,
    animation: false,
    customClass: 'animated fadeIn',
    showCancelButton: false,
    showCloseButton: false,
    showConfirmButton: false,
    width: "75vw",
};
const threeButtonsOptions = Object.assign(Object.assign({}, blockingOptions), { showConfirmButton: true, showCancelButton: true });
const blockingSwalMixin = sweetalert2_1.default.mixin(blockingOptions);
const small = {
    _question(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'question' }));
    },
    _info(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'info' }));
    },
    _success(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'success' }));
    },
    _error(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { type: 'error' }));
    },
    _warning(options) {
        return smallMixin.fire(Object.assign(Object.assign({}, options), { showConfirmButton: true, type: 'warning' }));
    },
    error(title, text) {
        return smallMixin.fire({
            title,
            text,
            type: "error",
        });
    },
    info(title, text = null, showConfirmBtns = false) {
        let infoOptions = {
            title,
            text,
            type: "info",
        };
        if (showConfirmBtns)
            infoOptions = Object.assign(Object.assign({}, infoOptions), withConfirm);
        return smallMixin.fire(infoOptions);
    },
    success(title, text = null, timer = 6000) {
        return smallMixin.fire({
            title,
            text,
            type: "success",
            timer
        });
    },
    warning(title, text = null) {
        let warningOptions = {
            title,
            text,
            showConfirmButton: true,
            timer: null,
            type: "warning"
        };
        return smallMixin.fire(warningOptions);
    },
};
const big = {
    error(options) {
        return blockingSwalMixin.fire(Object.assign({ type: 'error', showCloseButton: true }, options));
    },
    warning(options) {
        if (options.animation === false)
            options = Object.assign({ customClass: null }, options);
        return blockingSwalMixin.fire(Object.assign(Object.assign(Object.assign({}, withConfirm), { type: 'warning' }), options));
    },
    blocking(options, moreOptions) {
        if (moreOptions && moreOptions.strings && moreOptions.clickFn) {
            let { strings, clickFn } = moreOptions;
            let paragraphs = strings
                .map(s => bhe_1.paragraph({ cls: 'clickable', text: s }))
                .map(pElem => pElem.click(() => clickFn(pElem)));
            options = Object.assign(Object.assign({}, options), { onBeforeOpen(modalElement) {
                    console.log('modalElement:', modalElement);
                    return bhe_1.elem({ id: 'swal2-content' })
                        .append(...paragraphs);
                } });
        }
        else {
            options = Object.assign({ showConfirmButton: true, showCancelButton: true }, options);
        }
        if (options.showConfirmButton || options.showCancelButton || options.onOpen) {
            return sweetalert2_1.default.fire(Object.assign(Object.assign({}, blockingOptions), options));
        }
        else {
            return new Promise(resolve => sweetalert2_1.default.fire(Object.assign(Object.assign(Object.assign({}, blockingOptions), options), { onOpen: v => resolve(v) })));
        }
    },
    oneButton(title, options) {
        return blockingSwalMixin.fire(Object.assign({ title, showConfirmButton: true, timer: null, customClass: 'animated fadeIn' }, options));
    },
    async twoButtons(title, options) {
        let action;
        const { value } = await sweetalert2_1.default.fire(Object.assign({ title, showCancelButton: true }, options));
        if (value) {
            action = "confirm";
        }
        else {
            action = "cancel";
        }
        return action;
    },
    async threeButtons(options) {
        var _a, _b;
        const thirdButtonText = (_a = options.thirdButtonText, (_a !== null && _a !== void 0 ? _a : 'Overwrite'));
        const thirdButtonClass = (_b = options.thirdButtonClass, (_b !== null && _b !== void 0 ? _b : 'warn'));
        let action;
        const onBeforeOpen = (modal) => {
            let el = bhe_1.elem({
                htmlElement: modal,
                children: { actions: '.swal2-actions' }
            });
            el.actions.append(bhe_1.button({ cls: `swal2-confirm swal2-styled ${thirdButtonClass}`, html: thirdButtonText })
                .css({ backgroundColor: '#FFC66D', color: 'black' })
                .click((ev) => {
                action = "third";
                sweetalert2_1.default.clickConfirm();
            }));
        };
        options = Object.assign(Object.assign({}, options), { onBeforeOpen, showCancelButton: true });
        const { value } = await sweetalert2_1.default.fire(options);
        if (value) {
            if (action === undefined) {
                action = "confirm";
            }
        }
        else {
            action = "cancel";
        }
        return action;
    }
};
exports.default = Object.assign({ small, big }, sweetalert2_1.default);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQztBQUNwQyw2Q0FBd0U7QUFDeEUsZ0NBQW9FO0FBR3BFLE1BQU0sVUFBVSxHQUFnQixxQkFBSSxDQUFDLEtBQUssQ0FBQztJQUN2QyxTQUFTLEVBQUcsS0FBSztJQUNqQixXQUFXLEVBQUcsaUJBQWlCO0lBQy9CLFFBQVEsRUFBRyxjQUFjO0lBQ3pCLGlCQUFpQixFQUFHLEtBQUs7SUFDekIsS0FBSyxFQUFHLElBQUk7SUFDWixLQUFLLEVBQUcsSUFBSTtDQUVmLENBQUMsQ0FBQztBQUNILE1BQU0sV0FBVyxHQUFzQjtJQUNuQyxnQkFBZ0IsRUFBRyxJQUFJO0lBQ3ZCLGlCQUFpQixFQUFHLEtBQUs7SUFDekIsZ0JBQWdCLEVBQUcsSUFBSTtJQUN2QixpQkFBaUIsRUFBRyxJQUFJO0lBQ3hCLEtBQUssRUFBRyxJQUFJO0NBRWYsQ0FBQztBQUNGLE1BQU0sZUFBZSxHQUFzQjtJQUN2QyxhQUFhLEVBQUcsS0FBSztJQUNyQixjQUFjLEVBQUcsS0FBSztJQUN0QixpQkFBaUIsRUFBRyxLQUFLO0lBQ3pCLFNBQVMsRUFBRyxLQUFLO0lBQ2pCLFdBQVcsRUFBRyxpQkFBaUI7SUFDL0IsZ0JBQWdCLEVBQUcsS0FBSztJQUN4QixlQUFlLEVBQUcsS0FBSztJQUN2QixpQkFBaUIsRUFBRyxLQUFLO0lBQ3pCLEtBQUssRUFBRyxNQUFNO0NBR2pCLENBQUM7QUFDRixNQUFNLG1CQUFtQixtQ0FDbEIsZUFBZSxLQUNsQixpQkFBaUIsRUFBRyxJQUFJLEVBQ3hCLGdCQUFnQixFQUFHLElBQUksR0FDMUIsQ0FBQztBQUNGLE1BQU0saUJBQWlCLEdBQUcscUJBQUksQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLENBQUM7QUFhdEQsTUFBTSxLQUFLLEdBQVU7SUFDakIsU0FBUyxD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Z0JBQ2pCLHFCQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDeEIsQ0FBQyxDQUFDLENBQ1QsQ0FBQTtRQUNMLENBQUMsQ0FBQztRQUNGLE9BQU8sbUNBQVEsT0FBTyxLQUFFLFlBQVksRUFBRSxnQkFBZ0IsRUFBRyxJQUFJLEdBQUUsQ0FBQztRQUNoRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsTUFBTSxxQkFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMzQyxJQUFLLEtBQUssRUFBRztZQUNULElBQUssTUFBTSxLQUFLLFNBQVMsRUFBRztnQkFDeEIsTUFBTSxHQUFHLFNBQVMsQ0FBQzthQUN0QjtTQUNKO2FBQU07WUFDSCxNQUFNLEdBQUcsUUFBUSxDQUFDO1NBQ3JCO1FBRUQsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQztDQUNKLENBQUM7QUFFRixrQ0FBaUIsS0FBSyxFQUFFLEdBQUcsSUFBSyxxQkFBSSxFQUFHIiwic291cmNlc0NvbnRlbnQiOlsiLyoqaW1wb3J0IEFsZXJ0IGZyb20gJ015QWxlcnQnIChvciBhbnkgb3RoZXIgbmFtZSkqL1xuY29uc29sZS5sb2coJ3NyYy9NeUFsZXJ0L2luZGV4LnRzJyk7XG5pbXBvcnQgU3dhbCwgeyBTd2VldEFsZXJ0UmVzdWx0LCBTd2VldEFsZXJ0T3B0aW9ucyB9IGZyb20gJ3N3ZWV0YWxlcnQyJztcbmltcG9ydCB7IHBhcmFncmFwaCwgZWxlbSwgQmV0dGVySFRNTEVsZW1lbnQsIGJ1dHRvbiB9IGZyb20gXCIuLi9iaGVcIjtcblxuXG5jb25zdCBzbWFsbE1peGluOiB0eXBlb2YgU3dhbCA9IFN3YWwubWl4aW4oe1xuICAgIGFuaW1hdGlvbiA6IGZhbHNlLFxuICAgIGN1c3RvbUNsYXNzIDogJ2FuaW1hdGVkIGZhZGVJbicsXG4gICAgcG9zaXRpb24gOiBcImJvdHRvbS1zdGFydFwiLFxuICAgIHNob3dDb25maXJtQnV0dG9uIDogZmFsc2UsXG4gICAgdGltZXIgOiA4MDAwLFxuICAgIHRvYXN0IDogdHJ1ZSxcbiAgICBcbn0pO1xuY29uc3Qgd2l0aENvbmZpcm06IFN3ZWV0QWxlcnRPcHRpb25zID0ge1xuICAgIGNhbmNlbEJ1dHRvblRleHQgOiBcIk5vXCIsXG4gICAgY29uZmlybUJ1dHRvblRleHQgOiBcIlllc1wiLFxuICAgIHNob3dDYW5jZWxCdXR0b24gOiB0cnVlLFxuICAgIHNob3dDb25maXJtQnV0dG9uIDogdHJ1ZSxcbiAgICB0aW1lciA6IG51bGwsXG4gICAgXG59O1xuY29uc3QgYmxvY2tpbmdPcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyA9IHtcbiAgICBhbGxvd0VudGVyS2V5IDogZmFsc2UsXG4gICAgYWxsb3dFc2NhcGVLZXkgOiBmYWxzZSxcbiAgICBhbGxvd091dHNpZGVDbGljayA6IGZhbHNlLFxuICAgIGFuaW1hdGlvbiA6IGZhbHNlLFxuICAgIGN1c3RvbUNsYXNzIDogJ2FuaW1hdGVkIGZhZGVJbicsXG4gICAgc2hvd0NhbmNlbEJ1dHRvbiA6IGZhbHNlLCAvLyBkZWZhdWx0IGZhbHNlXG4gICAgc2hvd0Nsb3NlQnV0dG9uIDogZmFsc2UsIC8vIGRlZmF1bHQgZmFsc2VcbiAgICBzaG93Q29uZmlybUJ1dHRvbiA6IGZhbHNlLFxuICAgIHdpZHRoIDogXCI3NXZ3XCIsXG4gICAgXG4gICAgXG59O1xuY29uc3QgdGhyZWVCdXR0b25zT3B0aW9uczogU3dlZXRBbGVydE9wdGlvbnMgPSB7XG4gICAgLi4uYmxvY2tpbmdPcHRpb25zLFxuICAgIHNob3dDb25maXJtQnV0dG9uIDogdHJ1ZSxcbiAgICBzaG93Q2FuY2VsQnV0dG9uIDogdHJ1ZSxcbn07XG5jb25zdCBibG9ja2luZ1N3YWxNaXhpbiA9IFN3YWwubWl4aW4oYmxvY2tpbmdPcHRpb25zKTtcbnR5cGUgU21hbGwgPSB7XG4gICAgX2Vycm9yKG9wdGlvbnM6IFN3ZWV0QWxlcnRPcHRpb25zKTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PixcbiAgICBfaW5mbyhvcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4sXG4gICAgX3F1ZXN0aW9uKG9wdGlvbnM6IFN3ZWV0QWxlcnRPcHRpb25zKTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PixcbiAgICBfc3VjY2VzcyhvcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4sXG4gICAgX3dhcm5pbmcob3B0aW9uczogU3dlZXRBbGVydE9wdGlvbnMpOiBQcm9taXNlPFN3ZWV0QWxlcnRSZXN1bHQ+LFxuICAgIGVycm9yKHRpdGxlOiBzdHJpbmcsIHRleHQ6IHN0cmluZyk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4sXG4gICAgaW5mbyh0aXRsZTogc3RyaW5nLCB0ZXh0PzogKHN0cmluZyB8IG51bGwpLCBzaG93Q29uZmlybUJ0bnM/OiBib29sZWFuKTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PixcbiAgICBzdWNjZXNzKHRpdGxlOiBzdHJpbmcsIHRleHQ/OiAoc3RyaW5nIHwgbnVsbCksIHRpbWVyPzogbnVtYmVyKTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PixcbiAgICB3YXJuaW5nKHRpdGxlOiBzdHJpbmcsIHRleHQ/OiAoc3RyaW5nIHwgbnVsbCksIHNob3dDb25maXJtQnRucz86IGJvb2xlYW4pOiBQcm9taXNlPFN3ZWV0QWxlcnRSZXN1bHQ+LFxufVxuXG5jb25zdCBzbWFsbDogU21hbGwgPSB7XG4gICAgX3F1ZXN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZSh7IC4uLm9wdGlvbnMsIHR5cGUgOiAncXVlc3Rpb24nIH0pXG4gICAgfSxcbiAgICBfaW5mbyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBzbWFsbE1peGluLmZpcmUoeyAuLi5vcHRpb25zLCB0eXBlIDogJ2luZm8nIH0pXG4gICAgfSxcbiAgICBfc3VjY2VzcyhvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBzbWFsbE1peGluLmZpcmUoeyAuLi5vcHRpb25zLCB0eXBlIDogJ3N1Y2Nlc3MnIH0pXG4gICAgfSxcbiAgICBfZXJyb3Iob3B0aW9ucykge1xuICAgICAgICByZXR1cm4gc21hbGxNaXhpbi5maXJlKHsgLi4ub3B0aW9ucywgdHlwZSA6ICdlcnJvcicgfSlcbiAgICB9LFxuICAgIF93YXJuaW5nKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZSh7XG4gICAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b24gOiB0cnVlLCB0eXBlIDogJ3dhcm5pbmcnXG4gICAgICAgIH0pXG4gICAgfSxcbiAgICBlcnJvcih0aXRsZSwgdGV4dCkge1xuICAgICAgICByZXR1cm4gc21hbGxNaXhpbi5maXJlKHtcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHR5cGUgOiBcImVycm9yXCIsXG4gICAgICAgICAgICBcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBpbmZvKHRpdGxlLCB0ZXh0ID0gbnVsbCwgc2hvd0NvbmZpcm1CdG5zID0gZmFsc2UpIHtcbiAgICAgICAgbGV0IGluZm9PcHRpb25zID0ge1xuICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICB0ZXh0LFxuICAgICAgICAgICAgdHlwZSA6IFwiaW5mb1wiLFxuICAgICAgICB9O1xuICAgICAgICBpZiAoIHNob3dDb25maXJtQnRucyApXG4gICAgICAgICAgICBpbmZvT3B0aW9ucyA9IHsgLi4uaW5mb09wdGlvbnMsIC4uLndpdGhDb25maXJtIH07XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZShpbmZvT3B0aW9ucyk7XG4gICAgfSxcbiAgICBzdWNjZXNzKHRpdGxlLCB0ZXh0ID0gbnVsbCwgdGltZXIgPSA2MDAwKSB7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gc21hbGxNaXhpbi5maXJlKHtcbiAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHR5cGUgOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICAgIHRpbWVyXG4gICAgICAgIH0pXG4gICAgfSxcbiAgICB3YXJuaW5nKHRpdGxlLCB0ZXh0ID0gbnVsbCkge1xuICAgICAgICBsZXQgd2FybmluZ09wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICBzaG93Q29uZmlybUJ1dHRvbiA6IHRydWUsXG4gICAgICAgICAgICB0aW1lciA6IG51bGwsXG4gICAgICAgICAgICB0eXBlIDogXCJ3YXJuaW5nXCJcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcmV0dXJuIHNtYWxsTWl4aW4uZmlyZSh3YXJuaW5nT3B0aW9ucyk7XG4gICAgfSxcbiAgICBcbn07XG50eXBlIEJpZyA9IHtcbiAgICBcbiAgICBlcnJvcihvcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4sXG4gICAgd2FybmluZyhvcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyk6IFByb21pc2U8U3dlZXRBbGVydFJlc3VsdD4sXG4gICAgYmxvY2tpbmcob3B0aW9uczogU3dlZXRBbGVydE9wdGlvbnMsIG1vcmVPcHRpb25zPzogeyBzdHJpbmdzOiBzdHJpbmdbXSwgY2xpY2tGbjogKGJoZTogQmV0dGVySFRNTEVsZW1lbnQpID0+IGFueSB9KTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PixcbiAgICBvbmVCdXR0b24odGl0bGU6IHN0cmluZywgb3B0aW9ucz86IFN3ZWV0QWxlcnRPcHRpb25zKTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PixcbiAgICB0d29CdXR0b25zKHRpdGxlOiBzdHJpbmcsIG9wdGlvbnM/OiBTd2VldEFsZXJ0T3B0aW9ucyk6IFByb21pc2U8XCJjb25maXJtXCIgfCBcImNhbmNlbFwiPlxuICAgIHRocmVlQnV0dG9ucyhvcHRpb25zOiBTd2VldEFsZXJ0T3B0aW9ucyAmIHsgdGhpcmRCdXR0b25UZXh0Pzogc3RyaW5nLCB0aGlyZEJ1dHRvbkNsYXNzPzogc3RyaW5nIH0pOiBQcm9taXNlPFwiY29uZmlybVwiIHwgXCJjYW5jZWxcIiB8IFwidGhpcmRcIj5cbn1cbmNvbnN0IGJpZzogQmlnID0ge1xuICAgIGVycm9yKG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIGJsb2NraW5nU3dhbE1peGluLmZpcmUoeyB0eXBlIDogJ2Vycm9yJywgc2hvd0Nsb3NlQnV0dG9uIDogdHJ1ZSwgLi4ub3B0aW9ucyB9KTtcbiAgICB9LFxuICAgIHdhcm5pbmcob3B0aW9ucykge1xuICAgICAgICBpZiAoIG9wdGlvbnMuYW5pbWF0aW9uID09PSBmYWxzZSApXG4gICAgICAgICAgICBvcHRpb25zID0geyBjdXN0b21DbGFzcyA6IG51bGwsIC4uLm9wdGlvbnMgfTtcbiAgICAgICAgcmV0dXJuIGJsb2NraW5nU3dhbE1peGluLmZpcmUoeyAuLi53aXRoQ29uZmlybSwgdHlwZSA6ICd3YXJuaW5nJywgLi4ub3B0aW9ucyB9KTtcbiAgICB9LFxuICAgIFxuICAgIC8vIGJsb2NraW5nKG9wdGlvbnM6IFN3ZWV0QWxlcnRPcHRpb25zLCB7IHN0cmluZ3MsIGNsaWNrRm4gfSA9IHt9KTogUHJvbWlzZTxTd2VldEFsZXJ0UmVzdWx0PiB7XG4gICAgYmxvY2tpbmcob3B0aW9ucywgbW9yZU9wdGlvbnMpIHtcbiAgICAgICAgXG4gICAgICAgIGlmICggbW9yZU9wdGlvbnMgJiYgbW9yZU9wdGlvbnMuc3RyaW5ncyAmJiBtb3JlT3B0aW9ucy5jbGlja0ZuICkge1xuICAgICAgICAgICAgbGV0IHsgc3RyaW5ncywgY2xpY2tGbiB9ID0gbW9yZU9wdGlvbnM7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGxldCBwYXJhZ3JhcGhzID0gc3RyaW5nc1xuICAgICAgICAgICAgICAgIC8vIC5tYXAocyA9PiAkKGA8cCBjbGFzcz1cImNsaWNrYWJsZVwiPiR7c308L3A+YCkpXG4gICAgICAgICAgICAgICAgLm1hcChzID0+IHBhcmFncmFwaCh7IGNscyA6ICdjbGlja2FibGUnLCB0ZXh0IDogcyB9KSlcbiAgICAgICAgICAgICAgICAubWFwKHBFbGVtID0+IHBFbGVtLmNsaWNrKCgpID0+IGNsaWNrRm4ocEVsZW0pKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBvbkJlZm9yZU9wZW4obW9kYWxFbGVtZW50OiBIVE1MRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbW9kYWxFbGVtZW50OicsIG1vZGFsRWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtKHsgaWQgOiAnc3dhbDItY29udGVudCcgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC5zaG93KClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoLi4ucGFyYWdyYXBocyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHsgLy8gZm9yY2UgY29uZmlybSBhbmQgY2FuY2VsIGJ1dHRvbnNcbiAgICAgICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1CdXR0b24gOiB0cnVlLFxuICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b24gOiB0cnVlLFxuICAgICAgICAgICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmICggb3B0aW9ucy5zaG93Q29uZmlybUJ1dHRvbiB8fCBvcHRpb25zLnNob3dDYW5jZWxCdXR0b24gfHwgb3B0aW9ucy5vbk9wZW4gKSB7XG4gICAgICAgICAgICAvLyAvIEhhcHBlbnMgd2hlbiBub3Qgb3IgYmFkIG1vcmVPcHRpb25zXG4gICAgICAgICAgICByZXR1cm4gU3dhbC5maXJlKHsgLi4uYmxvY2tpbmdPcHRpb25zLCAuLi5vcHRpb25zIH0pO1xuICAgICAgICB9IGVsc2UgeyAvLyBUT0RPOiBvbk9wZW4gOiByZXNvbHZlP1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBTd2FsLmZpcmUoeyAuLi5ibG9ja2luZ09wdGlvbnMsIC4uLm9wdGlvbnMsIG9uT3BlbiA6IHYgPT4gcmVzb2x2ZSh2KSB9KSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIG9uZUJ1dHRvbih0aXRsZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gYmxvY2tpbmdTd2FsTWl4aW4uZmlyZSh7XG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uIDogdHJ1ZSxcbiAgICAgICAgICAgIHRpbWVyIDogbnVsbCxcbiAgICAgICAgICAgIGN1c3RvbUNsYXNzIDogJ2FuaW1hdGVkIGZhZGVJbicsIC4uLm9wdGlvbnNcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyB0d29CdXR0b25zKHRpdGxlLCBvcHRpb25zKSB7XG4gICAgICAgIGxldCBhY3Rpb246IFwiY29uZmlybVwiIHwgXCJjYW5jZWxcIjtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IGF3YWl0IFN3YWwuZmlyZSh7IHRpdGxlLCBzaG93Q2FuY2VsQnV0dG9uIDogdHJ1ZSwgLi4ub3B0aW9ucyB9KTtcbiAgICAgICAgaWYgKCB2YWx1ZSApIHtcbiAgICAgICAgICAgIGFjdGlvbiA9IFwiY29uZmlybVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYWN0aW9uID0gXCJjYW5jZWxcIjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGFjdGlvbjtcbiAgICB9LFxuICAgIGFzeW5jIHRocmVlQnV0dG9ucyhvcHRpb25zKSB7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aGlyZEJ1dHRvblRleHQgPSBvcHRpb25zLnRoaXJkQnV0dG9uVGV4dCA/PyAnT3ZlcndyaXRlJztcbiAgICAgICAgY29uc3QgdGhpcmRCdXR0b25DbGFzcyA9IG9wdGlvbnMudGhpcmRCdXR0b25DbGFzcyA/PyAnd2Fybic7XG4gICAgICAgIGxldCBhY3Rpb246IFwiY29uZmlybVwiIHwgXCJjYW5jZWxcIiB8IFwidGhpcmRcIjtcbiAgICAgICAgY29uc3Qgb25CZWZvcmVPcGVuID0gKG1vZGFsOiBIVE1MRWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgbGV0IGVsID0gZWxlbSh7XG4gICAgICAgICAgICAgICAgaHRtbEVsZW1lbnQgOiBtb2RhbCxcbiAgICAgICAgICAgICAgICBjaGlsZHJlbiA6IHsgYWN0aW9ucyA6ICcuc3dhbDItYWN0aW9ucycgfVxuICAgICAgICAgICAgfSkgYXMgQmV0dGVySFRNTEVsZW1lbnQgJiB7IGFjdGlvbnM6IEJldHRlckhUTUxFbGVtZW50IH07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGVsLmFjdGlvbnMuYXBwZW5kKFxuICAgICAgICAgICAgICAgIGJ1dHRvbih7IGNscyA6IGBzd2FsMi1jb25maXJtIHN3YWwyLXN0eWxlZCAke3RoaXJkQnV0dG9uQ2xhc3N9YCwgaHRtbCA6IHRoaXJkQnV0dG9uVGV4dCB9KVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLmNzcyh7IGJhY2tncm91bmRDb2xvciA6ICcjRkZDNjZEJywgY29sb3IgOiAnYmxhY2snIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jbGljaygoZXY6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IFwidGhpcmRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIFN3YWwuY2xpY2tDb25maXJtKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgIH07XG4gICAgICAgIG9wdGlvbnMgPSB7IC4uLm9wdGlvbnMsIG9uQmVmb3JlT3Blbiwgc2hvd0NhbmNlbEJ1dHRvbiA6IHRydWUgfTtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gYXdhaXQgU3dhbC5maXJlKG9wdGlvbnMpO1xuICAgICAgICBpZiAoIHZhbHVlICkge1xuICAgICAgICAgICAgaWYgKCBhY3Rpb24gPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICBhY3Rpb24gPSBcImNvbmZpcm1cIjtcbiAgICAgICAgICAgIH0gLy8gYWN0aW9uIGlzIFwidGhpcmRcIlxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYWN0aW9uID0gXCJjYW5jZWxcIjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGFjdGlvbjtcbiAgICB9XG59O1xuLy8gZXhwb3J0IGRlZmF1bHQgeyBhbGVydEZuLCBzbWFsbCwgYmlnLCBjbG9zZSA6IFN3YWwuY2xvc2UsIGlzVmlzaWJsZSA6IFN3YWwuaXNWaXNpYmxlIH07XG5leHBvcnQgZGVmYXVsdCB7IHNtYWxsLCBiaWcsIC4uLlN3YWwgfTtcbiJdfQ==