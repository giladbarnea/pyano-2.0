"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
console.group('MyPyShell.index.ts');
const python_shell_1 = require("python-shell");
const enginePath = path.join(SRC_PATH_ABS, "engine");
const pyExecPath = path.join(enginePath, process.platform === "linux" ? "env/bin/python" : "env/Scripts/python.exe");
python_shell_1.PythonShell.defaultOptions = {
    pythonPath: pyExecPath,
    pythonOptions: ['-OO'],
};
class MyPyShell extends python_shell_1.PythonShell {
    constructor(scriptPath, options) {
        super(scriptPath, options);
    }
    async runAsync() {
        return new Promise((resolve, reject) => {
            const messages = [];
            this.on('message', message => {
                messages.push(message.removeAll(MyPyShell.colorRegex));
            });
            this.end((err, code, signal) => {
                if (err)
                    reject(err);
                resolve(messages);
            });
        });
    }
    static run(scriptPath, options, callback) {
        if (!options)
            options = { args: [], pythonOptions: ['-OO'] };
        if (scriptPath.startsWith('-m')) {
            scriptPath = scriptPath.slice(3);
            if (!options.pythonOptions) {
                options.pythonOptions = ['-m'];
            }
            else {
                if (!options.pythonOptions.includes('-m')) {
                    options.pythonOptions.push('-m');
                }
            }
        }
        options.args = [ROOT_PATH_ABS, ...options.args];
        if (DEBUG)
            options.args.push('debug');
        if (DRYRUN)
            options.args.push('dry-run');
        if (!callback) {
            callback = (err, output) => {
                if (err) {
                    console.error(err);
                }
                if (output) {
                    output = output.map(m => m.removeAll(MyPyShell.colorRegex));
                    console.log(`%c${scriptPath}\n`, 'font-weight: bold', output.join('\n'));
                }
            };
        }
        return python_shell_1.PythonShell.run(scriptPath, options, callback);
    }
}
MyPyShell.colorRegex = /.?\[\d{1,3}m/;
let isChecksDirsDone = false;
let isChecksCfgDone = false;
function isDone() {
    return isChecksDirsDone && isChecksCfgDone;
}
exports.isDone = isDone;
const PyChecksDirs = new MyPyShell('checks.dirs', {
    pythonOptions: ['-m',],
    args: [ROOT_PATH_ABS, 'debug', 'dry-run']
});
PyChecksDirs.runAsync().then(msgs => {
    isChecksDirsDone = true;
    console.log('PyChecksDirs msgs:', msgs.join('\n'));
});
const Store = new (require("electron-store"))();
console.log(`Store.path: `, Store.path);
const PyChecksCfg = new MyPyShell('checks.config', {
    pythonOptions: ['-m'],
    args: [ROOT_PATH_ABS, Store.path, 'debug', 'dry-run']
});
PyChecksCfg.runAsync().then(msgs => {
    isChecksCfgDone = true;
    console.log('PyChecksCfg msgs:', msgs.join('\n'));
});
console.groupEnd();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUNwQywrQ0FBc0U7QUFFdEUsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDckQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0FBRXJILDBCQUFXLENBQUMsY0FBYyxHQUFHO0lBQ3pCLFVBQVUsRUFBRyxVQUFVO0lBRXZCLGFBQWEsRUFBRyxDQUFFLEtBQUssQ0FBRTtDQUM1QixDQUFDO0FBRUYsTUFBTSxTQUFVLFNBQVEsMEJBQVc7SUFHL0IsWUFBWSxVQUFrQixFQUFFLE9BQWlCO1FBQzdDLEtBQUssQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFFL0IsQ0FBQztJQUVELEtBQUssQ0FBQyxRQUFRO1FBQ1YsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUNuQyxNQUFNLFFBQVEsR0FBRyxFQUFFLENBQUM7WUFDcEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLEVBQUU7Z0JBQ3pCLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUMzRCxDQUFDLENBQUMsQ0FBQztZQUdILElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxFQUFFO2dCQUMzQixJQUFLLEdBQUc7b0JBQUcsTUFBTSxDQUFDLEdBQUcs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LE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN4QyxNQUFNLFdBQVcsR0FBRyxJQUFJLFNBQVMsQ0FBQyxlQUFlLEVBQUU7SUFDL0MsYUFBYSxFQUFHLENBQUUsSUFBSSxDQUFFO0lBQ3hCLElBQUksRUFBRyxDQUFFLGFBQWEsRUFBRSxLQUFLLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxTQUFTLENBQUU7Q0FDM0QsQ0FBQyxDQUFDO0FBQ0gsV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRTtJQUMvQixlQUFlLEdBQUcsSUFBSSxDQUFDO0lBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ3RELENBQUMsQ0FBQyxDQUFDO0FBSUgsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYm9vbCB9IGZyb20gXCIuLi91dGlsXCI7XG5cbmNvbnNvbGUuZ3JvdXAoJ015UHlTaGVsbC5pbmRleC50cycpO1xuaW1wb3J0IHsgT3B0aW9ucywgUHl0aG9uU2hlbGwsIFB5dGhvblNoZWxsRXJyb3IgfSBmcm9tICdweXRob24tc2hlbGwnO1xuXG5jb25zdCBlbmdpbmVQYXRoID0gcGF0aC5qb2luKFNSQ19QQVRIX0FCUywgXCJlbmdpbmVcIik7XG5jb25zdCBweUV4ZWNQYXRoID0gcGF0aC5qb2luKGVuZ2luZVBhdGgsIHByb2Nlc3MucGxhdGZvcm0gPT09IFwibGludXhcIiA/IFwiZW52L2Jpbi9weXRob25cIiA6IFwiZW52L1NjcmlwdHMvcHl0aG9uLmV4ZVwiKTtcblxuUHl0aG9uU2hlbGwuZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgcHl0aG9uUGF0aCA6IHB5RXhlY1BhdGgsXG4gICAgLy8gc2NyaXB0UGF0aCA6IGVuZ2luZVBhdGgsXG4gICAgcHl0aG9uT3B0aW9ucyA6IFsgJy1PTycgXSxcbn07XG5cbmNsYXNzIE15UHlTaGVsbCBleHRlbmRzIFB5dGhvblNoZWxsIHtcbiAgICBzdGF0aWMgcmVhZG9ubHkgY29sb3JSZWdleCA9IC8uP1xcW1xcZHsxLDN9bS87XG4gICAgXG4gICAgY29uc3RydWN0b3Ioc2NyaXB0UGF0aDogc3RyaW5nLCBvcHRpb25zPzogT3B0aW9ucykge1xuICAgICAgICBzdXBlcihzY3JpcHRQYXRoLCBvcHRpb25zKTtcbiAgICAgICAgXG4gICAgfVxuICAgIFxuICAgIGFzeW5jIHJ1bkFzeW5jKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gW107XG4gICAgICAgICAgICB0aGlzLm9uKCdtZXNzYWdlJywgbWVzc2FnZSA9PiB7XG4gICAgICAgICAgICAgICAgbWVzc2FnZXMucHVzaChtZXNzYWdlLnJlbW92ZUFsbChNeVB5U2hlbGwuY29sb3JSZWdleCkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdGhpcy5lbmQoKGVyciwgY29kZSwgc2lnbmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCBlcnIgKSByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKG1lc3NhZ2VzKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBzdGF0aWMgcnVuKHNjcmlwdFBhdGg6IHN0cmluZywgb3B0aW9ucz86IE9wdGlvbnMsIGNhbGxiYWNrPzogKGVycj86IFB5dGhvblNoZWxsRXJyb3IsIG91dHB1dD86IGFueVtdKSA9PiBhbnkpIHtcbiAgICAgICAgaWYgKCAhb3B0aW9ucyApIG9wdGlvbnMgPSB7IGFyZ3MgOiBbXSwgcHl0aG9uT3B0aW9ucyA6IFsgJy1PTycgXSB9O1xuICAgICAgICBpZiAoIHNjcmlwdFBhdGguc3RhcnRzV2l0aCgnLW0nKSApIHtcbiAgICAgICAgICAgIHNjcmlwdFBhdGggPSBzY3JpcHRQYXRoLnNsaWNlKDMpO1xuICAgICAgICAgICAgaWYgKCAhb3B0aW9ucy5weXRob25PcHRpb25zICkge1xuICAgICAgICAgICAgICAgIG9wdGlvbnMucHl0aG9uT3B0aW9ucyA9IFsgJy1tJyBdXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICggIW9wdGlvbnMucHl0aG9uT3B0aW9ucy5pbmNsdWRlcygnLW0nKSApIHtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5weXRob25PcHRpb25zLnB1c2goJy1tJylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgb3B0aW9ucy5hcmdzID0gWyBST09UX1BBVEhfQUJTLCAuLi5vcHRpb25zLmFyZ3MgXTtcbiAgICAgICAgaWYgKCBERUJVRyApXG4gICAgICAgICAgICBvcHRpb25zLmFyZ3MucHVzaCgnZGVidWcnKTtcbiAgICAgICAgaWYgKCBEUllSVU4gKVxuICAgICAgICAgICAgb3B0aW9ucy5hcmdzLnB1c2goJ2RyeS1ydW4nKTtcbiAgICAgICAgaWYgKCAhY2FsbGJhY2sgKSB7XG4gICAgICAgICAgICBjYWxsYmFjayA9IChlcnI6IFB5dGhvblNoZWxsRXJyb3IsIG91dHB1dDogYW55W10pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIGVyciApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIG91dHB1dCApIHtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gb3V0cHV0Lm1hcChtID0+IG0ucmVtb3ZlQWxsKE15UHlTaGVsbC5jb2xvclJlZ2V4KSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAlYyR7c2NyaXB0UGF0aH1cXG5gLCAnZm9udC13ZWlnaHQ6IGJvbGQnLCBvdXRwdXQuam9pbignXFxuJykpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFB5dGhvblNoZWxsLnJ1bihzY3JpcHRQYXRoLCBvcHRpb25zLCBjYWxsYmFjaylcbiAgICB9XG59XG5cblxubGV0IGlzQ2hlY2tzRGlyc0RvbmUgPSBmYWxzZTtcbmxldCBpc0NoZWNrc0NmZ0RvbmUgPSBmYWxzZTtcblxuZnVuY3Rpb24gaXNEb25lKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBpc0NoZWNrc0RpcnNEb25lICYmIGlzQ2hlY2tzQ2ZnRG9uZVxufVxuXG5jb25zdCBQeUNoZWNrc0RpcnMgPSBuZXcgTXlQeVNoZWxsKCdjaGVja3MuZGlycycsIHtcbiAgICBweXRob25PcHRpb25zIDogWyAnLW0nLCBdLFxuICAgIGFyZ3MgOiBbIFJPT1RfUEFUSF9BQlMsICdkZWJ1ZycsICdkcnktcnVuJyBdXG59KTtcblB5Q2hlY2tzRGlycy5ydW5Bc3luYygpLnRoZW4obXNncyA9PiB7XG4gICAgaXNDaGVja3NEaXJzRG9uZSA9IHRydWU7XG4gICAgY29uc29sZS5sb2coJ1B5Q2hlY2tzRGlycyBtc2dzOicsIG1zZ3Muam9pbignXFxuJykpO1xufSk7XG5cbi8vIE15UHlTaGVsbC5ydW4oXCItbSBjaGVja3MuZGlyc1wiKTtcblxuLy8gKiogIEVsZWN0cm9uIFN0b3JlXG5jb25zdCBTdG9yZSA9IG5ldyAocmVxdWlyZShcImVsZWN0cm9uLXN0b3JlXCIpKSgpO1xuXG5cbmNvbnNvbGUubG9nKGBTdG9yZS5wYXRoOiBgLCBTdG9yZS5wYXRoKTtcbmNvbnN0IFB5Q2hlY2tzQ2ZnID0gbmV3IE15UHlTaGVsbCgnY2hlY2tzLmNvbmZpZycsIHtcbiAgICBweXRob25PcHRpb25zIDogWyAnLW0nIF0sXG4gICAgYXJncyA6IFsgUk9PVF9QQVRIX0FCUywgU3RvcmUucGF0aCwgJ2RlYnVnJywgJ2RyeS1ydW4nIF1cbn0pO1xuUHlDaGVja3NDZmcucnVuQXN5bmMoKS50aGVuKG1zZ3MgPT4ge1xuICAgIGlzQ2hlY2tzQ2ZnRG9uZSA9IHRydWU7XG4gICAgY29uc29sZS5sb2coJ1B5Q2hlY2tzQ2ZnIG1zZ3M6JywgbXNncy5qb2luKCdcXG4nKSk7XG59KTtcbi8vIE15UHlTaGVsbC5ydW4oXCItbSBjaGVja3MuY29uZmlnXCIsIHsgYXJncyA6IFsgU3RvcmUucGF0aCBdIH0pO1xuXG5leHBvcnQgeyBpc0RvbmUgfTtcbmNvbnNvbGUuZ3JvdXBFbmQoKTtcbiJdfQ==